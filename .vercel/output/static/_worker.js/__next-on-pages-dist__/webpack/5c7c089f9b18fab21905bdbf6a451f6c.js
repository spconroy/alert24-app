var ke={},Oi=(Pe,ee,jt)=>(ke.__chunk_6006=(ge,K,L)=>{L.d(K,{_:()=>he,db:()=>re});var V=L(9037);let Y="https://rwsjzzggxenacfkdazce.supabase.co",pe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ3c2p6emdneGVuYWNma2RhemNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MDAwMjIsImV4cCI6MjA2ODI3NjAyMn0.I-4FZT4MXPXbz2H7EADTNhbw3kmwmmQHzgNNPkJAilc",ue=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!Y||!pe)throw Error("Missing Supabase environment variables");let Se=(0,V.eI)(Y,pe),ne=null;ue&&(ne=(0,V.eI)(Y,ue));class he{constructor(){this.client=Se,this.adminClient=ne}async query(h,o=[]){try{throw console.log("Executing query:",h,"with params:",o),Error("Raw SQL queries not supported - use specific methods instead")}catch(l){throw console.error("Database query error:",l),l}}async getOrganizations(h){let{data:o,error:l}=await this.client.from("organizations").select(`
        *,
        organization_members!inner(user_id, role)
      `).eq("organization_members.user_id",h);if(l)throw l;return o.map(p=>({...p,role:p.organization_members[0]?.role,organization_members:void 0}))}async createOrganization(h,o){let{data:l,error:p}=await this.client.from("organizations").insert(h).select().single();if(p)throw p;let{error:k}=await this.client.from("organization_members").insert({organization_id:l.id,user_id:o,role:"owner"});if(k)throw k;return l}async getUserByEmail(h){let{data:o,error:l}=await this.client.from("users").select("*").eq("email",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async createUser(h){let{data:o,error:l}=await this.client.from("users").insert(h).select().single();if(l)throw l;return o}async getServicesByOrganization(h){let{data:o,error:l}=await this.client.from("services").select("*").eq("organization_id",h).not("name","ilike","[[]MONITORING]%");if(l)throw l;return o}async createService(h){let{data:o,error:l}=await this.client.from("services").insert(h).select().single();if(l)throw l;return o}async getIncidentsByOrganization(h){let{data:o,error:l}=await this.client.from("incidents").select(`
        *,
        services(name)
      `).eq("organization_id",h).order("created_at",{ascending:!1});if(l)throw l;return o||[]}async createIncident(h){let{data:o,error:l}=await this.client.from("incidents").insert(h).select().single();if(l)throw l;return o}async updateIncident(h,o){let{data:l,error:p}=await this.client.from("incidents").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteIncident(h){let{error:o}=await this.client.from("incidents").delete().eq("id",h);if(o)throw o;return{success:!0}}async getStatusPagesByOrganization(h){let{data:o,error:l}=await this.client.from("status_pages").select("*").eq("organization_id",h);if(l)throw l;return o}async getStatusPageBySlug(h){let{data:o,error:l}=await this.client.from("status_pages").select(`
        *,
        organizations(name, logo_url),
        status_page_services(
          service_id,
          services(name, description)
        )
      `).eq("slug",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async getMonitoringByService(h){let{data:o,error:l}=await this.client.from("service_monitoring").select("*").eq("service_id",h);if(l)throw l;return o}async select(h,o="*",l={}){let p=this.client.from(h).select(o);Object.entries(l).forEach(([v,w])=>{p=p.eq(v,w)});let{data:k,error:d}=await p;if(d)throw d;return k}async insert(h,o){let{data:l,error:p}=await this.client.from(h).insert(o).select().single();if(p)throw p;return l}async update(h,o,l){let{data:p,error:k}=await this.client.from(h).update(l).eq("id",o).select().single();if(k)throw k;return p}async delete(h,o){let{error:l}=await this.client.from(h).delete().eq("id",o);if(l)throw l;return{success:!0}}async getOrganizationMember(h,o){let{data:l,error:p}=await this.client.from("organization_members").select("*").eq("organization_id",h).eq("user_id",o).eq("is_active",!0).single();if(p&&p.code!=="PGRST116")throw p;return l}async getPendingInvitations(h){let{data:o,error:l}=await this.client.from("organization_members").select(`
        id,
        invitation_token,
        invited_at,
        invitation_expires_at,
        role,
        user_id,
        users!organization_members_user_id_fkey(email, name),
        invited_by_user:users!organization_members_invited_by_fkey(name)
      `).eq("organization_id",h).is("accepted_at",null).not("invitation_token","is",null).gt("invitation_expires_at",new Date().toISOString()).order("invited_at",{ascending:!1});if(l)throw l;return o}async createInvitation(h){let{data:o,error:l}=await this.client.from("organization_members").upsert(h,{onConflict:"organization_id,user_id",ignoreDuplicates:!1}).select().single();if(l)throw l;return o}async getUserById(h){let{data:o,error:l}=await this.client.from("users").select("*").eq("id",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async getOrganizationById(h){let{data:o,error:l}=await this.client.from("organizations").select("*").eq("id",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async getIncidentById(h,o){let{data:l,error:p}=await this.client.from("incidents").select(`
        *,
        organizations(name),
        created_by_user:users!incidents_created_by_fkey(name, email),
        assigned_to_user:users!incidents_assigned_to_fkey(name, email),
        escalation_policies(name, escalation_timeout_minutes),
        organization_members!inner(user_id)
      `).eq("id",h).eq("organization_members.user_id",o).eq("organization_members.is_active",!0).single();if(p&&p.code!=="PGRST116")throw p;return l}async updateIncident(h,o){let{data:l,error:p}=await this.client.from("incidents").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteIncident(h){let{error:o}=await this.client.from("incidents").delete().eq("id",h);if(o)throw o;return{success:!0}}async getServiceById(h){let{data:o,error:l}=await this.client.from("services").select(`
        *,
        status_pages(name, organization_id, organizations(name))
      `).eq("id",h).is("deleted_at",null).single();if(l&&l.code!=="PGRST116")throw l;return o}async updateService(h,o){let{data:l,error:p}=await this.client.from("services").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteService(h){let{data:o,error:l}=await this.client.from("services").update({deleted_at:new Date().toISOString()}).eq("id",h).select().single();if(l)throw l;return o}async getIncidentUpdates(h){let{data:o,error:l}=await this.client.from("incident_updates").select(`
        *,
        posted_by_user:users!incident_updates_posted_by_fkey(name, email)
      `).eq("incident_id",h).order("created_at",{ascending:!0});if(l)throw l;return o}async createIncidentUpdate(h){let{data:o,error:l}=await this.client.from("incident_updates").insert(h).select().single();if(l)throw l;return o}async updateIncidentUpdate(h,o){let{data:l,error:p}=await this.client.from("incident_updates").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteIncidentUpdate(h){let{error:o}=await this.client.from("incident_updates").delete().eq("id",h);if(o)throw o;return{success:!0}}async getServiceMonitoring(h){let{data:o,error:l}=await this.client.from("service_monitoring").select("*").eq("service_id",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async createServiceMonitoring(h){let{data:o,error:l}=await this.client.from("service_monitoring").insert(h).select().single();if(l)throw l;return o}async updateServiceMonitoring(h,o){let{data:l,error:p}=await this.client.from("service_monitoring").update(o).eq("id",h).select().single();if(p)throw p;return l}async updateServiceMonitoringByServiceId(h,o){let{data:l,error:p}=await this.client.from("service_monitoring").update(o).eq("service_id",h).select().single();if(p)throw p;return l}async getStatusPageById(h){let{data:o,error:l}=await this.client.from("status_pages").select(`
        *,
        organizations(name, logo_url),
        status_page_services(
          service_id,
          services(name, description, status)
        )
      `).eq("id",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async updateStatusPage(h,o){let{data:l,error:p}=await this.client.from("status_pages").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteStatusPage(h){let{data:o,error:l}=await this.client.from("status_pages").update({deleted_at:new Date().toISOString()}).eq("id",h).select().single();if(l)throw l;return o}async getMonitoringChecks(h,o={}){try{if(o.organization_id&&!await this.getOrganizationMember(o.organization_id,h))return[];let l=this.client.from("monitoring_checks").select(`
          *,
          organizations(name)
        `);o.organization_id&&(l=l.eq("organization_id",o.organization_id)),o.status&&(l=l.eq("status",o.status)),o.check_type&&(l=l.eq("check_type",o.check_type)),l=l.order("created_at",{ascending:!1}),o.limit&&(l=l.limit(o.limit)),o.offset&&(l=l.range(o.offset,o.offset+(o.limit||10)-1));let{data:p,error:k}=await l;return k?(console.warn("Error fetching monitoring checks:",k),[]):(console.log(`Found ${(p||[]).length} monitoring checks for filters:`,o),p&&p.length>0&&console.log("Sample check data:",p[0]),(p||[]).map(d=>{let v=new Date,w=d.last_check_at?new Date(d.last_check_at):d.updated_at?new Date(d.updated_at):v,_=1e3*(d.check_interval_seconds||300),b=new Date(w.getTime()+_),X=b.getTime()<v.getTime()?new Date(v.getTime()+_):b,te=d.current_status||"unknown";d.last_check_at||d.status!=="active"||(te="pending"),d.status!=="active"&&(te="inactive");let C={id:d.id,name:d.name,check_type:d.check_type,target_url:d.target_url,url:d.target_url,check_interval:Math.floor((d.check_interval_seconds||300)/60),check_interval_seconds:d.check_interval_seconds||300,timeout:d.timeout_seconds||30,timeout_seconds:d.timeout_seconds||30,status:d.status||"active",is_active:d.status==="active",current_status:te,created_at:d.created_at,updated_at:d.updated_at,organization_id:d.organization_id,organization_name:d.organizations?.name||"Unknown Organization",created_by:d.created_by,linked_service_id:d.linked_service_id,failure_threshold:d.failure_threshold||3,success_threshold:d.success_threshold||1,failure_threshold_minutes:d.failure_threshold_minutes||5,consecutive_failures:d.consecutive_failures||0,consecutive_successes:d.consecutive_successes||0,method:d.method||"GET",http_method:d.method||"GET",headers:d.headers||{},http_headers:d.headers||{},body:d.body,expected_status_code:d.expected_status_code||200,expected_status_codes:[d.expected_status_code||200],location_name:"Default",last_response_time:d.last_response_time||null,last_check_time:d.last_check_at||d.updated_at||d.created_at,last_check_at:d.last_check_at,last_success_at:d.last_success_at,last_failure_at:d.last_failure_at,next_check_time:X.toISOString(),failure_message:d.failure_message};return console.log(`Transformed check ${d.name}:`,{original_status:d.status,original_current_status:d.current_status,final_current_status:C.current_status,is_active:C.is_active}),C}))}catch(l){return console.warn("Error in getMonitoringChecks:",l),[]}}async createCheckResult(h){try{let{data:o,error:l}=await this.client.from("check_results").insert({monitoring_check_id:h.monitoring_check_id,monitoring_location_id:h.monitoring_location_id||"00000000-0000-0000-0000-000000000001",is_successful:h.is_successful,response_time:h.response_time_ms,status_code:h.status_code,response_body:h.response_body,response_headers:h.response_headers,error_message:h.error_message,ssl_certificate_info:h.ssl_info,created_at:new Date().toISOString()}).select().single();if(l)throw l;return o}catch(o){return console.warn("Failed to create check result, falling back to workaround:",o),null}}async getCheckResults(h,o={}){try{let l=this.client.from("check_results").select("*").eq("monitoring_check_id",h).order("created_at",{ascending:!1});o.limit&&(l=l.limit(o.limit)),o.startDate&&(l=l.gte("created_at",o.startDate)),o.endDate&&(l=l.lte("created_at",o.endDate));let{data:p,error:k}=await l;if(k)throw k;return p||[]}catch(l){return console.warn("Failed to get check results:",l),[]}}async getMonitoringLocations(h={}){try{let o=this.client.from("monitoring_locations").select("*").order("is_default",{ascending:!1}).order("name",{ascending:!0});h.active_only&&(o=o.eq("is_active",!0));let{data:l,error:p}=await o;return p?(console.warn("Error fetching monitoring locations:",p),this.getDefaultMonitoringLocations()):l||this.getDefaultMonitoringLocations()}catch(o){return console.warn("Monitoring locations table may not exist, using defaults:",o),this.getDefaultMonitoringLocations()}}async getDefaultMonitoringLocations(){return[{id:"00000000-0000-0000-0000-000000000001",name:"US East (N. Virginia)",code:"us-east-1",description:"Primary US East location",region:"North America",country:"United States",city:"Ashburn",latitude:39.0458,longitude:-77.4976,is_active:!0,is_default:!0},{id:"00000000-0000-0000-0000-000000000002",name:"US West (Oregon)",code:"us-west-2",description:"Primary US West location",region:"North America",country:"United States",city:"Portland",latitude:45.5152,longitude:-122.6784,is_active:!0,is_default:!1},{id:"00000000-0000-0000-0000-000000000003",name:"EU (Frankfurt)",code:"eu-central-1",description:"Primary EU location",region:"Europe",country:"Germany",city:"Frankfurt",latitude:50.1109,longitude:8.6821,is_active:!0,is_default:!1},{id:"00000000-0000-0000-0000-000000000004",name:"Asia Pacific (Singapore)",code:"ap-southeast-1",description:"Primary APAC location",region:"Asia Pacific",country:"Singapore",city:"Singapore",latitude:1.3521,longitude:103.8198,is_active:!0,is_default:!1},{id:"00000000-0000-0000-0000-000000000005",name:"Asia Pacific (Sydney)",code:"ap-southeast-2",description:"Secondary APAC location",region:"Asia Pacific",country:"Australia",city:"Sydney",latitude:-33.8688,longitude:151.2093,is_active:!0,is_default:!1}]}async createMonitoringLocation(h){let{data:o,error:l}=await this.client.from("monitoring_locations").insert(h).select().single();if(l)throw l;return o}async updateMonitoringLocation(h,o){let{data:l,error:p}=await this.client.from("monitoring_locations").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteMonitoringLocation(h){let{data:o,error:l}=await this.client.from("monitoring_locations").update({is_active:!1}).eq("id",h).select().single();if(l)throw l;return o}async createMonitoringCheck(h){try{let o={organization_id:h.organization_id,name:h.name,description:h.description||`Monitoring check for ${h.name}`,check_type:h.check_type||"http",target_url:h.target_url,method:h.http_method||"GET",headers:h.http_headers||{},body:h.body||null,expected_status_code:h.expected_status_codes?.[0]||200,timeout_seconds:h.timeout_seconds||h.timeout||30,check_interval_seconds:h.check_interval_seconds||300,failure_threshold:h.failure_threshold||3,success_threshold:h.success_threshold||1,status:h.is_active===!1?"disabled":"active",current_status:"unknown",linked_service_id:h.linked_service_id||null,failure_threshold_minutes:h.failure_threshold_minutes||5,consecutive_failures:0,consecutive_successes:0,created_by:h.created_by};console.log("Database - checkData input:",h),console.log("Database - dbData prepared:",o),console.log("Creating monitoring check in monitoring_checks table:",o),console.log("Creating monitoring check with regular client (RLS disabled)...");let{data:l,error:p}=await this.client.from("monitoring_checks").insert(o).select().single();if(p)throw console.error("Database error creating monitoring check:",p),p.code==="42501"?Error("Access denied: Unable to create monitoring check. This might be due to insufficient permissions or missing organization membership. Please ensure you have the required role (owner, admin, or responder) in the organization."):p;let k={id:l.id,name:l.name,check_type:l.check_type,target_url:l.target_url,url:l.target_url,organization_id:l.organization_id,check_interval:Math.floor(l.check_interval_seconds/60),check_interval_seconds:l.check_interval_seconds,timeout:l.timeout_seconds,timeout_seconds:l.timeout_seconds,status:l.status,is_active:l.status==="active",current_status:l.current_status,created_at:l.created_at,updated_at:l.updated_at,linked_service_id:l.linked_service_id,failure_threshold:l.failure_threshold,success_threshold:l.success_threshold,failure_threshold_minutes:l.failure_threshold_minutes,consecutive_failures:l.consecutive_failures,consecutive_successes:l.consecutive_successes,method:l.method,http_method:l.method,headers:l.headers,http_headers:l.headers,body:l.body,expected_status_code:l.expected_status_code,expected_status_codes:[l.expected_status_code]};return console.log("Successfully created monitoring check:",k),k}catch(o){throw console.error("Error creating monitoring check:",o),o}}async updateMonitoringCheck(h,o){try{let{data:l,error:p}=await this.client.from("services").select("*").eq("id",h).ilike("name","[[]MONITORING]%").single();if(p)throw p;let k=JSON.parse(l.description);o.name&&(k.name=o.name),o.check_type&&(k.check_type=o.check_type),(o.url||o.target_url)&&(k.target_url=o.url||o.target_url),o.check_interval&&(k.check_interval=o.check_interval),o.timeout&&(k.target_timeout=o.timeout),o.is_active!==void 0&&(k.status=o.is_active?"active":"disabled");let d={description:JSON.stringify(k)};o.name&&(d.name=`[MONITORING] ${o.name}`);let{data:v,error:w}=await this.client.from("services").update(d).eq("id",h).select().single();if(w)throw w;let _=JSON.parse(v.description);return{id:v.id,name:_.name,check_type:_.check_type||"http",target_url:_.target_url,url:_.target_url,check_interval:_.check_interval||5,timeout:_.target_timeout||30,status:_.status||"active",is_active:_.status==="active",current_status:_.status||"active",created_at:v.created_at,updated_at:v.updated_at,organization_id:_.organization_id,created_by:_.created_by}}catch(l){throw console.error("Error updating monitoring check:",l),l}}async deleteMonitoringCheck(h){try{console.log(`\u{1F5D1}\uFE0F Attempting to delete monitoring check: ${h}`);let{data:o,error:l}=await this.client.from("monitoring_checks").select("*").eq("id",h).single();if(l)throw console.error("\u274C Error fetching monitoring check for deletion:",l),l.code==="PGRST116"?Error(`Monitoring check with ID ${h} not found`):l;console.log(`\u2705 Found monitoring check to delete: ${o.name}`);let{data:p,error:k}=await this.client.from("monitoring_checks").delete().eq("id",h).select();if(k)throw console.error("\u274C Error deleting monitoring check:",k),k;if(!p||p.length===0)throw console.error("\u274C No rows were deleted"),Error(`Monitoring check with ID ${h} not found or not deleted`);return console.log(`\u2705 Successfully deleted monitoring check: ${h}`),{success:!0,deleted:p[0]}}catch(o){throw console.error("\u274C Error deleting monitoring check:",o),o}}async getEscalationPolicies(h,o={}){let l=this.client.from("escalation_policies").select(`
        *,
        organizations(name),
        created_by_user:users!escalation_policies_created_by_fkey(name, email),
        organization_members!inner(user_id)
      `).eq("organization_members.user_id",h).eq("organization_members.is_active",!0);o.organization_id&&(l=l.eq("organization_id",o.organization_id)),o.active_only&&(l=l.eq("is_active",!0)),l=l.order("created_at",{ascending:!1});let{data:p,error:k}=await l;if(k)throw k;return p}async createEscalationPolicy(h){let{data:o,error:l}=await this.client.from("escalation_policies").insert(h).select().single();if(l)throw l;return o}async updateEscalationPolicy(h,o){let{data:l,error:p}=await this.client.from("escalation_policies").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteEscalationPolicy(h){let{error:o}=await this.client.from("escalation_policies").delete().eq("id",h);if(o)throw o;return{success:!0}}async getEscalationPolicyById(h,o){let{data:l,error:p}=await this.client.from("escalation_policies").select(`
        *,
        organizations(name),
        created_by_user:users!escalation_policies_created_by_fkey(name, email),
        organization_members!inner(user_id)
      `).eq("id",h).eq("organization_members.user_id",o).eq("organization_members.is_active",!0).single();if(p&&p.code!=="PGRST116")throw p;return l}async getOnCallSchedules(h,o={}){try{let{data:l,error:p}=await this.client.from("organization_members").select("organization_id").eq("user_id",h).eq("is_active",!0);if(p)return console.warn("Error fetching user organizations:",p),[];if(!l||l.length===0)return[];let k=l.map(_=>_.organization_id),d=this.client.from("on_call_schedules").select(`
          *,
          organizations(name)
        `).in("organization_id",k);if(o.organization_id){if(!k.includes(o.organization_id))return[];d=d.eq("organization_id",o.organization_id)}o.active_only&&(d=d.eq("is_active",!0)),o.start_date&&o.end_date&&(d=d.gte("start_time",o.start_date).lte("end_time",o.end_date)),d=d.order("created_at",{ascending:!1});let{data:v,error:w}=await d;return w?(console.warn("Error fetching on-call schedules:",w),[]):v||[]}catch(l){return console.warn("Error in getOnCallSchedules:",l),[]}}async createOnCallSchedule(h){console.log("Creating on-call schedule with regular client (RLS disabled)"),console.log("Schedule data:",h);let{data:o,error:l}=await this.client.from("on_call_schedules").insert(h).select().single();if(l)throw console.error("Error creating on-call schedule:",l),l;return o}async updateOnCallSchedule(h,o){let{data:l,error:p}=await this.client.from("on_call_schedules").update(o).eq("id",h).select().single();if(p)throw p;return l}async deleteOnCallSchedule(h){let{error:o}=await this.client.from("on_call_schedules").delete().eq("id",h);if(o)throw o;return{success:!0}}async getOnCallScheduleById(h,o){try{let{data:l,error:p}=await this.client.from("on_call_schedules").select(`
          *,
          organizations(name)
        `).eq("id",h).single();if(p&&p.code!=="PGRST116")return console.warn("Error fetching on-call schedule:",p),null;if(!l)return null;let{data:k,error:d}=await this.client.from("organization_members").select("id").eq("organization_id",l.organization_id).eq("user_id",o).eq("is_active",!0).single();return d||!k?null:l}catch(l){return console.warn("Error in getOnCallScheduleById:",l),null}}async createCheckResult(h){let{data:o,error:l}=await this.client.from("check_results").insert(h).select().single();if(l)throw l;return o}async getCheckResults(h,o=50){let{data:l,error:p}=await this.client.from("check_results").select("*").eq("monitoring_check_id",h).order("created_at",{ascending:!1}).limit(o);if(p)throw p;return l}async getPendingMonitoringChecks(h=50){try{let{data:o,error:l}=await this.client.from("services").select("*").ilike("name","[[]MONITORING]%").limit(h);if(l)throw l;return(o||[]).map(p=>{try{let k=JSON.parse(p.description);return k.type!=="monitoring_check"||k.status!=="active"?null:{id:p.id,name:k.name,check_type:k.check_type,target_url:k.target_url,organization_id:k.organization_id,check_interval:k.check_interval,timeout:k.target_timeout,status:k.status,is_active:k.status==="active"}}catch{return null}}).filter(Boolean)}catch(o){return console.error("Error getting pending monitoring checks:",o),[]}}async getMonitoringCheckById(h){try{let{data:o,error:l}=await this.client.from("monitoring_checks").select("*, organizations(name)").eq("id",h).single();if(l){if(l.code==="PGRST116")return null;throw l}return{id:o.id,name:o.name,check_type:o.check_type,target_url:o.target_url,url:o.target_url,organization_id:o.organization_id,organization_name:o.organizations?.name||"Unknown Organization",check_interval:Math.floor(o.check_interval_seconds/60),check_interval_seconds:o.check_interval_seconds,timeout:o.timeout_seconds,timeout_seconds:o.timeout_seconds,status:o.status,is_active:o.status==="active",current_status:o.current_status,created_at:o.created_at,updated_at:o.updated_at,linked_service_id:o.linked_service_id,failure_threshold:o.failure_threshold,success_threshold:o.success_threshold,failure_threshold_minutes:o.failure_threshold_minutes,consecutive_failures:o.consecutive_failures,consecutive_successes:o.consecutive_successes,last_check_at:o.last_check_at,last_success_at:o.last_success_at,last_failure_at:o.last_failure_at,failure_message:o.failure_message,method:o.method,http_method:o.method,headers:o.headers,http_headers:o.headers,body:o.body,expected_status_code:o.expected_status_code,expected_status_codes:[o.expected_status_code]}}catch(o){throw console.error("Error getting monitoring check by ID:",o),o}}async getMonitoringChecksByStatus(h){try{let{data:o,error:l}=await this.client.from("services").select("*").ilike("name","[[]MONITORING]%").order("created_at",{ascending:!1});if(l)throw l;return(o||[]).map(p=>{try{let k=JSON.parse(p.description);if(k.type!=="monitoring_check")return null;let d=k.status==="active";return h==="active"&&!d||h!=="active"&&d?null:{id:p.id,name:k.name,check_type:k.check_type,target_url:k.target_url,organization_id:k.organization_id,check_interval:k.check_interval,timeout:k.target_timeout,status:k.status,is_active:k.status==="active",created_at:p.created_at,updated_at:p.updated_at}}catch{return null}}).filter(Boolean)}catch(o){return console.error("Error getting monitoring checks by status:",o),[]}}async getInvitationByToken(h){let{data:o,error:l}=await this.client.from("organization_members").select(`
        id,
        organization_id,
        user_id,
        role,
        invitation_expires_at,
        accepted_at,
        organizations(name),
        users!organization_members_user_id_fkey(email),
        invited_by_user:users!organization_members_invited_by_fkey(name)
      `).eq("invitation_token",h).single();if(l&&l.code!=="PGRST116")throw l;return o}async acceptInvitation(h,o){let{data:l,error:p}=await this.client.from("organization_members").update({...o,accepted_at:new Date().toISOString(),invitation_token:null,is_active:!0}).eq("id",h).select().single();if(p)throw p;return l}async getSubscription(h,o){let{data:l,error:p}=await this.client.from("subscriptions").select("*").eq("status_page_id",h).eq("email",o).single();if(p&&p.code!=="PGRST116")throw p;return l}async createSubscription(h){let{data:o,error:l}=await this.client.from("subscriptions").insert(h).select().single();if(l)throw l;return o}async deleteSubscription(h){let{error:o}=await this.client.from("subscriptions").delete().eq("id",h);if(o)throw o;return{success:!0}}async unsubscribeByToken(h){let{data:o,error:l}=await this.client.from("subscriptions").delete().eq("unsubscribe_token",h).select().single();if(l)throw l;return o}async getAllStatusPagesForUser(h){let{data:o,error:l}=await this.client.from("status_pages").select(`
        *,
        organizations(name, slug),
        organization_members!inner(user_id)
      `).eq("organization_members.user_id",h).eq("organization_members.is_active",!0).is("deleted_at",null).order("organizations(name)",{ascending:!0}).order("name",{ascending:!0});if(l)throw l;return o}async getServiceUptimeStats(h,o=30){try{let l=new Date(Date.now()-864e5*o),p=new Date,{data:k,error:d}=await this.client.from("service_status_history").select("status, started_at, ended_at").eq("service_id",h).gte("started_at",l.toISOString()).order("started_at",{ascending:!0});if(d)return console.warn("Error fetching service status history:",d),this.getMockUptimeStats(o);if(!k||k.length===0)return{uptime_percentage:100,total_checks:96*o,successful_checks:96*o,failed_checks:0};let v=(p-l)/6e4,w=0;for(let te of k){let C=new Date(Math.max(new Date(te.started_at),l)),A=te.ended_at?new Date(Math.min(new Date(te.ended_at),p)):p;if(A>C){let ie=(A-C)/6e4;(te.status==="operational"||te.status==="maintenance")&&(w+=ie)}}let _=v>0?w/v*100:100,b=Math.floor(96*o),X=Math.floor(_/100*b);return{uptime_percentage:Math.max(0,Math.min(100,_)),total_checks:b,successful_checks:X,failed_checks:b-X}}catch(l){return console.warn("Error in getServiceUptimeStats:",l),this.getMockUptimeStats(o)}}getMockUptimeStats(h=30){let o=96*h,l=Math.floor(.995*o);return{uptime_percentage:99.5,total_checks:o,successful_checks:l,failed_checks:o-l}}async testConnection(){try{let{data:h,error:o}=await this.client.from("organizations").select("count").limit(1);if(o)throw o;return{success:!0,message:"Supabase connection successful",timestamp:new Date().toISOString()}}catch(h){return{success:!1,error:h.message,timestamp:new Date().toISOString()}}}}let re=new he},ke.__chunk_9985=(ge,K,L)=>{"use strict";L.d(K,{Im:()=>V.I,xk:()=>Y.x});var V=L(662),Y=L(7701);L(4155),typeof URLPattern>"u"||URLPattern},ke.__chunk_4155=(ge,K,L)=>{var V;(()=>{var Y={226:function(ne,he){(function(re,W){"use strict";var h="function",o="undefined",l="object",p="string",k="major",d="model",v="name",w="type",_="vendor",b="version",X="architecture",te="console",C="mobile",A="tablet",ie="smarttv",me="wearable",Ue="embedded",_e="Amazon",ve="Apple",tt="ASUS",ot="BlackBerry",Te="Browser",Ee="Chrome",G="Firefox",Je="Google",He="Huawei",Ve="Microsoft",lt="Motorola",je="Opera",$e="Samsung",xe="Sharp",H="Sony",se="Xiaomi",qe="Zebra",we="Facebook",B="Chromium OS",it="Mac OS",ct=function(x,N){var I={};for(var F in x)N[F]&&N[F].length%2==0?I[F]=N[F].concat(x[F]):I[F]=x[F];return I},ze=function(x){for(var N={},I=0;I<x.length;I++)N[x[I].toUpperCase()]=x[I];return N},le=function(x,N){return typeof x===p&&oe(N).indexOf(oe(x))!==-1},oe=function(x){return x.toLowerCase()},Le=function(x,N){if(typeof x===p)return x=x.replace(/^\s\s*/,""),typeof N===o?x:x.substring(0,350)},Ne=function(x,N){for(var I,F,ce,$,de,O,Z=0;Z<N.length&&!de;){var st=N[Z],ut=N[Z+1];for(I=F=0;I<st.length&&!de&&st[I];)if(de=st[I++].exec(x))for(ce=0;ce<ut.length;ce++)O=de[++F],typeof($=ut[ce])===l&&$.length>0?$.length===2?typeof $[1]==h?this[$[0]]=$[1].call(this,O):this[$[0]]=$[1]:$.length===3?typeof $[1]!==h||$[1].exec&&$[1].test?this[$[0]]=O?O.replace($[1],$[2]):void 0:this[$[0]]=O?$[1].call(this,O,$[2]):void 0:$.length===4&&(this[$[0]]=O?$[3].call(this,O.replace($[1],$[2])):void 0):this[$]=O||W;Z+=2}},rt=function(x,N){for(var I in N)if(typeof N[I]===l&&N[I].length>0){for(var F=0;F<N[I].length;F++)if(le(N[I][F],x))return I==="?"?W:I}else if(le(N[I],x))return I==="?"?W:I;return x},Oe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},De={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,b],[/opios[\/ ]+([\w\.]+)/i],[b,[v,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[b,[v,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[v,"UC"+Te]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[b,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+Te],b],[/\bfocus\/([\w\.]+)/i],[b,[v,G+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[v,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[v,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[v,"MIUI "+Te]],[/fxios\/([-\w\.]+)/i],[b,[v,G]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+Te]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+Te],b],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,we],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[b,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[v,Ee+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,Ee+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[v,"Android "+Te]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[b,rt,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[v,G+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,b],[/(cobalt)\/([\w\.]+)/i],[v,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[X,"amd64"]],[/(ia32(?=;))/i],[[X,oe]],[/((?:i[346]|x)86)[;\)]/i],[[X,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[X,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[X,"armhf"]],[/windows (ce|mobile); ppc;/i],[[X,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[X,/ower/,"",oe]],[/(sun4\w)[;\)]/i],[[X,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[X,oe]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[_,$e],[w,A]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[_,$e],[w,C]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[_,ve],[w,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[_,ve],[w,A]],[/(macintosh);/i],[d,[_,ve]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[_,xe],[w,C]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[_,He],[w,A]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[_,He],[w,C]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[_,se],[w,C]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[_,se],[w,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[_,"OPPO"],[w,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[_,"Vivo"],[w,C]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[_,"Realme"],[w,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[_,lt],[w,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[_,lt],[w,A]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[_,"LG"],[w,A]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[_,"LG"],[w,C]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[_,"Lenovo"],[w,A]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[_,"Nokia"],[w,C]],[/(pixel c)\b/i],[d,[_,Je],[w,A]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[_,Je],[w,C]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[_,H],[w,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[_,H],[w,A]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[_,"OnePlus"],[w,C]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[_,_e],[w,A]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[_,_e],[w,C]],[/(playbook);[-\w\),; ]+(rim)/i],[d,_,[w,A]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[_,ot],[w,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[_,tt],[w,A]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[_,tt],[w,C]],[/(nexus 9)/i],[d,[_,"HTC"],[w,A]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[d,/_/g," "],[w,C]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[_,"Acer"],[w,A]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[_,"Meizu"],[w,C]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,d,[w,C]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,d,[w,A]],[/(surface duo)/i],[d,[_,Ve],[w,A]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[_,"Fairphone"],[w,C]],[/(u304aa)/i],[d,[_,"AT&T"],[w,C]],[/\bsie-(\w*)/i],[d,[_,"Siemens"],[w,C]],[/\b(rct\w+) b/i],[d,[_,"RCA"],[w,A]],[/\b(venue[\d ]{2,7}) b/i],[d,[_,"Dell"],[w,A]],[/\b(q(?:mv|ta)\w+) b/i],[d,[_,"Verizon"],[w,A]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[_,"Barnes & Noble"],[w,A]],[/\b(tm\d{3}\w+) b/i],[d,[_,"NuVision"],[w,A]],[/\b(k88) b/i],[d,[_,"ZTE"],[w,A]],[/\b(nx\d{3}j) b/i],[d,[_,"ZTE"],[w,C]],[/\b(gen\d{3}) b.+49h/i],[d,[_,"Swiss"],[w,C]],[/\b(zur\d{3}) b/i],[d,[_,"Swiss"],[w,A]],[/\b((zeki)?tb.*\b) b/i],[d,[_,"Zeki"],[w,A]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],d,[w,A]],[/\b(ns-?\w{0,9}) b/i],[d,[_,"Insignia"],[w,A]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[_,"NextBook"],[w,A]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],d,[w,C]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],d,[w,C]],[/\b(ph-1) /i],[d,[_,"Essential"],[w,C]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[_,"Envizen"],[w,A]],[/\b(trio[-\w\. ]+) b/i],[d,[_,"MachSpeed"],[w,A]],[/\btu_(1491) b/i],[d,[_,"Rotor"],[w,A]],[/(shield[\w ]+) b/i],[d,[_,"Nvidia"],[w,A]],[/(sprint) (\w+)/i],[_,d,[w,C]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[_,Ve],[w,C]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[_,qe],[w,A]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[_,qe],[w,C]],[/smart-tv.+(samsung)/i],[_,[w,ie]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[_,$e],[w,ie]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,"LG"],[w,ie]],[/(apple) ?tv/i],[_,[d,ve+" TV"],[w,ie]],[/crkey/i],[[d,Ee+"cast"],[_,Je],[w,ie]],[/droid.+aft(\w)( bui|\))/i],[d,[_,_e],[w,ie]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[_,xe],[w,ie]],[/(bravia[\w ]+)( bui|\))/i],[d,[_,H],[w,ie]],[/(mitv-\w{5}) bui/i],[d,[_,se],[w,ie]],[/Hbbtv.*(technisat) (.*);/i],[_,d,[w,ie]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,Le],[d,Le],[w,ie]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,ie]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,d,[w,te]],[/droid.+; (shield) bui/i],[d,[_,"Nvidia"],[w,te]],[/(playstation [345portablevi]+)/i],[d,[_,H],[w,te]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[_,Ve],[w,te]],[/((pebble))app/i],[_,d,[w,me]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[_,ve],[w,me]],[/droid.+; (glass) \d/i],[d,[_,Je],[w,me]],[/droid.+; (wt63?0{2,3})\)/i],[d,[_,qe],[w,me]],[/(quest( 2| pro)?)/i],[d,[_,we],[w,me]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[w,Ue]],[/(aeobc)\b/i],[d,[_,_e],[w,Ue]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[w,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[w,A]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,A]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,C]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[b,rt,Oe]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[b,rt,Oe]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,it],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,b],[/\(bb(10);/i],[b,[v,ot]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[v,G+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[v,Ee+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,B],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,b],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,b]]},J=function(x,N){if(typeof x===l&&(N=x,x=W),!(this instanceof J))return new J(x,N).getResult();var I=typeof re!==o&&re.navigator?re.navigator:W,F=x||(I&&I.userAgent?I.userAgent:""),ce=I&&I.userAgentData?I.userAgentData:W,$=N?ct(De,N):De,de=I&&I.userAgent==F;return this.getBrowser=function(){var O,Z={};return Z[v]=W,Z[b]=W,Ne.call(Z,F,$.browser),Z[k]=typeof(O=Z[b])===p?O.replace(/[^\d\.]/g,"").split(".")[0]:W,de&&I&&I.brave&&typeof I.brave.isBrave==h&&(Z[v]="Brave"),Z},this.getCPU=function(){var O={};return O[X]=W,Ne.call(O,F,$.cpu),O},this.getDevice=function(){var O={};return O[_]=W,O[d]=W,O[w]=W,Ne.call(O,F,$.device),de&&!O[w]&&ce&&ce.mobile&&(O[w]=C),de&&O[d]=="Macintosh"&&I&&typeof I.standalone!==o&&I.maxTouchPoints&&I.maxTouchPoints>2&&(O[d]="iPad",O[w]=A),O},this.getEngine=function(){var O={};return O[v]=W,O[b]=W,Ne.call(O,F,$.engine),O},this.getOS=function(){var O={};return O[v]=W,O[b]=W,Ne.call(O,F,$.os),de&&!O[v]&&ce&&ce.platform!="Unknown"&&(O[v]=ce.platform.replace(/chrome os/i,B).replace(/macos/i,it)),O},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return F},this.setUA=function(O){return F=typeof O===p&&O.length>350?Le(O,350):O,this},this.setUA(F),this};J.VERSION="1.0.35",J.BROWSER=ze([v,b,k]),J.CPU=ze([X]),J.DEVICE=ze([d,_,w,te,C,ie,A,me,Ue]),J.ENGINE=J.OS=ze([v,b]),typeof he!==o?(ne.exports&&(he=ne.exports=J),he.UAParser=J):L.amdO?(V=function(){return J}.call(K,L,K,ge))!==void 0&&(ge.exports=V):typeof re!==o&&(re.UAParser=J);var ye=typeof re!==o&&(re.jQuery||re.Zepto);if(ye&&!ye.ua){var Me=new J;ye.ua=Me.getResult(),ye.ua.get=function(){return Me.getUA()},ye.ua.set=function(x){Me.setUA(x);var N=Me.getResult();for(var I in N)ye.ua[I]=N[I]}}})(typeof window=="object"?window:this)}},pe={};function ue(ne){var he=pe[ne];if(he!==void 0)return he.exports;var re=pe[ne]={exports:{}},W=!0;try{Y[ne].call(re.exports,re,re.exports,ue),W=!1}finally{W&&delete pe[ne]}return re.exports}ue.ab="//";var Se=ue(226);ge.exports=Se})()},ke.__chunk_9037=(ge,K,L)=>{"use strict";L.d(K,{eI:()=>Si});let V=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(L.bind(L,3607)).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)};class Y extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class pe extends Y{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ue extends Y{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Se extends Y{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})($e||($e={}));class ne{constructor(e,{headers:t={},customFetch:i,region:r=$e.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=V(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var i,r,s,a,c;return r=this,s=void 0,a=void 0,c=function*(){try{let u,{headers:f,method:g,body:y}=t,m={},{region:S}=t;S||(S=this.region);let E=new URL(`${this.url}/${e}`);S&&S!=="any"&&(m["x-region"]=S,E.searchParams.set("forceFunctionRegion",S)),y&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)&&(typeof Blob<"u"&&y instanceof Blob||y instanceof ArrayBuffer?(m["Content-Type"]="application/octet-stream",u=y):typeof y=="string"?(m["Content-Type"]="text/plain",u=y):typeof FormData<"u"&&y instanceof FormData?u=y:(m["Content-Type"]="application/json",u=JSON.stringify(y)));let j=yield this.fetch(E.toString(),{method:g||"POST",headers:Object.assign(Object.assign(Object.assign({},m),this.headers),f),body:u}).catch(P=>{throw new pe(P)}),T=j.headers.get("x-relay-error");if(T&&T==="true")throw new ue(j);if(!j.ok)throw new Se(j);let z=((i=j.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim();return{data:z==="application/json"?yield j.json():z==="application/octet-stream"?yield j.blob():z==="text/event-stream"?j:z==="multipart/form-data"?yield j.formData():yield j.text(),error:null,response:j}}catch(u){return{data:null,error:u,response:u instanceof Se||u instanceof ue?u.context:void 0}}},new(a||(a=Promise))(function(u,f){function g(S){try{m(c.next(S))}catch(E){f(E)}}function y(S){try{m(c.throw(S))}catch(E){f(E)}}function m(S){var E;S.done?u(S.value):((E=S.value)instanceof a?E:new a(function(j){j(E)})).then(g,y)}m((c=c.apply(r,s||[])).next())})}}let{PostgrestClient:he,PostgrestQueryBuilder:re,PostgrestFilterBuilder:W,PostgrestTransformBuilder:h,PostgrestBuilder:o,PostgrestError:l}=L(7483),p=function(){if(typeof WebSocket<"u")return WebSocket;if(jt.WebSocket!==void 0)return jt.WebSocket;if(window.WebSocket!==void 0)return window.WebSocket;if(Pe.WebSocket!==void 0)return Pe.WebSocket;throw Error("`WebSocket` is not supported in this environment")}();(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(xe||(xe={})),function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"}(H||(H={})),function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"}(se||(se={})),(qe||(qe={})).websocket="websocket",function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"}(we||(we={}));class k{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let t=new DataView(e),i=new TextDecoder;return this._decodeBroadcast(e,t,i)}_decodeBroadcast(e,t,i){let r=t.getUint8(1),s=t.getUint8(2),a=this.HEADER_LENGTH+2,c=i.decode(e.slice(a,a+r));a+=r;let u=i.decode(e.slice(a,a+s));return a+=s,{ref:null,topic:c,event:u,payload:JSON.parse(i.decode(e.slice(a,e.byteLength)))}}}class d{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(B||(B={}));let v=(n,e,t={})=>{var i;let r=(i=t.skipTypes)!==null&&i!==void 0?i:[];return Object.keys(e).reduce((s,a)=>(s[a]=w(a,n,e,r),s),{})},w=(n,e,t,i)=>{let r=e.find(c=>c.name===n),s=r?.type,a=t[n];return s&&!i.includes(s)?_(s,a):b(a)},_=(n,e)=>{if(n.charAt(0)==="_")return A(e,n.slice(1,n.length));switch(n){case B.bool:return X(e);case B.float4:case B.float8:case B.int2:case B.int4:case B.int8:case B.numeric:case B.oid:return te(e);case B.json:case B.jsonb:return C(e);case B.timestamp:return ie(e);case B.abstime:case B.date:case B.daterange:case B.int4range:case B.int8range:case B.money:case B.reltime:case B.text:case B.time:case B.timestamptz:case B.timetz:case B.tsrange:case B.tstzrange:default:return b(e)}},b=n=>n,X=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},te=n=>{if(typeof n=="string"){let e=parseFloat(n);if(!Number.isNaN(e))return e}return n},C=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){console.log(`JSON parse error: ${e}`)}return n},A=(n,e)=>{if(typeof n!="string")return n;let t=n.length-1,i=n[t];if(n[0]==="{"&&i==="}"){let r,s=n.slice(1,t);try{r=JSON.parse("["+s+"]")}catch{r=s?s.split(","):[]}return r.map(a=>_(e,a))}return n},ie=n=>typeof n=="string"?n.replace(" ","T"):n,me=n=>{let e=n;return(e=(e=e.replace(/^ws/i,"http")).replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,"")).replace(/\/+$/,"")};class Ue{constructor(e,t,i={},r=1e4){this.channel=e,this.event=t,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(it||(it={}));class _e{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let i=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},r=>{let{onJoin:s,onLeave:a,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_e.syncState(this.state,r,s,a),this.pendingDiffs.forEach(u=>{this.state=_e.syncDiff(this.state,u,s,a)}),this.pendingDiffs=[],c()}),this.channel._on(i.diff,{},r=>{let{onJoin:s,onLeave:a,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=_e.syncDiff(this.state,r,s,a),c())}),this.onJoin((r,s,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:s,newPresences:a})}),this.onLeave((r,s,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:s,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,r){let s=this.cloneDeep(e),a=this.transformState(t),c={},u={};return this.map(s,(f,g)=>{a[f]||(u[f]=g)}),this.map(a,(f,g)=>{let y=s[f];if(y){let m=g.map(T=>T.presence_ref),S=y.map(T=>T.presence_ref),E=g.filter(T=>0>S.indexOf(T.presence_ref)),j=y.filter(T=>0>m.indexOf(T.presence_ref));E.length>0&&(c[f]=E),j.length>0&&(u[f]=j)}else c[f]=g}),this.syncDiff(s,{joins:c,leaves:u},i,r)}static syncDiff(e,t,i,r){let{joins:s,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(s,(c,u)=>{var f;let g=(f=e[c])!==null&&f!==void 0?f:[];if(e[c]=this.cloneDeep(u),g.length>0){let y=e[c].map(S=>S.presence_ref),m=g.filter(S=>0>y.indexOf(S.presence_ref));e[c].unshift(...m)}i(c,g,u)}),this.map(a,(c,u)=>{let f=e[c];if(!f)return;let g=u.map(y=>y.presence_ref);f=f.filter(y=>0>g.indexOf(y.presence_ref)),e[c]=f,r(c,f,u),f.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,i)=>{let r=e[i];return"metas"in r?t[i]=r.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[i]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ct||(ct={})),function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"}(ze||(ze={})),function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"}(le||(le={}));class ve{constructor(e,t={config:{}},i){this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=H.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ue(this,se.join,this.params,this.timeout),this.rejoinTimer=new d(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=H.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=H.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this._on(se.reply,{},(r,s)=>{this._trigger(this._replyEventName(s),r)}),this.presence=new _e(this),this.broadcastEndpointURL=me(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var i,r;if(this.socket.isConnected()||this.socket.connect(),this.state==H.closed){let{config:{broadcast:s,presence:a,private:c}}=this.params;this._onError(g=>e?.(le.CHANNEL_ERROR,g)),this._onClose(()=>e?.(le.CLOSED));let u={},f={broadcast:s,presence:a,postgres_changes:(r=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(g=>g.filter))!==null&&r!==void 0?r:[],private:c};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:f},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var y;if(this.socket.setAuth(),g===void 0){e?.(le.SUBSCRIBED);return}{let m=this.bindings.postgres_changes,S=(y=m?.length)!==null&&y!==void 0?y:0,E=[];for(let j=0;j<S;j++){let T=m[j],{filter:{event:z,schema:P,table:D,filter:U}}=T,Q=g&&g[j];if(Q&&Q.event===z&&Q.schema===P&&Q.table===D&&Q.filter===U)E.push(Object.assign(Object.assign({},T),{id:Q.id}));else{this.unsubscribe(),this.state=H.errored,e?.(le.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=E,e&&e(le.SUBSCRIBED);return}}).receive("error",g=>{this.state=H.errored,e?.(le.CHANNEL_ERROR,Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e?.(le.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this._on(e,t,i)}async send(e,t={}){var i,r;if(this._canPush()||e.type!=="broadcast")return new Promise(s=>{var a,c,u;let f=this._push(e.type,e,t.timeout||this.timeout);e.type!=="broadcast"||((u=(c=(a=this.params)===null||a===void 0?void 0:a.config)===null||c===void 0?void 0:c.broadcast)===null||u===void 0?void 0:u.ack)||s("ok"),f.receive("ok",()=>s("ok")),f.receive("error",()=>s("error")),f.receive("timeout",()=>s("timed out"))});{let{event:s,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})};try{let u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((r=u.body)===null||r===void 0?void 0:r.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=H.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(se.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(r=>{(i=new Ue(this,se.leave,{},e)).receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,i){let r=new AbortController,s=setTimeout(()=>r.abort(),i),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(s),a}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Ue(this,e,t,i);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var r,s;let a=e.toLocaleLowerCase(),{close:c,error:u,leave:f,join:g}=se;if(i&&[c,u,f,g].indexOf(a)>=0&&i!==this._joinRef())return;let y=this._onMessage(a,t,i);if(t&&!y)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(m=>{var S,E,j;return((S=m.filter)===null||S===void 0?void 0:S.event)==="*"||((j=(E=m.filter)===null||E===void 0?void 0:E.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===a}).map(m=>m.callback(y,i)):(s=this.bindings[a])===null||s===void 0||s.filter(m=>{var S,E,j,T,z,P;if(!["broadcast","presence","postgres_changes"].includes(a))return m.type.toLocaleLowerCase()===a;if("id"in m){let D=m.id,U=(S=m.filter)===null||S===void 0?void 0:S.event;return D&&((E=t.ids)===null||E===void 0?void 0:E.includes(D))&&(U==="*"||U?.toLocaleLowerCase()===((j=t.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}{let D=(z=(T=m?.filter)===null||T===void 0?void 0:T.event)===null||z===void 0?void 0:z.toLocaleLowerCase();return D==="*"||D===((P=t?.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}}).map(m=>{if(typeof y=="object"&&"ids"in y){let S=y.data,{schema:E,table:j,commit_timestamp:T,type:z,errors:P}=S;y=Object.assign(Object.assign({},{schema:E,table:j,commit_timestamp:T,eventType:z,new:{},old:{},errors:P}),this._getPayloadRecords(S))}m.callback(y,i)})}_isClosed(){return this.state===H.closed}_isJoined(){return this.state===H.joined}_isJoining(){return this.state===H.joining}_isLeaving(){return this.state===H.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){let r=e.toLocaleLowerCase(),s={type:r,filter:t,callback:i};return this.bindings[r]?this.bindings[r].push(s):this.bindings[r]=[s],this}_off(e,t){let i=e.toLocaleLowerCase();return this.bindings[i]=this.bindings[i].filter(r=>{var s;return!(((s=r.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===i&&ve.isEqual(r.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let i in e)if(e[i]!==t[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(se.close,{},e)}_onError(e){this._on(se.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=H.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=v(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=v(e.columns,e.old_record)),t}}let tt=()=>{},ot=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Te{constructor(e,t){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=tt,this.ref=0,this.logger=tt,this.conn=null,this.sendBuffer=[],this.serializer=new k,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let a;return s?a=s:typeof fetch>"u"?a=(...c)=>Promise.resolve().then(L.bind(L,3607)).then(({default:u})=>u(...c)):a=fetch,(...c)=>a(...c)},this.endPoint=`${e}/${qe.websocket}`,this.httpEndpoint=me(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let r=(i=t?.params)===null||i===void 0?void 0:i.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=t?.encode?t.encode:(s,a)=>a(JSON.stringify(s)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new d(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=p),!this.transport)throw Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(i=>i.teardown()))}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case xe.connecting:return we.Connecting;case xe.open:return we.Open;case xe.closing:return we.Closing;default:return we.Closed}}isConnected(){return this.connectionState()===we.Open}channel(e,t={config:{}}){let i=`realtime:${e}`,r=this.getChannels().find(s=>s.topic===i);if(r)return r;{let s=new ve(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){let{topic:t,event:i,payload:r,ref:s}=e,a=()=>{this.encode(e,c=>{var u;(u=this.conn)===null||u===void 0||u.send(c)})};this.log("push",`${t} ${i} (${s})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t,version:"realtime-js/2.11.15"}),i.joinedOnce&&i._isJoined()&&i._push(se.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(1e3,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:i,event:r,payload:s,ref:a}=t;i==="phoenix"&&r==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${i} ${r} ${a&&"("+a+")"||""}`,s),Array.from(this.channels).filter(c=>c._isMember(i)).forEach(c=>c._trigger(r,s,a)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(se.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let i=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${i}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{let i=new Blob([ot],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}}class Ee extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function G(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Je extends Ee{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class He extends Ee{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let Ve=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(L.bind(L,3607)).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},lt=()=>function(n,e,t,i){return new(t||(t=Promise))(function(r,s){function a(f){try{u(i.next(f))}catch(g){s(g)}}function c(f){try{u(i.throw(f))}catch(g){s(g)}}function u(f){var g;f.done?r(f.value):((g=f.value)instanceof t?g:new t(function(y){y(g)})).then(a,c)}u((i=i.apply(n,e||[])).next())})}(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(L.bind(L,3607))).Response:Response}),je=n=>{if(Array.isArray(n))return n.map(t=>je(t));if(typeof n=="function"||n!==Object(n))return n;let e={};return Object.entries(n).forEach(([t,i])=>{e[t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""))]=je(i)}),e};var $e,xe,H,se,qe,we,B,it,ct,ze,le,oe=function(n,e,t,i){return new(t||(t=Promise))(function(r,s){function a(f){try{u(i.next(f))}catch(g){s(g)}}function c(f){try{u(i.throw(f))}catch(g){s(g)}}function u(f){var g;f.done?r(f.value):((g=f.value)instanceof t?g:new t(function(y){y(g)})).then(a,c)}u((i=i.apply(n,e||[])).next())})};let Le=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ne=(n,e,t)=>oe(void 0,void 0,void 0,function*(){n instanceof(yield lt())&&!t?.noResolveJson?n.json().then(i=>{e(new Je(Le(i),n.status||500))}).catch(i=>{e(new He(Le(i),i))}):e(new He(Le(n),n))}),rt=(n,e,t,i)=>{let r={method:n,headers:e?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i&&(r.body=JSON.stringify(i)),Object.assign(Object.assign({},r),t))};function Oe(n,e,t,i,r,s){return oe(this,void 0,void 0,function*(){return new Promise((a,c)=>{n(t,rt(e,i,r,s)).then(u=>{if(!u.ok)throw u;return i?.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>Ne(u,c,i))})})}function De(n,e,t,i){return oe(this,void 0,void 0,function*(){return Oe(n,"GET",e,t,i)})}function J(n,e,t,i,r){return oe(this,void 0,void 0,function*(){return Oe(n,"POST",e,i,r,t)})}function ye(n,e,t,i,r){return oe(this,void 0,void 0,function*(){return Oe(n,"DELETE",e,i,r,t)})}var Me=L(6195).Buffer,x=function(n,e,t,i){return new(t||(t=Promise))(function(r,s){function a(f){try{u(i.next(f))}catch(g){s(g)}}function c(f){try{u(i.throw(f))}catch(g){s(g)}}function u(f){var g;f.done?r(f.value):((g=f.value)instanceof t?g:new t(function(y){y(g)})).then(a,c)}u((i=i.apply(n,e||[])).next())})};let N={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},I={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class F{constructor(e,t={},i,r){this.url=e,this.headers=t,this.bucketId=i,this.fetch=Ve(r)}uploadOrUpdate(e,t,i,r){return x(this,void 0,void 0,function*(){try{let s,a=Object.assign(Object.assign({},I),r),c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)}),u=a.metadata;typeof Blob<"u"&&i instanceof Blob?((s=new FormData).append("cacheControl",a.cacheControl),u&&s.append("metadata",this.encodeMetadata(u)),s.append("",i)):typeof FormData<"u"&&i instanceof FormData?((s=i).append("cacheControl",a.cacheControl),u&&s.append("metadata",this.encodeMetadata(u))):(s=i,c["cache-control"]=`max-age=${a.cacheControl}`,c["content-type"]=a.contentType,u&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),r?.headers&&(c=Object.assign(Object.assign({},c),r.headers));let f=this._removeEmptyFolders(t),g=this._getFinalPath(f),y=yield this.fetch(`${this.url}/object/${g}`,Object.assign({method:e,body:s,headers:c},a?.duplex?{duplex:a.duplex}:{})),m=yield y.json();return y.ok?{data:{path:f,id:m.Id,fullPath:m.Key},error:null}:{data:null,error:m}}catch(s){if(G(s))return{data:null,error:s};throw s}})}upload(e,t,i){return x(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,i)})}uploadToSignedUrl(e,t,i,r){return x(this,void 0,void 0,function*(){let s=this._removeEmptyFolders(e),a=this._getFinalPath(s),c=new URL(this.url+`/object/upload/sign/${a}`);c.searchParams.set("token",t);try{let u,f=Object.assign({upsert:I.upsert},r),g=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&i instanceof Blob?((u=new FormData).append("cacheControl",f.cacheControl),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i).append("cacheControl",f.cacheControl):(u=i,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType);let y=yield this.fetch(c.toString(),{method:"PUT",body:u,headers:g}),m=yield y.json();return y.ok?{data:{path:s,fullPath:m.Key},error:null}:{data:null,error:m}}catch(u){if(G(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e,t){return x(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),r=Object.assign({},this.headers);t?.upsert&&(r["x-upsert"]="true");let s=yield J(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:r}),a=new URL(this.url+s.url),c=a.searchParams.get("token");if(!c)throw new Ee("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:c},error:null}}catch(i){if(G(i))return{data:null,error:i};throw i}})}update(e,t,i){return x(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,i)})}move(e,t,i){return x(this,void 0,void 0,function*(){try{return{data:yield J(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}copy(e,t,i){return x(this,void 0,void 0,function*(){try{return{data:{path:(yield J(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,i){return x(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),s=yield J(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:this.headers}),a=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:s={signedUrl:encodeURI(`${this.url}${s.signedURL}${a}`)},error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,i){return x(this,void 0,void 0,function*(){try{let r=yield J(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:r.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${s}`):null})),error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}download(e,t){return x(this,void 0,void 0,function*(){let i=t?.transform!==void 0,r=this.transformOptsToQueryString(t?.transform||{}),s=r?`?${r}`:"";try{let a=this._getFinalPath(e);return{data:yield(yield De(this.fetch,`${this.url}/${i?"render/image/authenticated":"object"}/${a}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(G(a))return{data:null,error:a};throw a}})}info(e){return x(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let i=yield De(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:je(i),error:null}}catch(i){if(G(i))return{data:null,error:i};throw i}})}exists(e){return x(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield function(i,r,s,a){return oe(this,void 0,void 0,function*(){return Oe(i,"HEAD",r,Object.assign(Object.assign({},s),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(G(i)&&i instanceof He){let r=i.originalError;if([400,404].includes(r?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,t){let i=this._getFinalPath(e),r=[],s=t?.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&r.push(s);let a=t?.transform!==void 0,c=this.transformOptsToQueryString(t?.transform||{});c!==""&&r.push(c);let u=r.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a?"render/image":"object"}/public/${i}${u}`)}}}remove(e){return x(this,void 0,void 0,function*(){try{return{data:yield ye(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}list(e,t,i){return x(this,void 0,void 0,function*(){try{let r=Object.assign(Object.assign(Object.assign({},N),t),{prefix:e||""});return{data:yield J(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},i),error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return Me!==void 0?Me.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let ce={"X-Client-Info":"storage-js/2.7.1"};var $=function(n,e,t,i){return new(t||(t=Promise))(function(r,s){function a(f){try{u(i.next(f))}catch(g){s(g)}}function c(f){try{u(i.throw(f))}catch(g){s(g)}}function u(f){var g;f.done?r(f.value):((g=f.value)instanceof t?g:new t(function(y){y(g)})).then(a,c)}u((i=i.apply(n,e||[])).next())})};class de{constructor(e,t={},i){this.url=e,this.headers=Object.assign(Object.assign({},ce),t),this.fetch=Ve(i)}listBuckets(){return $(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(G(e))return{data:null,error:e};throw e}})}getBucket(e){return $(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return $(this,void 0,void 0,function*(){try{return{data:yield J(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(G(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return $(this,void 0,void 0,function*(){try{return{data:yield function(i,r,s,a,c){return oe(this,void 0,void 0,function*(){return Oe(i,"PUT",r,a,void 0,s)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(G(i))return{data:null,error:i};throw i}})}emptyBucket(e){return $(this,void 0,void 0,function*(){try{return{data:yield J(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}deleteBucket(e){return $(this,void 0,void 0,function*(){try{return{data:yield ye(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}}class O extends de{constructor(e,t={},i){super(e,t,i)}from(e){return new F(this.url,this.headers,e,this.fetch)}}let Z="";typeof Deno<"u"?Z="deno":typeof document<"u"?Z="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Z="react-native":Z="node";let st={headers:{"X-Client-Info":`supabase-js-${Z}/2.51.0`}},ut={schema:"public"},Wt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Jt={};var xt=L(3607);let Ht=n=>{let e;return n?e=n:typeof fetch>"u"?e=xt.default:e=fetch,(...t)=>e(...t)},Vt=()=>typeof Headers>"u"?xt.Headers:Headers,Yt=(n,e,t)=>{let i=Ht(t),r=Vt();return(s,a)=>function(c,u,f,g){return new(f||(f=Promise))(function(y,m){function S(T){try{j(g.next(T))}catch(z){m(z)}}function E(T){try{j(g.throw(T))}catch(z){m(z)}}function j(T){var z;T.done?y(T.value):((z=T.value)instanceof f?z:new f(function(P){P(z)})).then(S,E)}j((g=g.apply(c,u||[])).next())})}(void 0,void 0,void 0,function*(){var c;let u=(c=yield e())!==null&&c!==void 0?c:n,f=new r(a?.headers);return f.has("apikey")||f.set("apikey",n),f.has("Authorization")||f.set("Authorization",`Bearer ${u}`),i(s,Object.assign(Object.assign({},a),{headers:f}))})},Ot="2.71.0",Xt={"X-Client-Info":`gotrue-js/${Ot}`},wt="X-Supabase-Api-Version",It={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Zt=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class mt extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function R(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Qt extends mt{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}class Ct extends mt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ie extends mt{constructor(e,t,i,r){super(e,i,r),this.name=t,this.status=i}}class Ce extends Ie{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ht extends Ie{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class dt extends Ie{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ft extends Ie{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Rt extends Ie{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class vt extends Ie{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function yt(n){return R(n)&&n.name==="AuthRetryableFetchError"}class At extends Ie{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class bt extends Ie{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Pt=` 	
\r=`.split(""),ei=(()=>{let n=Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Pt.length;e+=1)n[Pt[e].charCodeAt(0)]=-2;for(let e=0;e<gt.length;e+=1)n[gt[e].charCodeAt(0)]=e;return n})();function Ut(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;)t(gt[e.queue>>e.queuedBits-6&63]),e.queuedBits-=6;else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;)t(gt[e.queue>>e.queuedBits-6&63]),e.queuedBits-=6}function $t(n,e,t){let i=ei[n];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function qt(n){let e=[],t=a=>{e.push(String.fromCodePoint(a))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},s=a=>{(function(c,u,f){if(u.utf8seq===0){if(c<=127){f(c);return}for(let g=1;g<6;g+=1)if((c>>7-g&1)==0){u.utf8seq=g;break}if(u.utf8seq===2)u.codepoint=31&c;else if(u.utf8seq===3)u.codepoint=15&c;else if(u.utf8seq===4)u.codepoint=7&c;else throw Error("Invalid UTF-8 sequence");u.utf8seq-=1}else if(u.utf8seq>0){if(c<=127)throw Error("Invalid UTF-8 sequence");u.codepoint=u.codepoint<<6|63&c,u.utf8seq-=1,u.utf8seq===0&&f(u.codepoint)}})(a,i,t)};for(let a=0;a<n.length;a+=1)$t(n.charCodeAt(a),r,s);return e.join("")}let fe=()=>typeof window<"u"&&typeof document<"u",Be={tested:!1,writable:!1},zt=()=>{if(!fe())return!1;try{if(typeof ee.localStorage!="object")return!1}catch{return!1}if(Be.tested)return Be.writable;let n=`lswt-${Math.random()}${Math.random()}`;try{ee.localStorage.setItem(n,n),ee.localStorage.removeItem(n),Be.tested=!0,Be.writable=!0}catch{Be.tested=!0,Be.writable=!1}return Be.writable},Lt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(L.bind(L,3607)).then(({default:i})=>i(...t)):e=fetch,(...t)=>e(...t)},ti=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ye=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Fe=async(n,e)=>{let t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Re=async(n,e)=>{await n.removeItem(e)};class pt{constructor(){this.promise=new pt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function kt(n){let e=n.split(".");if(e.length!==3)throw new bt("Invalid JWT structure");for(let t=0;t<e.length;t++)if(!Zt.test(e[t]))throw new bt("JWT not in base64url format");return{header:JSON.parse(qt(e[0])),payload:JSON.parse(qt(e[1])),signature:function(t){let i=[],r={queue:0,queuedBits:0},s=a=>{i.push(a)};for(let a=0;a<t.length;a+=1)$t(t.charCodeAt(a),r,s);return new Uint8Array(i)}(e[2]),raw:{header:e[0],payload:e[1]}}}async function ii(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function ri(n){return("0"+n.toString(16)).substr(-2)}async function si(n){let e=new TextEncoder().encode(n);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",e))).map(t=>String.fromCharCode(t)).join("")}async function ni(n){return typeof crypto<"u"&&crypto.subtle!==void 0&&typeof TextEncoder<"u"?btoa(await si(n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n)}async function Xe(n,e,t=!1){let i=function(){let c=new Uint32Array(56);if(typeof crypto>"u"){let u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",f=u.length,g="";for(let y=0;y<56;y++)g+=u.charAt(Math.floor(Math.random()*f));return g}return crypto.getRandomValues(c),Array.from(c,ri).join("")}(),r=i;t&&(r+="/PASSWORD_RECOVERY"),await Ye(n,`${e}-code-verifier`,r);let s=await ni(i);return[s,i===s?"plain":"s256"]}pt.promiseConstructor=Promise;let ai=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,oi=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ze(n){if(!oi.test(n))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function St(){return new Proxy({},{get:(n,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){let t=e.toString();if(t==="Symbol(Symbol.toPrimitive)"||t==="Symbol(Symbol.toStringTag)"||t==="Symbol(util.inspect.custom)")return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(n,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(n,e)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var li=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&0>e.indexOf(i)&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};let Ge=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ci=[502,503,504];async function Nt(n){var e;let t,i;if(!ti(n))throw new vt(Ge(n),0);if(ci.includes(n.status))throw new vt(Ge(n),n.status);try{t=await n.json()}catch(s){throw new Ct(Ge(s),s)}let r=function(s){let a=s.headers.get(wt);if(!a||!a.match(ai))return null;try{return new Date(`${a}T00:00:00.0Z`)}catch{return null}}(n);if(r&&r.getTime()>=It["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new At(Ge(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new Ce}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0))throw new At(Ge(t),n.status,t.weak_password.reasons);throw new Qt(Ge(t),n.status||500,i)}let ui=(n,e,t,i)=>{let r={method:n,headers:e?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),t))};async function q(n,e,t,i){var r;let s=Object.assign({},i?.headers);s[wt]||(s[wt]=It["2024-01-01"].name),i?.jwt&&(s.Authorization=`Bearer ${i.jwt}`);let a=(r=i?.query)!==null&&r!==void 0?r:{};i?.redirectTo&&(a.redirect_to=i.redirectTo);let c=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=await hi(n,e,t+c,{headers:s,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(u):{data:Object.assign({},u),error:null}}async function hi(n,e,t,i,r,s){let a,c=ui(e,i,r,s);try{a=await n(t,Object.assign({},c))}catch(u){throw console.error(u),new vt(Ge(u),0)}if(a.ok||await Nt(a),i?.noResolveJson)return a;try{return await a.json()}catch(u){await Nt(u)}}function be(n){var e,t;let i=null;return n.access_token&&n.refresh_token&&n.expires_in&&(i=Object.assign({},n),!n.expires_at)&&(i.expires_at=(t=n.expires_in,Math.round(Date.now()/1e3)+t)),{data:{session:i,user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Dt(n){let e=be(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ae(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function di(n){return{data:n,error:null}}function fi(n){let{action_link:e,email_otp:t,hashed_token:i,redirect_to:r,verification_type:s}=n;return{data:{properties:{action_link:e,email_otp:t,hashed_token:i,redirect_to:r,verification_type:s},user:Object.assign({},li(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function gi(n){return n}let Tt=["global","local","others"];var pi=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&0>e.indexOf(i)&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t};class _i{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=Lt(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Tt[0]){if(0>Tt.indexOf(t))throw Error(`@supabase/auth-js: Parameter scope must be one of ${Tt.join(", ")}`);try{return await q(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await q(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ae})}catch(i){if(R(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{let{options:t}=e,i=pi(e,["options"]),r=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(r.new_email=i?.newEmail,delete r.newEmail),await q(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:fi,redirectTo:t?.redirectTo})}catch(t){if(R(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await q(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ae})}catch(t){if(R(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,r,s,a,c,u;try{let f={nextPage:null,lastPage:0,total:0},g=await q(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(s=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:""},xform:gi});if(g.error)throw g.error;let y=await g.json(),m=(a=g.headers.get("x-total-count"))!==null&&a!==void 0?a:0,S=(u=(c=g.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&u!==void 0?u:[];return S.length>0&&(S.forEach(E=>{let j=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),T=JSON.parse(E.split(";")[1].split("=")[1]);f[`${T}Page`]=j}),f.total=parseInt(m)),{data:Object.assign(Object.assign({},y),f),error:null}}catch(f){if(R(f))return{data:{users:[]},error:f};throw f}}async getUserById(e){Ze(e);try{return await q(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ae})}catch(t){if(R(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ze(e);try{return await q(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ae})}catch(i){if(R(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){Ze(e);try{return await q(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ae})}catch(i){if(R(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){Ze(e.userId);try{let{data:t,error:i}=await q(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:i}}catch(t){if(R(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ze(e.userId),Ze(e.id);try{return{data:await q(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}}}function Mt(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}let Qe={debug:!!(ee&&zt()&&ee.localStorage&&ee.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Bt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class wi extends Bt{}async function mi(n,e,t){Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);let i=new ee.AbortController;return e>0&&setTimeout(()=>{i.abort(),Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>ee.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async r=>{if(r){Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return await t()}finally{Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(e===0)throw Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new wi(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Qe.debug)try{let s=await ee.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}(function(){if(typeof ee!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof Pe<"u"&&(Pe.globalThis=Pe)}})();let vi={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Xt,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ft(n,e,t){return await t()}let et={};class nt{constructor(e){var t,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=nt.nextInstanceID,nt.nextInstanceID+=1,this.instanceID>0&&fe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let r=Object.assign(Object.assign({},vi),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new _i({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Lt(r.fetch),this.lock=r.lock||Ft,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:fe()&&((t=ee?.navigator)===null||t===void 0?void 0:t.locks)?this.lock=mi:this.lock=Ft,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:zt()?this.storage=ee.localStorage:(this.memoryStorage={},this.storage=Mt(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Mt(this.memoryStorage)),fe()&&ee.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new ee.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=et[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){et[this.storageKey]=Object.assign(Object.assign({},et[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=et[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){et[this.storageKey]=Object.assign(Object.assign({},et[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ot}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t=function(r){let s={},a=new URL(r);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((c,u)=>{s[u]=c})}catch{}return a.searchParams.forEach((c,u)=>{s[u]=c}),s}(window.location.href),i="none";if(this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce"),fe()&&this.detectSessionInUrl&&i!=="none"){let{data:r,error:s}=await this._getSessionFromURL(t,i);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),R(s)&&s.name==="AuthImplicitGrantRedirectError"){let u=(e=s.details)===null||e===void 0?void 0:e.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:c}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",c),await this._saveSession(a),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return R(t)?{error:t}:{error:new Ct("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,r;try{let{data:s,error:a}=await q(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(r=e?.options)===null||r===void 0?void 0:r.captchaToken}},xform:be});if(a||!s)return{data:{user:null,session:null},error:a};let c=s.session,u=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(R(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var t,i,r;try{let s;if("email"in e){let{email:g,password:y,options:m}=e,S=null,E=null;this.flowType==="pkce"&&([S,E]=await Xe(this.storage,this.storageKey)),s=await q(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m?.emailRedirectTo,body:{email:g,password:y,data:(t=m?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:m?.captchaToken},code_challenge:S,code_challenge_method:E},xform:be})}else if("phone"in e){let{phone:g,password:y,options:m}=e;s=await q(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:y,data:(i=m?.data)!==null&&i!==void 0?i:{},channel:(r=m?.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:m?.captchaToken}},xform:be})}else throw new dt("You must provide either an email or phone number and a password");let{data:a,error:c}=s;if(c||!a)return{data:{user:null,session:null},error:c};let u=a.session,f=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:f,session:u},error:null}}catch(s){if(R(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let t;if("email"in e){let{email:s,password:a,options:c}=e;t=await q(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Dt})}else if("phone"in e){let{phone:s,password:a,options:c}=e;t=await q(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Dt})}else throw new dt("You must provide either an email or phone number and a password");let{data:i,error:r}=t;return r?{data:{user:null,session:null},error:r}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new ht}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:r})}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,i,r,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,i,r,s,a,c,u,f,g,y,m,S;let E,j;if("message"in e)E=e.message,j=e.signature;else{let T,{chain:z,wallet:P,statement:D,options:U}=e;if(fe())if(typeof P=="object")T=P;else{let M=window;if("solana"in M&&typeof M.solana=="object"&&("signIn"in M.solana&&typeof M.solana.signIn=="function"||"signMessage"in M.solana&&typeof M.solana.signMessage=="function"))T=M.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof P!="object"||!U?.url)throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=P}let Q=new URL((t=U?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in T&&T.signIn){let M,ae=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},U?.signInWithSolana),{version:"1",domain:Q.host,uri:Q.href}),D?{statement:D}:null));if(Array.isArray(ae)&&ae[0]&&typeof ae[0]=="object")M=ae[0];else if(ae&&typeof ae=="object"&&"signedMessage"in ae&&"signature"in ae)M=ae;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)E=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),j=M.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${Q.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...D?["",D,""]:[""],"Version: 1",`URI: ${Q.href}`,`Issued At: ${(r=(i=U?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((s=U?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${U.signInWithSolana.notBefore}`]:[],...!((a=U?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${U.signInWithSolana.expirationTime}`]:[],...!((c=U?.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${U.signInWithSolana.chainId}`]:[],...!((u=U?.signInWithSolana)===null||u===void 0)&&u.nonce?[`Nonce: ${U.signInWithSolana.nonce}`]:[],...!((f=U?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${U.signInWithSolana.requestId}`]:[],...!((y=(g=U?.signInWithSolana)===null||g===void 0?void 0:g.resources)===null||y===void 0)&&y.length?["Resources",...U.signInWithSolana.resources.map(ae=>`- ${ae}`)]:[]].join(`
`);let M=await T.signMessage(new TextEncoder().encode(E),"utf8");if(!M||!(M instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");j=M}}try{let{data:T,error:z}=await q(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:function(P){let D=[],U={queue:0,queuedBits:0},Q=M=>{D.push(M)};return P.forEach(M=>Ut(M,U,Q)),Ut(null,U,Q),D.join("")}(j)},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(S=e.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:be});if(z)throw z;return!T||!T.session||!T.user?{data:{user:null,session:null},error:new ht}:(T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),{data:Object.assign({},T),error:z})}catch(T){if(R(T))return{data:{user:null,session:null},error:T};throw T}}async _exchangeCodeForSession(e){let t=await Fe(this.storage,`${this.storageKey}-code-verifier`),[i,r]=(t??"").split("/");try{let{data:s,error:a}=await q(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:be});if(await Re(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new ht}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:r??null}),error:a})}catch(s){if(R(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:t,provider:i,token:r,access_token:s,nonce:a}=e,{data:c,error:u}=await q(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:r,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:be});return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new ht}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,i,r,s,a;try{if("email"in e){let{email:c,options:u}=e,f=null,g=null;this.flowType==="pkce"&&([f,g]=await Xe(this.storage,this.storageKey));let{error:y}=await q(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=u?.data)!==null&&t!==void 0?t:{},create_user:(i=u?.shouldCreateUser)===null||i===void 0||i,gotrue_meta_security:{captcha_token:u?.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:u?.emailRedirectTo});return{data:{user:null,session:null},error:y}}if("phone"in e){let{phone:c,options:u}=e,{data:f,error:g}=await q(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(r=u?.data)!==null&&r!==void 0?r:{},create_user:(s=u?.shouldCreateUser)===null||s===void 0||s,gotrue_meta_security:{captcha_token:u?.captchaToken},channel:(a=u?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:f?.message_id},error:g}}throw new dt("You must provide either an email or phone number.")}catch(c){if(R(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,i;try{let r,s;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(i=e.options)===null||i===void 0?void 0:i.captchaToken);let{data:a,error:c}=await q(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:r,xform:be});if(c)throw c;if(!a)throw Error("An error occurred on token verification.");let u=a.session,f=a.user;return u?.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),{data:{user:f,session:u},error:null}}catch(r){if(R(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,i,r;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await Xe(this.storage,this.storageKey)),await q(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((r=e?.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:di})}catch(s){if(R(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new Ce;let{error:r}=await q(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(R(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:i,type:r,options:s}=e,{error:a}=await q(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:r,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){let{phone:i,type:r,options:s}=e,{data:a,error:c}=await q(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:r,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:c}}throw new dt("You must provide either an email or phone number and a type")}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){let r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let e=null,t=await Fe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let i=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){let a=await Fe(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=St()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,f)=>(a||u!=="user"||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,f))})}return{data:{session:e},error:null}}let{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await q(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ae}):await this._useSession(async t=>{var i,r,s;let{data:a,error:c}=t;if(c)throw c;return((i=a.session)===null||i===void 0?void 0:i.access_token)||this.hasCustomAuthorizationHeader?await q(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0,xform:Ae}):{data:{user:null},error:new Ce}})}catch(t){if(R(t))return R(t)&&t.name==="AuthSessionMissingError"&&(await this._removeSession(),await Re(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{let{data:r,error:s}=i;if(s)throw s;if(!r.session)throw new Ce;let a=r.session,c=null,u=null;this.flowType==="pkce"&&e.email!=null&&([c,u]=await Xe(this.storage,this.storageKey));let{data:f,error:g}=await q(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:u}),jwt:a.access_token,xform:Ae});if(g)throw g;return a.user=f.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(i){if(R(i))return{data:{user:null},error:i};throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ce;let t=Date.now()/1e3,i=t,r=!0,s=null,{payload:a}=kt(e.access_token);if(a.exp&&(r=(i=a.exp)<=t),r){let{session:c,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!c)return{data:{user:null,session:null},error:null};s=c}else{let{data:c,error:u}=await this._getUser(e.access_token);if(u)throw u;s={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(R(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){let{data:a,error:c}=t;if(c)throw c;e=(i=a.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new Ce;let{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(R(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!fe())throw new ft("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ft(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Rt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ft("Not a valid implicit grant flow url.")}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Rt("No code detected.");let{data:P,error:D}=await this._exchangeCodeForSession(e.code);if(D)throw D;let U=new URL(window.location.href);return U.searchParams.delete("code"),window.history.replaceState(window.history.state,"",U.toString()),{data:{session:P.session,redirectType:null},error:null}}let{provider_token:i,provider_refresh_token:r,access_token:s,refresh_token:a,expires_in:c,expires_at:u,token_type:f}=e;if(!s||!c||!a||!f)throw new ft("No session defined in URL");let g=Math.round(Date.now()/1e3),y=parseInt(c),m=g+y;u&&(m=parseInt(u));let S=m-g;1e3*S<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${y}s`);let E=m-y;g-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,m,g):g-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,m,g);let{data:j,error:T}=await this._getUser(s);if(T)throw T;let z={provider_token:i,provider_refresh_token:r,access_token:s,expires_in:y,expires_at:m,refresh_token:a,token_type:f,user:j.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:z,redirectType:e.type},error:null}}catch(i){if(R(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await Fe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;let{data:r,error:s}=t;if(s)return{error:s};let a=(i=r.session)===null||i===void 0?void 0:i.access_token;if(a){let{error:c}=await this.admin.signOut(a,e);if(c&&!(R(c)&&c.name==="AuthApiError"&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await Re(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let s=16*Math.random()|0;return(r=="x"?s:3&s|8).toString(16)}),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,r;try{let{data:{session:s},error:a}=t;if(a)throw a;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let i=null,r=null;this.flowType==="pkce"&&([i,r]=await Xe(this.storage,this.storageKey,!0));try{return await q(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(R(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:t,error:i}=await this.getUser();if(i)throw i;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{let{data:i,error:r}=await this._useSession(async s=>{var a,c,u,f,g;let{data:y,error:m}=s;if(m)throw m;let S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await q(this.fetch,"GET",S,{headers:this.headers,jwt:(g=(f=y.session)===null||f===void 0?void 0:f.access_token)!==null&&g!==void 0?g:void 0})});if(r)throw r;return!fe()||((t=e.options)===null||t===void 0?void 0:t.skipBrowserRedirect)||window.location.assign(i?.url),{data:{provider:e.provider,url:i?.url},error:null}}catch(i){if(R(i))return{data:{provider:e.provider,url:null},error:i};throw i}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,r;let{data:s,error:a}=t;if(a)throw a;return await q(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(i=s.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(R(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var i,r;let s=Date.now();return await(i=async a=>(a>0&&await ii(200*Math.pow(2,a-1)),this._debug(t,"refreshing attempt",a),await q(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:be})),r=(a,c)=>c&&yt(c)&&Date.now()+200*Math.pow(2,a)-s<3e4,new Promise((a,c)=>{(async()=>{for(let u=0;u<1/0;u++)try{let f=await i(u);if(!r(u,null,f)){a(f);return}}catch(f){if(!r(u,f)){c(f);return}}})()}))}catch(s){if(this._debug(t,"error",s),R(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),fe()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,t;let i="#_recoverAndRefresh()";this._debug(i,"begin");try{let r=await Fe(this.storage,this.storageKey);if(r&&this.userStorage){let a=await Fe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:r.user},await Ye(this.userStorage,this.storageKey+"-user",a)),r.user=(e=a?.user)!==null&&e!==void 0?e:St()}else if(r&&!r.user&&!r.user){let a=await Fe(this.storage,this.storageKey+"-user");a&&a?.user?(r.user=a.user,await Re(this.storage,this.storageKey+"-user"),await Ye(this.storage,this.storageKey,r)):r.user=St()}if(this._debug(i,"session from storage",r),!this._isValidSession(r)){this._debug(i,"session is not valid"),r!==null&&await this._removeSession();return}let s=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<9e4;if(this._debug(i,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&r.refresh_token){let{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),yt(a)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{let{data:a,error:c}=await this._getUser(r.access_token);!c&&a?.user?(r.user=a.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(i,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(i,"error",r),console.error(r);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new Ce;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new pt;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Ce;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let c={session:s.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(s){if(this._debug(r,"error",s),R(s)){let a={session:null,error:s};return yt(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(s),s}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,i=!0){let r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(u){s.push(u)}});if(await Promise.all(a),s.length>0){for(let c=0;c<s.length;c+=1)console.error(s[c]);throw s[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let t=Object.assign({},e),i=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&t.user&&await Ye(this.userStorage,this.storageKey+"-user",{user:t.user});let r=Object.assign({},t);delete r.user;let s=structuredClone(r);await Ye(this.storage,this.storageKey,s)}else{let r=structuredClone(t);await Ye(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),await Re(this.storage,this.storageKey),await Re(this.storage,this.storageKey+"-code-verifier"),await Re(this.storage,this.storageKey+"-user"),this.userStorage&&await Re(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&fe()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let r=Math.floor((1e3*i.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Bt)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fe()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){let r=[`provider=${encodeURIComponent(t)}`];if(i?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&r.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){let[s,a]=await Xe(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(c.toString())}if(i?.queryParams){let s=new URLSearchParams(i.queryParams);r.push(s.toString())}return i?.skipBrowserRedirect&&r.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;let{data:r,error:s}=t;return s?{data:null,error:s}:await q(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(R(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,r;let{data:s,error:a}=t;if(a)return{data:null,error:a};let c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:u,error:f}=await q(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token});return f?{data:null,error:f}:(e.factorType==="totp"&&((r=u?.totp)===null||r===void 0?void 0:r.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),{data:u,error:null})})}catch(t){if(R(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;let{data:r,error:s}=t;if(s)return{data:null,error:s};let{data:a,error:c}=await q(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:c})})}catch(t){if(R(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;let{data:r,error:s}=t;return s?{data:null,error:s}:await q(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(R(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){let{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?{data:null,error:i}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){let{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};let i=e?.factors||[],r=i.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=i.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:i,totp:r,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,i;let{data:{session:r},error:s}=e;if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:a}=kt(r.access_token),c=null;a.aal&&(c=a.aal);let u=c;return((i=(t=r.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(u="aal2"),{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:a.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(c=>c.kid===e);if(i)return i;let r=Date.now();if((i=this.jwks.keys.find(c=>c.kid===e))&&this.jwks_cached_at+6e5>r)return i;let{data:s,error:a}=await q(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return s.keys&&s.keys.length!==0&&(this.jwks=s,this.jwks_cached_at=r,i=s.keys.find(c=>c.kid===e))?i:null}async getClaims(e,t={}){try{let i=e;if(!i){let{data:m,error:S}=await this.getSession();if(S||!m.session)return{data:null,error:S};i=m.session.access_token}let{header:r,payload:s,signature:a,raw:{header:c,payload:u}}=kt(i);t?.allowExpired||function(m){if(!m)throw Error("Missing exp claim");if(m<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(s.exp);let f=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in ee&&"subtle"in ee.crypto)?null:await this.fetchJwk(r.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!f){let{error:m}=await this.getUser(i);if(m)throw m;return{data:{claims:s,header:r,signature:a},error:null}}let g=function(m){switch(m){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(r.alg),y=await crypto.subtle.importKey("jwk",f,g,!0,["verify"]);if(!await crypto.subtle.verify(g,y,a,function(m){let S=[];return function(E,j){for(let T=0;T<E.length;T+=1){let z=E.charCodeAt(T);if(z>55295&&z<=56319){let P=(z-55296)*1024&65535;z=(E.charCodeAt(T+1)-56320&65535|P)+65536,T+=1}(function(P,D){if(P<=127){D(P);return}if(P<=2047){D(192|P>>6),D(128|63&P);return}if(P<=65535){D(224|P>>12),D(128|P>>6&63),D(128|63&P);return}if(P<=1114111){D(240|P>>18),D(128|P>>12&63),D(128|P>>6&63),D(128|63&P);return}throw Error(`Unrecognized Unicode codepoint: ${P.toString(16)}`)})(z,j)}}(m,E=>S.push(E)),new Uint8Array(S)}(`${c}.${u}`)))throw new bt("Invalid JWT signature");return{data:{claims:s,header:r,signature:a},error:null}}catch(i){if(R(i))return{data:null,error:i};throw i}}}nt.nextInstanceID=0;let yi=nt;class bi extends yi{constructor(e){super(e)}}class ki{constructor(e,t,i){var r,s,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw Error("supabaseUrl is required.");if(!t)throw Error("supabaseKey is required.");let c=new URL(function(g){return g.endsWith("/")?g:g+"/"}(e));this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);let u=`sb-${c.hostname.split(".")[0]}-auth-token`,f=function(g,y){var m,S;let{db:E,auth:j,realtime:T,global:z}=g,{db:P,auth:D,realtime:U,global:Q}=y,M={db:Object.assign(Object.assign({},P),E),auth:Object.assign(Object.assign({},D),j),realtime:Object.assign(Object.assign({},U),T),global:Object.assign(Object.assign(Object.assign({},Q),z),{headers:Object.assign(Object.assign({},(m=Q?.headers)!==null&&m!==void 0?m:{}),(S=z?.headers)!==null&&S!==void 0?S:{})}),accessToken:()=>{var ae,Gt,_t,at;return ae=this,Gt=void 0,at=function*(){return""},new(_t=void 0,_t=Promise)(function(Ti,Kt){function Ei(Ke){try{Et(at.next(Ke))}catch(We){Kt(We)}}function ji(Ke){try{Et(at.throw(Ke))}catch(We){Kt(We)}}function Et(Ke){var We;Ke.done?Ti(Ke.value):((We=Ke.value)instanceof _t?We:new _t(function(xi){xi(We)})).then(Ei,ji)}Et((at=at.apply(ae,Gt||[])).next())})}};return g.accessToken?M.accessToken=g.accessToken:delete M.accessToken,M}(i??{},{db:ut,realtime:Jt,auth:Object.assign(Object.assign({},Wt),{storageKey:u}),global:st});this.storageKey=(r=f.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=f.global.headers)!==null&&s!==void 0?s:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(g,y)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(y)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=f.auth)!==null&&a!==void 0?a:{},this.headers,f.global.fetch),this.fetch=Yt(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new he(new URL("rest/v1",c).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),f.accessToken||this._listenForAuthEvents()}get functions(){return new ne(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new O(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},i={}){return this.rest.rpc(e,t,i)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,i,r,s,a;return i=this,r=void 0,s=void 0,a=function*(){if(this.accessToken)return yield this.accessToken();let{data:c}=yield this.auth.getSession();return(t=(e=c.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null},new(s||(s=Promise))(function(c,u){function f(m){try{y(a.next(m))}catch(S){u(S)}}function g(m){try{y(a.throw(m))}catch(S){u(S)}}function y(m){var S;m.done?c(m.value):((S=m.value)instanceof s?S:new s(function(E){E(S)})).then(f,g)}y((a=a.apply(i,r||[])).next())})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:r,storageKey:s,flowType:a,lock:c,debug:u},f,g){let y={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bi({url:this.authUrl.href,headers:Object.assign(Object.assign({},y),f),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:r,flowType:a,lock:c,debug:u,fetch:g,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Te(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t?.access_token)})}_handleTokenChanged(e,t,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?this.changedAccessToken=i:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}let Si=(n,e,t)=>new ki(n,e,t)},ke.__chunk_5737=(ge,K)=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.version=void 0,K.version="0.0.0-automated"},ke.__chunk_4919=(ge,K,L)=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.DEFAULT_HEADERS=void 0;let V=L(5737);K.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${V.version}`}},ke.__chunk_6855=(ge,K)=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});class L extends Error{constructor(Y){super(Y.message),this.name="PostgrestError",this.details=Y.details,this.hint=Y.hint,this.code=Y.code}}K.default=L},ke.__chunk_3607=(ge,K,L)=>{"use strict";L.r(K),L.d(K,{Headers:()=>ue,Request:()=>Se,Response:()=>ne,default:()=>pe,fetch:()=>Y});var V=function(){if(typeof Pe<"u")return Pe;if(typeof window<"u")return window;if(L.g!==void 0)return L.g;throw Error("unable to locate global object")}();let Y=V.fetch,pe=V.fetch.bind(V),ue=V.Headers,Se=V.Request,ne=V.Response},ke);export{Oi as __getNamedExports};
