(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5030],{23181:function(e,t,n){Promise.resolve().then(n.bind(n,44098))},44098:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var a=n(57437),i=n(2265),o=n(31504),l=n(33101),r=n(85744),s=n(38543),c=n(22347),u=n(9391),d=n(73088),g=n(95280),h=n(36261),f=n(8319),x=n(77639),m=n(90658),p=n(20599),v=n(49715),j=n(73985),Z=n(66825),z=n(95386),b=n(31835),D=n(37306);function S(e){let{open:t,onClose:n,organization:o,onOrganizationDeleted:r}=e,[c,u]=(0,i.useState)(""),[d,g]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),S=c===(null==o?void 0:o.name),y=async()=>{if(!S){p("Please type the organization name exactly as shown");return}g(!0),p(null);try{let e=await fetch("/api/organizations/".concat(o.id),{method:"DELETE"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP ".concat(e.status,": ").concat(e.statusText))}let t=await e.json();console.log("Organization deleted:",t),u(""),null==r||r(o),n()}catch(e){console.error("Delete organization error:",e),p(e.message)}finally{g(!1)}},C=()=>{d||(u(""),p(null),n())};return o?(0,a.jsxs)(v.Z,{open:t,onClose:C,maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(j.Z,{children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,color:"error.main",children:[(0,a.jsx)(D.Z,{}),"Delete Organization"]})}),(0,a.jsxs)(Z.Z,{children:[(0,a.jsxs)(l.Z,{severity:"error",sx:{mb:3},children:[(0,a.jsx)(m.Z,{variant:"body2",fontWeight:"bold",gutterBottom:!0,children:"This action cannot be undone!"}),(0,a.jsx)(m.Z,{variant:"body2",children:"Deleting this organization will permanently remove:"}),(0,a.jsxs)(s.Z,{component:"ul",sx:{mt:1,mb:0,pl:2},children:[(0,a.jsx)("li",{children:"All organization members"}),(0,a.jsx)("li",{children:"All status pages"}),(0,a.jsx)("li",{children:"All services and dependencies"}),(0,a.jsx)("li",{children:"All organization data"})]})]}),h&&(0,a.jsx)(l.Z,{severity:"error",sx:{mb:2},children:h}),(0,a.jsx)(m.Z,{variant:"body1",gutterBottom:!0,children:"To confirm deletion, please type the organization name:"}),(0,a.jsx)(m.Z,{variant:"body1",fontWeight:"bold",sx:{p:1,bgcolor:"grey.100",borderRadius:1,fontFamily:"monospace",mb:2},children:o.name}),(0,a.jsx)(b.Z,{value:c,onChange:e=>u(e.target.value),placeholder:"Type organization name here",fullWidth:!0,disabled:d,error:c.length>0&&!S,helperText:c.length>0&&!S?"Organization name does not match":""})]}),(0,a.jsxs)(z.Z,{children:[(0,a.jsx)(x.Z,{onClick:C,disabled:d,children:"Cancel"}),(0,a.jsx)(x.Z,{onClick:y,variant:"contained",color:"error",disabled:d||!S,children:d?(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(f.Z,{size:16}),"Deleting..."]}):"Delete Organization"})]})]}):null}function y(e){let{onSelectOrg:t,onCreateNew:n,onOrgsLoaded:o,selectedOrg:l}=e,[r,v]=(0,i.useState)([]),[j,Z]=(0,i.useState)(!0),[z,b]=(0,i.useState)(""),[D,y]=(0,i.useState)(!1),[C,w]=(0,i.useState)(null),k=()=>{Z(!0),fetch("/api/organizations").then(e=>e.json()).then(e=>{let t=e.organizations||[];v(t),Z(!1),o&&o(t)}).catch(()=>{b("Failed to load organizations."),Z(!1),o&&o([])})};(0,i.useEffect)(()=>{k()},[o]);let O=(e,t)=>{t.stopPropagation(),w(e),y(!0)};return j?(0,a.jsx)(f.Z,{}):z?(0,a.jsx)(m.Z,{color:"error",children:z}):(0,a.jsxs)(s.Z,{width:"100%",maxWidth:500,children:[(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:2,mb:2,children:[(0,a.jsxs)(c.Z,{fullWidth:!0,children:[(0,a.jsx)(u.Z,{children:"Select Organization"}),(0,a.jsx)(d.Z,{value:(null==l?void 0:l.id)||"",onChange:e=>{let n=e.target.value,a=r.find(e=>e.id===n);a&&t&&t(a)},label:"Select Organization",disabled:0===r.length,children:r.map(e=>(0,a.jsx)(g.Z,{value:e.id,children:(0,a.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(m.Z,{variant:"body1",children:e.name}),e.role&&(0,a.jsxs)(m.Z,{variant:"caption",color:"text.secondary",children:["Role: ",e.role]})]}),"owner"===e.role&&(0,a.jsx)(h.Z,{size:"small",color:"error",onClick:t=>O(e,t),title:"Delete Organization",sx:{ml:1},children:(0,a.jsx)(p.Z,{fontSize:"small"})})]})},e.id))})]}),n&&(0,a.jsx)(x.Z,{variant:"contained",color:"primary",onClick:n,sx:{whiteSpace:"nowrap"},children:"Create New"})]}),0===r.length&&(0,a.jsx)(m.Z,{color:"text.secondary",sx:{mb:2},children:"No organizations found. Create one to get started."}),(0,a.jsx)(S,{open:D,onClose:()=>y(!1),organization:C,onOrganizationDeleted:e=>{v(t=>t.filter(t=>t.id!==e.id)),k()}})]})}var C=n(12256);function w(){let[e,t]=(0,i.useState)("list"),[n,s]=(0,i.useState)(null),[c,u]=(0,i.useState)(null);return(0,a.jsx)(r.Z,{children:(0,a.jsxs)(o.Z,{maxWidth:"lg",sx:{py:4},children:[c&&(0,a.jsx)(l.Z,{severity:"success",sx:{mb:3},children:c}),"list"===e?(0,a.jsx)(y,{onSelectOrg:e=>{s(e),alert("Selected: ".concat(e.name))},onCreateNew:()=>{t("create")}}):(0,a.jsx)(C.Z,{onBack:()=>{t("list"),s(null)},onSuccess:e=>{u('Organization "'.concat(e.name,'" created successfully!')),t("list"),setTimeout(()=>u(null),3e3)}})]})})}},12256:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var a=n(57437),i=n(2265),o=n(41563),l=n(61002),r=n(38543),s=n(77639),c=n(90658),u=n(33101),d=n(19352),g=n(31835),h=n(8319),f=n(51442),x=n(44812);function m(e){let{onBack:t,onSuccess:n}=e,[m,p]=(0,i.useState)(""),[v,j]=(0,i.useState)(""),[Z,z]=(0,i.useState)(""),[b,D]=(0,i.useState)(""),[S,y]=(0,i.useState)(!1),[C,w]=(0,i.useState)(!1),{session:k}=(0,x.o)(),O=e=>{let{name:t,value:n}=e.target;"name"===t?(p(n),j(n.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""))):"domain"===t&&z(n)},W=async e=>{var t,a;if(e.preventDefault(),!(null==k?void 0:null===(t=k.user)||void 0===t?void 0:t.id)){D("You must be logged in to create an organization");return}y(!0),D(""),w(!1);let i=await fetch("/api/organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:m,slug:v,domain:Z,userId:null==k?void 0:null===(a=k.user)||void 0===a?void 0:a.id})}),o=await i.json();y(!1),i.ok?(w(!0),p(""),j(""),z(""),n&&n(o.organization)):D(o.error||"Failed to create organization")};return(0,a.jsx)(o.Z,{children:(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)(r.Z,{display:"flex",alignItems:"center",mb:3,children:[(0,a.jsx)(s.Z,{startIcon:(0,a.jsx)(f.Z,{}),onClick:t,sx:{mr:2},children:"Back"}),(0,a.jsx)(c.Z,{variant:"h5",component:"h2",children:"Create New Organization"})]}),b&&(0,a.jsx)(u.Z,{severity:"error",sx:{mb:2},children:b}),C&&(0,a.jsx)(u.Z,{severity:"success",sx:{mb:2},children:"Organization created!"}),(0,a.jsx)("form",{onSubmit:W,children:(0,a.jsxs)(d.Z,{container:!0,spacing:3,children:[(0,a.jsx)(d.Z,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Organization Name",name:"name",value:m,onChange:O,required:!0,disabled:S,helperText:"Enter a descriptive name for your organization. Organization name must be globally unique."})}),(0,a.jsx)(d.Z,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Slug",name:"slug",value:v,onChange:O,required:!0,disabled:S,helperText:"URL-friendly identifier (auto-generated from name). Short unique identifier (e.g. acme-corp). Must be globally unique."})}),(0,a.jsx)(d.Z,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Custom Domain (Optional)",name:"domain",value:Z,onChange:O,disabled:S,helperText:"e.g., mycompany.alert24.com. Custom domain for your organization (optional, must be globally unique if used)"})}),(0,a.jsx)(d.Z,{item:!0,xs:12,children:(0,a.jsxs)(r.Z,{display:"flex",gap:2,children:[(0,a.jsx)(s.Z,{type:"submit",variant:"contained",disabled:S||!m||!v,startIcon:S?(0,a.jsx)(h.Z,{size:20}):null,children:S?"Creating...":"Create Organization"}),(0,a.jsx)(s.Z,{variant:"outlined",onClick:t,disabled:S,children:"Cancel"})]})})]})})]})})}},85744:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(57437),i=n(2265),o=n(8319),l=n(38543),r=n(44812);function s(e){let{children:t}=e,{session:n,sessionStatus:s}=(0,r.o)();return((0,i.useEffect)(()=>{"unauthenticated"===s&&(window.location.href="/api/auth/signin")},[s]),"loading"===s)?(0,a.jsx)(l.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,a.jsx)(o.Z,{})}):n?t:null}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return s},o:function(){return c}});var a=n(57437),i=n(2265);let o=(0,i.createContext)(),l=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},r=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function s(e){let{children:t}=e,{data:n,status:s}=function(){let[e,t]=(0,i.useState)(null),[n,a]=(0,i.useState)("loading");return(0,i.useEffect)(()=>{let e=async()=>{try{a("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),a(n?"authenticated":"unauthenticated")}else t(null),a("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),a("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[c,u]=(0,i.useState)(null),[d,g]=(0,i.useState)([]),[h,f]=(0,i.useState)(!1),[x,m]=(0,i.useState)(null),[p,v]=(0,i.useState)(!1);(0,i.useEffect)(()=>{v(!0)},[]),(0,i.useEffect)(()=>{if(p&&d.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=l();if(e){let t=d.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),u(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),r(null))}}},[p,d,c]),(0,i.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(s,"]")),n&&"authenticated"===s?j():"unauthenticated"===s&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),g([]),u(null),r(null))},[n,s]);let j=async()=>{try{f(!0),m(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];g(t);let n=null,a=l();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",a),a&&((n=t.find(e=>e.id===a))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),r(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let a=await e.json();if(a.hasDefault){let e=t.find(e=>e.id===a.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),u(n),r(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),u(e),r(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),u(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),m("Failed to fetch organizations"),g([])}catch(e){console.error("Error fetching organizations:",e),m(e.message),g([])}finally{f(!1)}};return(0,a.jsx)(o.Provider,{value:{selectedOrganization:c,organizations:d,loading:h,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),u(e),r((null==e?void 0:e.id)||null)},refreshOrganizations:j,session:n,sessionStatus:s},children:t})}function c(){let e=(0,i.useContext)(o);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},20599:function(e,t,n){"use strict";var a=n(64059),i=n(57437);t.Z=(0,a.Z)((0,i.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},37306:function(e,t,n){"use strict";var a=n(64059),i=n(57437);t.Z=(0,a.Z)((0,i.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning")},31504:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var a=n(2265),i=n(61994),o=n(11475),l=n(7609),r=n(24040),s=n(25310),c=n(1984),u=n(26102),d=n(57437);let g=(0,u.Z)(),h=(0,c.Z)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t["maxWidth".concat((0,r.Z)(String(n.maxWidth)))],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),f=e=>(0,s.Z)({props:e,name:"MuiContainer",defaultTheme:g}),x=(e,t)=>{let{classes:n,fixed:a,disableGutters:i,maxWidth:s}=e,c={root:["root",s&&"maxWidth".concat((0,r.Z)(String(s))),a&&"fixed",i&&"disableGutters"]};return(0,l.Z)(c,e=>(0,o.ZP)(t,e),n)};var m=n(51661),p=n(1589),v=n(42318),j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{createStyledComponent:t=h,useThemeProps:n=f,componentName:o="MuiContainer"}=e,l=t(e=>{let{theme:t,ownerState:n}=e;return{width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}}}},e=>{let{theme:t,ownerState:n}=e;return n.fixed&&Object.keys(t.breakpoints.values).reduce((e,n)=>{let a=t.breakpoints.values[n];return 0!==a&&(e[t.breakpoints.up(n)]={maxWidth:"".concat(a).concat(t.breakpoints.unit)}),e},{})},e=>{let{theme:t,ownerState:n}=e;return{..."xs"===n.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},...n.maxWidth&&"xs"!==n.maxWidth&&{[t.breakpoints.up(n.maxWidth)]:{maxWidth:"".concat(t.breakpoints.values[n.maxWidth]).concat(t.breakpoints.unit)}}}});return a.forwardRef(function(e,t){let a=n(e),{className:r,component:s="div",disableGutters:c=!1,fixed:u=!1,maxWidth:g="lg",classes:h,...f}=a,m={...a,component:s,disableGutters:c,fixed:u,maxWidth:g},p=x(m,o);return(0,d.jsx)(l,{as:s,ownerState:m,className:(0,i.Z)(p.root,r),ref:t,...f})})}({createStyledComponent:(0,p.ZP)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t["maxWidth".concat((0,m.Z)(String(n.maxWidth)))],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,v.i)({props:e,name:"MuiContainer"})})}},function(e){e.O(0,[702,7639,7863,3744,9352,1835,4045,1932,2971,7466,1744],function(){return e(e.s=23181)}),_N_E=e.O()}]);