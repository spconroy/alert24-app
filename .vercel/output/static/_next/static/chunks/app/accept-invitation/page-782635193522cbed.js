(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2532],{42779:function(e,t,n){Promise.resolve().then(n.bind(n,38990))},38990:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var o=n(57437),a=n(2265),i=n(99376),r=n(31504),s=n(38543),l=n(8319),c=n(90658),u=n(88654),d=n(33101),h=n(77639),g=n(41563),f=n(61002),m=n(50793),x=n(12961),v=n(8537),p=n(95488),Z=n(27367),j=n(44812);function y(){let e=(0,i.useSearchParams)(),t=(0,i.useRouter)(),{session:n}=(0,j.o)(),[y,b]=(0,a.useState)(null),[z,D]=(0,a.useState)(!0),[S,C]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[P,M]=(0,a.useState)(!1),R=e.get("token");(0,a.useEffect)(()=>{R?W():(k("No invitation token provided"),D(!1))},[R]);let W=async()=>{try{D(!0);let e=await fetch("/api/accept-invitation?token=".concat(R)),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to validate invitation");b(t.invitation)}catch(e){k(e.message)}finally{D(!1)}},E=async()=>{if(!n){let e=encodeURIComponent(window.location.href);t.push("/api/auth/signin?callbackUrl=".concat(e));return}try{C(!0),k(null);let e=await fetch("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:R})}),n=await e.json();if(!e.ok)throw Error(n.error||"Failed to accept invitation");M(!0),setTimeout(()=>{t.push("/")},3e3)}catch(e){k(e.message)}finally{C(!1)}};return z?(0,o.jsx)(r.Z,{maxWidth:"sm",sx:{py:8},children:(0,o.jsxs)(s.Z,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,children:[(0,o.jsx)(l.Z,{}),(0,o.jsx)(c.Z,{variant:"h6",children:"Validating invitation..."})]})}):w?(0,o.jsx)(r.Z,{maxWidth:"sm",sx:{py:8},children:(0,o.jsxs)(u.Z,{sx:{p:4,textAlign:"center"},children:[(0,o.jsx)(d.Z,{severity:"error",sx:{mb:3},children:w}),(0,o.jsx)(h.Z,{variant:"contained",onClick:()=>t.push("/"),children:"Go to Dashboard"})]})}):P?(0,o.jsx)(r.Z,{maxWidth:"sm",sx:{py:8},children:(0,o.jsxs)(u.Z,{sx:{p:4,textAlign:"center"},children:[(0,o.jsx)(x.Z,{sx:{fontSize:64,color:"success.main",mb:2}}),(0,o.jsx)(c.Z,{variant:"h4",gutterBottom:!0,color:"success.main",children:"Welcome to the team!"}),(0,o.jsxs)(c.Z,{variant:"body1",color:"text.secondary",sx:{mb:3},children:["You've successfully joined ",null==y?void 0:y.organizationName,". You'll be redirected to the dashboard shortly."]}),(0,o.jsx)(h.Z,{variant:"contained",onClick:()=>t.push("/"),children:"Go to Dashboard Now"})]})}):(0,o.jsx)(r.Z,{maxWidth:"sm",sx:{py:8},children:(0,o.jsxs)(u.Z,{sx:{p:4},children:[(0,o.jsxs)(s.Z,{textAlign:"center",mb:4,children:[(0,o.jsx)(v.Z,{sx:{fontSize:48,color:"primary.main",mb:2}}),(0,o.jsx)(c.Z,{variant:"h4",gutterBottom:!0,children:"Organization Invitation"}),(0,o.jsx)(c.Z,{variant:"body1",color:"text.secondary",children:"You've been invited to join an organization on Alert24"})]}),y&&(0,o.jsx)(g.Z,{variant:"outlined",sx:{mb:4},children:(0,o.jsx)(f.Z,{children:(0,o.jsxs)(s.Z,{display:"flex",flexDirection:"column",gap:2,children:[(0,o.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,o.jsx)(v.Z,{color:"primary"}),(0,o.jsx)(c.Z,{variant:"h6",children:y.organizationName})]}),(0,o.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,o.jsx)(p.Z,{color:"action"}),(0,o.jsxs)(c.Z,{variant:"body1",children:["Role:"," ",(0,o.jsx)(m.Z,{label:y.role,size:"small",color:"admin"===y.role?"primary":"default"})]})]}),y.invitedByName&&(0,o.jsxs)(c.Z,{variant:"body2",color:"text.secondary",children:["Invited by: ",y.invitedByName]}),(0,o.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,o.jsx)(Z.Z,{color:"action"}),(0,o.jsxs)(c.Z,{variant:"body2",color:"text.secondary",children:["Expires: ",new Date(y.expiresAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})})}),n?(0,o.jsxs)(d.Z,{severity:"success",sx:{mb:3},children:["Signed in as ",n.user.email]}):(0,o.jsx)(d.Z,{severity:"info",sx:{mb:3},children:"You need to sign in to accept this invitation. We'll bring you back here after authentication."}),(0,o.jsxs)(s.Z,{display:"flex",gap:2,justifyContent:"center",children:[(0,o.jsx)(h.Z,{variant:"outlined",onClick:()=>t.push("/"),disabled:S,children:"Cancel"}),(0,o.jsx)(h.Z,{variant:"contained",onClick:E,disabled:S,startIcon:S?(0,o.jsx)(l.Z,{size:20}):(0,o.jsx)(x.Z,{}),children:S?"Accepting...":"Accept Invitation"})]}),y&&(0,o.jsxs)(s.Z,{mt:4,p:2,bgcolor:"grey.50",borderRadius:1,children:[(0,o.jsxs)(c.Z,{variant:"subtitle2",gutterBottom:!0,children:["What can you do as a ",y.role,"?"]}),(0,o.jsx)(c.Z,{variant:"body2",color:"text.secondary",children:"admin"===y.role?"As an admin, you can manage incidents, monitoring, team members, and most organization settings. You cannot modify the organization name or manage owners.":"responder"===y.role?"As a responder, you can view all data, manage incidents, update service statuses, and participate in on-call schedules. You cannot manage users or organization settings.":"stakeholder"===y.role?"As a stakeholder, you have read-only access to view non-public status pages, incidents, and services. You cannot make any changes to data.":"As a member, you can respond to incidents, update statuses, and participate in on-call schedules."})]})]})})}function b(){return(0,o.jsx)(a.Suspense,{fallback:(0,o.jsx)("div",{children:"Loading..."}),children:(0,o.jsx)(y,{})})}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return l},o:function(){return c}});var o=n(57437),a=n(2265);let i=(0,a.createContext)(),r=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},s=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function l(e){let{children:t}=e,{data:n,status:l}=function(){let[e,t]=(0,a.useState)(null),[n,o]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let e=async()=>{try{o("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),o(n?"authenticated":"unauthenticated")}else t(null),o("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),o("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[c,u]=(0,a.useState)(null),[d,h]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[v,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{p(!0)},[]),(0,a.useEffect)(()=>{if(v&&d.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=r();if(e){let t=d.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),u(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),s(null))}}},[v,d,c]),(0,a.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(l,"]")),n&&"authenticated"===l?Z():"unauthenticated"===l&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),u(null),s(null))},[n,l]);let Z=async()=>{try{f(!0),x(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];h(t);let n=null,o=r();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",o),o&&((n=t.find(e=>e.id===o))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),s(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let o=await e.json();if(o.hasDefault){let e=t.find(e=>e.id===o.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),u(n),s(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),u(e),s(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),u(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),x("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),x(e.message),h([])}finally{f(!1)}};return(0,o.jsx)(i.Provider,{value:{selectedOrganization:c,organizations:d,loading:g,error:m,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),u(e),s((null==e?void 0:e.id)||null)},refreshOrganizations:Z,session:n,sessionStatus:l},children:t})}function c(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},99376:function(e,t,n){"use strict";var o=n(35475);n.o(o,"notFound")&&n.d(t,{notFound:function(){return o.notFound}}),n.o(o,"useParams")&&n.d(t,{useParams:function(){return o.useParams}}),n.o(o,"usePathname")&&n.d(t,{usePathname:function(){return o.usePathname}}),n.o(o,"useRouter")&&n.d(t,{useRouter:function(){return o.useRouter}}),n.o(o,"useSearchParams")&&n.d(t,{useSearchParams:function(){return o.useSearchParams}})},8537:function(e,t,n){"use strict";var o=n(64059),a=n(57437);t.Z=(0,o.Z)((0,a.jsx)("path",{d:"M12 7V3H2v18h20V7zM6 19H4v-2h2zm0-4H4v-2h2zm0-4H4V9h2zm0-4H4V5h2zm4 12H8v-2h2zm0-4H8v-2h2zm0-4H8V9h2zm0-4H8V5h2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8zm-2-8h-2v2h2zm0 4h-2v2h2z"}),"Business")},12961:function(e,t,n){"use strict";var o=n(64059),a=n(57437);t.Z=(0,o.Z)((0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},95488:function(e,t,n){"use strict";var o=n(64059),a=n(57437);t.Z=(0,o.Z)((0,a.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person")},27367:function(e,t,n){"use strict";var o=n(64059),a=n(57437);t.Z=(0,o.Z)([(0,a.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,a.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule")},41563:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var o=n(2265),a=n(61994),i=n(7609),r=n(1589),s=n(42318),l=n(88654),c=n(15245),u=n(11475);function d(e){return(0,u.ZP)("MuiCard",e)}(0,c.Z)("MuiCard",["root"]);var h=n(57437);let g=e=>{let{classes:t}=e;return(0,i.Z)({root:["root"]},d,t)},f=(0,r.ZP)(l.Z,{name:"MuiCard",slot:"Root"})({overflow:"hidden"});var m=o.forwardRef(function(e,t){let n=(0,s.i)({props:e,name:"MuiCard"}),{className:o,raised:i=!1,...r}=n,l={...n,raised:i},c=g(l);return(0,h.jsx)(f,{className:(0,a.Z)(c.root,o),elevation:i?8:void 0,ref:t,ownerState:l,...r})})},61002:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var o=n(2265),a=n(61994),i=n(7609),r=n(1589),s=n(42318),l=n(15245),c=n(11475);function u(e){return(0,c.ZP)("MuiCardContent",e)}(0,l.Z)("MuiCardContent",["root"]);var d=n(57437);let h=e=>{let{classes:t}=e;return(0,i.Z)({root:["root"]},u,t)},g=(0,r.ZP)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}});var f=o.forwardRef(function(e,t){let n=(0,s.i)({props:e,name:"MuiCardContent"}),{className:o,component:i="div",...r}=n,l={...n,component:i},c=h(l);return(0,d.jsx)(g,{as:i,className:(0,a.Z)(c.root,o),ownerState:l,ref:t,...r})})},31504:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var o=n(2265),a=n(61994),i=n(11475),r=n(7609),s=n(24040),l=n(25310),c=n(1984),u=n(26102),d=n(57437);let h=(0,u.Z)(),g=(0,c.Z)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t["maxWidth".concat((0,s.Z)(String(n.maxWidth)))],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),f=e=>(0,l.Z)({props:e,name:"MuiContainer",defaultTheme:h}),m=(e,t)=>{let{classes:n,fixed:o,disableGutters:a,maxWidth:l}=e,c={root:["root",l&&"maxWidth".concat((0,s.Z)(String(l))),o&&"fixed",a&&"disableGutters"]};return(0,r.Z)(c,e=>(0,i.ZP)(t,e),n)};var x=n(51661),v=n(1589),p=n(42318),Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{createStyledComponent:t=g,useThemeProps:n=f,componentName:i="MuiContainer"}=e,r=t(e=>{let{theme:t,ownerState:n}=e;return{width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}}}},e=>{let{theme:t,ownerState:n}=e;return n.fixed&&Object.keys(t.breakpoints.values).reduce((e,n)=>{let o=t.breakpoints.values[n];return 0!==o&&(e[t.breakpoints.up(n)]={maxWidth:"".concat(o).concat(t.breakpoints.unit)}),e},{})},e=>{let{theme:t,ownerState:n}=e;return{..."xs"===n.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},...n.maxWidth&&"xs"!==n.maxWidth&&{[t.breakpoints.up(n.maxWidth)]:{maxWidth:"".concat(t.breakpoints.values[n.maxWidth]).concat(t.breakpoints.unit)}}}});return o.forwardRef(function(e,t){let o=n(e),{className:s,component:l="div",disableGutters:c=!1,fixed:u=!1,maxWidth:h="lg",classes:g,...f}=o,x={...o,component:l,disableGutters:c,fixed:u,maxWidth:h},v=m(x,i);return(0,d.jsx)(r,{as:l,ownerState:x,className:(0,a.Z)(v.root,s),ref:t,...f})})}({createStyledComponent:(0,v.ZP)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t["maxWidth".concat((0,x.Z)(String(n.maxWidth)))],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,p.i)({props:e,name:"MuiContainer"})})},1984:function(e,t,n){"use strict";let o=(0,n(27387).ZP)();t.Z=o},83451:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var o=n(99654);function a(e){let{theme:t,name:n,props:a}=e;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?(0,o.Z)(t.components[n].defaultProps,a):a}},25310:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var o=n(83451),a=n(64166);function i(e){let{props:t,name:n,defaultTheme:i,themeId:r}=e,s=(0,a.Z)(i);return r&&(s=s[r]||s),(0,o.Z)({theme:s,name:n,props:t})}}},function(e){e.O(0,[702,7639,793,2971,7466,1744],function(){return e(e.s=42779)}),_N_E=e.O()}]);