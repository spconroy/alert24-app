(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{2520:function(e,n,t){Promise.resolve().then(t.bind(t,26888))},26888:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return O}});var i=t(57437),o=t(2265),r=t(38543),a=t(90658),l=t(77639),s=t(52854),c=t(60370),d=t(95280),u=t(44812);function h(){let{session:e}=(0,u.o)(),[n,t]=(0,o.useState)(null),h=()=>{t(null)};return"loading"===status?(0,i.jsx)(r.Z,{sx:{display:"flex",alignItems:"center"},children:(0,i.jsx)(a.Z,{variant:"body2",children:"Loading..."})}):(null==e?void 0:e.user)?(0,i.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsxs)(l.Z,{onClick:e=>{t(e.currentTarget)},sx:{display:"flex",alignItems:"center",gap:1,textTransform:"none",color:"inherit"},children:[(0,i.jsx)(s.Z,{src:e.user.image,alt:e.user.name,sx:{width:32,height:32}}),(0,i.jsx)(a.Z,{variant:"body2",children:e.user.name})]}),(0,i.jsxs)(c.Z,{anchorEl:n,open:!!n,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,i.jsx)(d.Z,{onClick:()=>window.location.href="/profile",children:"Profile"}),(0,i.jsx)(d.Z,{onClick:()=>{h(),window.location.href="/api/auth/signout"},children:"Sign Out"})]})]}):(0,i.jsx)(l.Z,{variant:"outlined",onClick:()=>signIn("google"),sx:{textTransform:"none"},children:"Sign In with Google"})}var g=t(8319),x=t(33101),f=t(18150),m=t(36261),j=t(19352),Z=t(41563),p=t(61002),v=t(50793),w=t(21148),y=t(27554),D=t(27648),b=t(89470),S=t(99636),z=t(75299),_=t(59700),I=t(38861);function C(){let[e,n]=(0,o.useState)([]),[t,s]=(0,o.useState)({total:0,up:0,down:0,warning:0}),[c,d]=(0,o.useState)([]),[h,C]=(0,o.useState)(!0),[k,O]=(0,o.useState)(null),{selectedOrganization:E,session:A}=(0,u.o)();(0,o.useEffect)(()=>{A&&B()},[A,E]);let B=async()=>{try{C(!0),O(null);let e=new URLSearchParams;E&&e.append("organization_id",E.id),e.append("limit","10");let t=await fetch("/api/incidents?".concat(e.toString()));if(t.ok){let e=await t.json();n(e.incidents||[])}let i=await fetch("/api/monitoring?".concat(e.toString()));if(i.ok){let e=(await i.json()).monitoring_checks||[],n={total:e.length||0,up:e.filter(e=>(null==e?void 0:e.current_status)==="up").length||0,down:e.filter(e=>(null==e?void 0:e.current_status)==="down").length||0,warning:e.filter(e=>(null==e?void 0:e.current_status)==="warning").length||0,inactive:e.filter(e=>(null==e?void 0:e.current_status)==="inactive").length||0};s(n)}else s({total:0,up:0,down:0,warning:0});let o=new URLSearchParams;E&&o.append("organization_id",E.id),o.append("start_date",new Date().toISOString()),o.append("end_date",new Date(Date.now()+6048e5).toISOString()),o.append("active_only","true");let r=await fetch("/api/on-call-schedules?".concat(o.toString()));if(r.ok){let e=await r.json();d(e.on_call_schedules||[])}}catch(e){console.error("Error fetching dashboard data:",e),O(e.message)}finally{C(!1)}},W=e=>{switch(e){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}},N=e=>{switch(e){case"open":return"error";case"investigating":return"warning";case"monitoring":return"info";case"resolved":return"success";default:return"default"}};if(h)return(0,i.jsx)(r.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,i.jsx)(g.Z,{})});if(k)return(0,i.jsxs)(x.Z,{severity:"error",sx:{mb:2},children:["Error loading dashboard data: ",k]});let F=(()=>{let n=e.filter(e=>"resolved"!==e.status).length,i=(t.down||0)+(t.warning||0);return n>0&&i>0?{status:"Outage",color:"error"}:n>0?{status:"Active Incidents",color:"warning"}:i>0?{status:"Monitoring Issues",color:"warning"}:{status:"All Systems Operational",color:"success"}})(),M=e.filter(e=>"resolved"!==e.status),P=c.filter(e=>e.is_active&&e.current_on_call_member).map(e=>({...e,user_name:e.current_on_call_member.name,user_email:e.current_on_call_member.email,is_currently_on_call:!0}));return(0,i.jsxs)(r.Z,{children:[(0,i.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"Incident Management Dashboard"}),(0,i.jsx)(a.Z,{variant:"body1",color:"text.secondary",children:"Monitor incidents, services, and team status across your organization"})]}),(0,i.jsxs)(r.Z,{display:"flex",gap:2,children:[(0,i.jsx)(f.Z,{title:"Refresh Dashboard",children:(0,i.jsx)(m.Z,{onClick:B,color:"primary",children:(0,i.jsx)(S.Z,{})})}),(0,i.jsx)(l.Z,{component:D.default,href:"/incidents/new",variant:"contained",startIcon:(0,i.jsx)(b.Z,{}),color:"error",children:"Create Incident"})]})]}),(0,i.jsxs)(j.Z,{container:!0,spacing:3,sx:{mb:4},children:[(0,i.jsx)(j.Z,{item:!0,xs:12,md:3,children:(0,i.jsx)(Z.Z,{children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"System Status"}),(0,i.jsx)(v.Z,{label:F.status,color:F.color,variant:"filled",sx:{fontSize:"0.875rem",fontWeight:"bold"}})]})})}),(0,i.jsx)(j.Z,{item:!0,xs:12,md:3,children:(0,i.jsx)(Z.Z,{children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Active Incidents"}),(0,i.jsxs)(r.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,i.jsx)(w.Z,{badgeContent:M.length,color:"error",children:(0,i.jsx)(z.Z,{color:"action"})}),(0,i.jsx)(a.Z,{variant:"h4",children:M.length})]})]})})}),(0,i.jsx)(j.Z,{item:!0,xs:12,md:3,children:(0,i.jsx)(Z.Z,{component:D.default,href:"/monitoring",sx:{textDecoration:"none",cursor:"pointer","&:hover":{backgroundColor:"action.hover",transform:"translateY(-1px)",boxShadow:2},transition:"all 0.2s ease-in-out"},children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Monitoring"}),(0,i.jsxs)(r.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,i.jsx)(w.Z,{badgeContent:(t.down||0)+(t.warning||0),color:(t.down||0)>0?"error":(t.warning||0)>0?"warning":"success",children:(0,i.jsx)(_.Z,{color:"action"})}),(0,i.jsxs)(a.Z,{variant:"h4",children:[t.up||0,"/",t.total||0]})]}),(0,i.jsx)(a.Z,{variant:"body2",color:"text.secondary",children:"Services Up • Click to view details"})]})})}),(0,i.jsx)(j.Z,{item:!0,xs:12,md:3,children:(0,i.jsx)(Z.Z,{children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"On-Call Now"}),(0,i.jsxs)(r.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,i.jsx)(I.Z,{color:"action"}),(0,i.jsx)(a.Z,{variant:"h4",children:P.length})]}),(0,i.jsx)(a.Z,{variant:"body2",color:"text.secondary",children:"Team Members"})]})})})]}),(0,i.jsxs)(j.Z,{container:!0,spacing:3,children:[(0,i.jsx)(j.Z,{item:!0,xs:12,lg:8,children:(0,i.jsx)(Z.Z,{children:(0,i.jsxs)(p.Z,{children:[(0,i.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,i.jsx)(a.Z,{variant:"h6",children:"Recent Incidents"}),(0,i.jsx)(l.Z,{component:D.default,href:"/incidents",variant:"outlined",size:"small",children:"View All"})]}),(0,i.jsx)(y.Z,{sx:{mb:2}}),0===e.length?(0,i.jsx)(a.Z,{color:"text.secondary",textAlign:"center",py:4,children:"No incidents found"}):e.slice(0,5).map(e=>(0,i.jsxs)(r.Z,{sx:{mb:2,pb:2,borderBottom:"1px solid #f0f0f0"},children:[(0,i.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1,children:[(0,i.jsx)(a.Z,{variant:"subtitle1",fontWeight:"medium",children:(0,i.jsx)(D.default,{href:"/incidents/".concat(e.id),style:{textDecoration:"none",color:"inherit"},children:e.title})}),(0,i.jsxs)(r.Z,{display:"flex",gap:1,children:[(0,i.jsx)(v.Z,{label:e.severity,color:W(e.severity),size:"small"}),(0,i.jsx)(v.Z,{label:e.status,color:N(e.status),size:"small"})]})]}),(0,i.jsxs)(a.Z,{variant:"body2",color:"text.secondary",children:[e.organization_name," •"," ",e.assigned_to_name||"Unassigned"," •",new Date(e.created_at).toLocaleDateString()]})]},e.id))]})})}),(0,i.jsxs)(j.Z,{item:!0,xs:12,lg:4,children:[(0,i.jsx)(Z.Z,{sx:{mb:3},children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",gutterBottom:!0,children:"Currently On-Call"}),(0,i.jsx)(y.Z,{sx:{mb:2}}),0===P.length?(0,i.jsx)(a.Z,{color:"text.secondary",textAlign:"center",py:2,children:"No one is currently on-call"}):P.map(e=>(0,i.jsxs)(r.Z,{sx:{mb:1},children:[(0,i.jsx)(a.Z,{variant:"subtitle2",children:e.user_name}),(0,i.jsx)(a.Z,{variant:"body2",color:"text.secondary",children:e.organization_name})]},e.id)),(0,i.jsx)(l.Z,{component:D.default,href:"/on-call",variant:"outlined",fullWidth:!0,sx:{mt:2},children:"Manage Schedules"})]})}),(0,i.jsx)(Z.Z,{children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(a.Z,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),(0,i.jsx)(y.Z,{sx:{mb:2}}),(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,i.jsx)(l.Z,{component:D.default,href:"/monitoring/new",variant:"outlined",startIcon:(0,i.jsx)(_.Z,{}),fullWidth:!0,children:"Add Monitoring Check"}),(0,i.jsx)(l.Z,{component:D.default,href:"/escalation-policies/new",variant:"outlined",startIcon:(0,i.jsx)(z.Z,{}),fullWidth:!0,children:"Create Escalation Policy"}),(0,i.jsx)(l.Z,{component:D.default,href:"/organizations/new",variant:"outlined",startIcon:(0,i.jsx)(b.Z,{}),fullWidth:!0,children:"Add Organization"})]})]})})]})]})]})}var k=t(31504);function O(){let{session:e,sessionStatus:n}=(0,u.o)();return"loading"===n?(0,i.jsx)(r.Z,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",children:(0,i.jsx)(a.Z,{variant:"h6",children:"Loading..."})}):(null==e?void 0:e.user)?(0,i.jsx)(k.Z,{maxWidth:"xl",sx:{py:4},children:(0,i.jsx)(C,{})}):(0,i.jsxs)(r.Z,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:4,children:[(0,i.jsx)(a.Z,{variant:"h3",component:"h1",gutterBottom:!0,children:"Welcome to Alert24"}),(0,i.jsx)(a.Z,{variant:"body1",color:"text.secondary",gutterBottom:!0,textAlign:"center",maxWidth:"500px",children:"Your comprehensive incident management and monitoring platform. Sign in with Google to manage incidents, monitor services, and coordinate team responses."}),(0,i.jsx)(h,{}),(0,i.jsx)(a.Z,{variant:"body2",color:"text.secondary",textAlign:"center",maxWidth:"400px",children:"New to Alert24? No problem! Just sign in with your Google account and we'll create your account automatically."})]})}},44812:function(e,n,t){"use strict";t.d(n,{f:function(){return s},o:function(){return c}});var i=t(57437),o=t(2265);let r=(0,o.createContext)(),a=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},l=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function s(e){let{children:n}=e,{data:t,status:s}=function(){let[e,n]=(0,o.useState)(null),[t,i]=(0,o.useState)("loading");return(0,o.useEffect)(()=>{let e=async()=>{try{i("loading");let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();n(t),i(t?"authenticated":"unauthenticated")}else n(null),i("unauthenticated")}catch(e){console.error("Error fetching session:",e),n(null),i("unauthenticated")}};e();let t=setInterval(e,3e5);return()=>clearInterval(t)},[]),{data:e,status:t}}(),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)([]),[g,x]=(0,o.useState)(!1),[f,m]=(0,o.useState)(null),[j,Z]=(0,o.useState)(!1);(0,o.useEffect)(()=>{Z(!0)},[]),(0,o.useEffect)(()=>{if(j&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=a();if(e){let n=u.find(n=>n.id===e);n?(console.log("\uD83D\uDD04 Client-side restoration successful:",n.name),d(n)):(console.log("⚠️ Saved organization no longer available, clearing storage"),l(null))}}},[j,u,c]),(0,o.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email)||"no session","[".concat(s,"]")),t&&"authenticated"===s?p():"unauthenticated"===s&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),l(null))},[t,s]);let p=async()=>{try{x(!0),m(null);let e=await fetch("/api/organizations");if(e.ok){let n=(await e.json()).organizations||[];h(n);let t=null,i=a();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",i),i&&((t=n.find(e=>e.id===i))?console.log("\uD83C\uDFAF Found matching organization for restoration:",t.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),l(null))),!t&&n.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let i=await e.json();if(i.hasDefault){let e=n.find(e=>e.id===i.defaultOrganization.id);e&&(t=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(t)console.log("✅ Selected organization:",t.name),d(t),l(t.id);else if(1===n.length){let e=n[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),l(e.id)}else 0===n.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),m("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),m(e.message),h([])}finally{x(!1)}};return(0,i.jsx)(r.Provider,{value:{selectedOrganization:c,organizations:u,loading:g,error:f,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),l((null==e?void 0:e.id)||null)},refreshOrganizations:p,session:t,sessionStatus:s},children:n})}function c(){let e=(0,o.useContext)(r);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}}},function(e){e.O(0,[702,7639,7863,793,9352,8129,7286,8150,244,2971,7466,1744],function(){return e(e.s=2520)}),_N_E=e.O()}]);