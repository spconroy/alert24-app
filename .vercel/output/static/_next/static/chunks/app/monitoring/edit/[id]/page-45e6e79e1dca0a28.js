(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1809],{57444:function(e,t,n){Promise.resolve().then(n.bind(n,93902))},93902:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return P},runtime:function(){return E}});var a=n(57437),s=n(2265),i=n(38543),l=n(8319),o=n(77639),r=n(90658),c=n(33101),d=n(41563),u=n(61002),h=n(19352),g=n(31835),m=n(22347),x=n(9391),p=n(73088),_=n(95280),f=n(27554),j=n(67615),v=n(64502),Z=n(50793),k=n(90752),y=n(21127),D=n(52205),b=n(99376),C=n(27648),S=n(51442),w=n(11617),T=n(94551),z=n(44812);let E="edge";function P(){let e=(0,b.useRouter)(),t=(0,b.useParams)().id,{session:n,selectedOrganization:E}=(0,z.o)(),[P,I]=(0,s.useState)({name:"",check_type:"http",target_url:"",check_interval_seconds:300,timeout_seconds:30,http_method:"GET",http_headers:{},expected_status_codes:[200],keyword_match:"",keyword_match_type:"contains",ssl_check_enabled:!1,follow_redirects:!0,notification_settings:{},is_active:!0,monitoring_locations:["00000000-0000-0000-0000-000000000001"]}),[O,H]=(0,s.useState)(!1),[M,N]=(0,s.useState)(!0),[R,F]=(0,s.useState)(null),[A,U]=(0,s.useState)(!1),[L,W]=(0,s.useState)({}),[q,B]=(0,s.useState)(""),[G,J]=(0,s.useState)(""),[V,K]=(0,s.useState)("");(0,s.useEffect)(()=>{n&&t&&Q()},[n,t]);let Q=async()=>{try{var e;N(!0);let n=await fetch("/api/monitoring/".concat(t));if(!n.ok)throw Error("Failed to fetch monitoring check");let a=(await n.json()).check,s="string"==typeof a.description?JSON.parse(a.description):a.description;I({name:(null===(e=a.name)||void 0===e?void 0:e.replace("[MONITORING] ",""))||"",check_type:s.check_type||"http",target_url:s.target_url||"",check_interval_seconds:s.check_interval_seconds||300,timeout_seconds:s.timeout_seconds||30,http_method:s.http_method||"GET",http_headers:s.http_headers||{},expected_status_codes:s.expected_status_codes||[200],keyword_match:s.keyword_match||"",keyword_match_type:s.keyword_match_type||"contains",ssl_check_enabled:s.ssl_check_enabled||!1,follow_redirects:!1!==s.follow_redirects,notification_settings:s.notification_settings||{},is_active:!1!==a.is_active})}catch(e){console.error("Error fetching monitoring check:",e),F("Failed to load monitoring check: ".concat(e.message))}finally{N(!1)}},X=()=>{let e={};if(E||(e.organization="Please select an organization from the navbar"),P.name.trim()||(e.name="Monitor name is required"),P.target_url.trim()||("ping"===P.check_type?e.target_url="Hostname or IP address is required":"tcp"===P.check_type?e.target_url="Hostname:port or IP:port is required":"ssl"===P.check_type?e.target_url="Hostname or URL is required":e.target_url="Target URL is required"),P.target_url.trim()&&"http"===P.check_type)try{new URL(P.target_url)}catch(t){e.target_url="Please enter a valid URL (e.g., https://example.com)"}return P.check_interval_seconds<60&&(e.check_interval_seconds="Check interval must be at least 60 seconds"),P.timeout_seconds<1&&(e.timeout_seconds="Timeout must be at least 1 second"),P.timeout_seconds>=P.check_interval_seconds&&(e.timeout_seconds="Timeout must be less than check interval"),W(e),0===Object.keys(e).length},Y=async n=>{if(n.preventDefault(),X()){H(!0),F(null),U(!1);try{let n={name:"[MONITORING] ".concat(P.name),description:JSON.stringify(P),is_active:P.is_active,organization_id:E.id};console.log("Updating monitoring check:",n);let a=await fetch("/api/monitoring/".concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to update monitoring check")}let s=await a.json();console.log("Monitoring check updated successfully:",s),U(!0),setTimeout(()=>{e.push("/monitoring")},1500)}catch(e){console.error("Error updating monitoring check:",e),F(e.message)}finally{H(!1)}}},$=(e,t)=>{I(n=>({...n,[e]:t})),L[e]&&W(t=>({...t,[e]:""}))},ee=e=>{I(t=>{let n={...t.http_headers};return delete n[e],{...t,http_headers:n}})},et=e=>{I(t=>({...t,expected_status_codes:t.expected_status_codes.filter(t=>t!==e)}))};return M?(0,a.jsx)(i.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,a.jsx)(l.Z,{})}):(0,a.jsxs)(i.Z,{sx:{p:3},children:[(0,a.jsx)(i.Z,{sx:{mb:3},children:(0,a.jsxs)(i.Z,{display:"flex",alignItems:"center",gap:2,mb:2,children:[(0,a.jsx)(o.Z,{component:C.default,href:"/monitoring",startIcon:(0,a.jsx)(S.Z,{}),variant:"outlined",children:"Back to Monitoring"}),(0,a.jsx)(r.Z,{variant:"h4",component:"h1",children:"Edit Monitoring Check"})]})}),R&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:3},children:R}),A&&(0,a.jsx)(c.Z,{severity:"success",sx:{mb:3},children:"Monitoring check updated successfully! Redirecting..."}),L.organization&&(0,a.jsx)(c.Z,{severity:"warning",sx:{mb:3},children:L.organization}),(0,a.jsx)(d.Z,{children:(0,a.jsx)(u.Z,{children:(0,a.jsx)("form",{onSubmit:Y,children:(0,a.jsxs)(h.Z,{container:!0,spacing:3,children:[(0,a.jsx)(h.Z,{item:!0,xs:12,children:(0,a.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Basic Configuration"})}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Monitor Name",value:P.name,onChange:e=>$("name",e.target.value),error:!!L.name,helperText:L.name,required:!0})}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,a.jsxs)(m.Z,{fullWidth:!0,children:[(0,a.jsx)(x.Z,{children:"Check Type"}),(0,a.jsxs)(p.Z,{value:P.check_type,label:"Check Type",onChange:e=>$("check_type",e.target.value),children:[(0,a.jsx)(_.Z,{value:"http",children:"HTTP/HTTPS"}),(0,a.jsx)(_.Z,{value:"ping",children:"Ping"}),(0,a.jsx)(_.Z,{value:"tcp",children:"TCP Port"}),(0,a.jsx)(_.Z,{value:"ssl",children:"SSL Certificate"})]})]})}),(0,a.jsx)(h.Z,{item:!0,xs:12,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"ping"===P.check_type?"Hostname or IP Address":"tcp"===P.check_type?"Hostname:Port or IP:Port":"ssl"===P.check_type?"Hostname or URL":"Target URL",value:P.target_url,onChange:e=>$("target_url",e.target.value),error:!!L.target_url,helperText:L.target_url,placeholder:"ping"===P.check_type?"example.com or 8.8.8.8":"tcp"===P.check_type?"example.com:443 or 8.8.8.8:53":"ssl"===P.check_type?"example.com or https://example.com":"https://example.com/api/health",required:!0})}),(0,a.jsxs)(h.Z,{item:!0,xs:12,children:[(0,a.jsx)(f.Z,{sx:{my:2}}),(0,a.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Timing Configuration"})]}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,type:"number",label:"Check Interval (seconds)",value:P.check_interval_seconds,onChange:e=>$("check_interval_seconds",parseInt(e.target.value)),error:!!L.check_interval_seconds,helperText:L.check_interval_seconds||"Minimum 60 seconds",inputProps:{min:60,step:60}})}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,a.jsx)(g.Z,{fullWidth:!0,type:"number",label:"Timeout (seconds)",value:P.timeout_seconds,onChange:e=>$("timeout_seconds",parseInt(e.target.value)),error:!!L.timeout_seconds,helperText:L.timeout_seconds||"Must be less than check interval",inputProps:{min:1,max:300}})}),"http"===P.check_type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.Z,{item:!0,xs:12,children:[(0,a.jsx)(f.Z,{sx:{my:2}}),(0,a.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"HTTP Configuration"})]}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,a.jsxs)(m.Z,{fullWidth:!0,children:[(0,a.jsx)(x.Z,{children:"HTTP Method"}),(0,a.jsxs)(p.Z,{value:P.http_method,label:"HTTP Method",onChange:e=>$("http_method",e.target.value),children:[(0,a.jsx)(_.Z,{value:"GET",children:"GET"}),(0,a.jsx)(_.Z,{value:"POST",children:"POST"}),(0,a.jsx)(_.Z,{value:"PUT",children:"PUT"}),(0,a.jsx)(_.Z,{value:"DELETE",children:"DELETE"}),(0,a.jsx)(_.Z,{value:"HEAD",children:"HEAD"}),(0,a.jsx)(_.Z,{value:"OPTIONS",children:"OPTIONS"})]})]})}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,a.jsx)(j.Z,{control:(0,a.jsx)(v.Z,{checked:P.ssl_check_enabled,onChange:e=>$("ssl_check_enabled",e.target.checked)}),label:"SSL Certificate Check"})}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,a.jsx)(j.Z,{control:(0,a.jsx)(v.Z,{checked:P.follow_redirects,onChange:e=>$("follow_redirects",e.target.checked)}),label:"Follow Redirects"})}),(0,a.jsxs)(h.Z,{item:!0,xs:12,children:[(0,a.jsx)(r.Z,{variant:"subtitle1",gutterBottom:!0,children:"Expected Status Codes"}),(0,a.jsx)(i.Z,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:P.expected_status_codes.map(e=>(0,a.jsx)(Z.Z,{label:e,onDelete:()=>et(e),size:"small"},e))}),(0,a.jsxs)(i.Z,{display:"flex",gap:1,children:[(0,a.jsx)(g.Z,{size:"small",type:"number",label:"Add Status Code",value:V,onChange:e=>K(e.target.value),inputProps:{min:100,max:599},sx:{width:200}}),(0,a.jsx)(o.Z,{onClick:()=>{let e=parseInt(V);e>=100&&e<=599&&!P.expected_status_codes.includes(e)&&(I(t=>({...t,expected_status_codes:[...t.expected_status_codes,e]})),K(""))},variant:"outlined",size:"small",children:"Add"})]})]}),(0,a.jsx)(h.Z,{item:!0,xs:12,children:(0,a.jsxs)(k.Z,{children:[(0,a.jsx)(y.Z,{expandIcon:(0,a.jsx)(T.Z,{}),children:(0,a.jsxs)(r.Z,{children:["HTTP Headers (",Object.keys(P.http_headers).length,")"]})}),(0,a.jsxs)(D.Z,{children:[Object.entries(P.http_headers).map(e=>{let[t,n]=e;return(0,a.jsxs)(i.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,a.jsx)(g.Z,{size:"small",label:"Header",value:t,disabled:!0,sx:{flex:1}}),(0,a.jsx)(g.Z,{size:"small",label:"Value",value:n,disabled:!0,sx:{flex:1}}),(0,a.jsx)(o.Z,{size:"small",color:"error",onClick:()=>ee(t),children:"Remove"})]},t)}),(0,a.jsxs)(i.Z,{display:"flex",gap:1,mt:2,children:[(0,a.jsx)(g.Z,{size:"small",label:"Header Name",value:q,onChange:e=>B(e.target.value),sx:{flex:1}}),(0,a.jsx)(g.Z,{size:"small",label:"Header Value",value:G,onChange:e=>J(e.target.value),sx:{flex:1}}),(0,a.jsx)(o.Z,{onClick:()=>{q.trim()&&G.trim()&&(I(e=>({...e,http_headers:{...e.http_headers,[q.trim()]:G.trim()}})),B(""),J(""))},variant:"outlined",size:"small",children:"Add"})]})]})]})}),(0,a.jsx)(h.Z,{item:!0,xs:12,children:(0,a.jsxs)(k.Z,{children:[(0,a.jsx)(y.Z,{expandIcon:(0,a.jsx)(T.Z,{}),children:(0,a.jsx)(r.Z,{children:"Content Validation"})}),(0,a.jsx)(D.Z,{children:(0,a.jsxs)(h.Z,{container:!0,spacing:2,children:[(0,a.jsx)(h.Z,{item:!0,xs:12,md:8,children:(0,a.jsx)(g.Z,{fullWidth:!0,label:"Keyword to Match (optional)",value:P.keyword_match,onChange:e=>$("keyword_match",e.target.value),placeholder:"Text that should be present in the response"})}),(0,a.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,a.jsxs)(m.Z,{fullWidth:!0,children:[(0,a.jsx)(x.Z,{children:"Match Type"}),(0,a.jsxs)(p.Z,{value:P.keyword_match_type,label:"Match Type",onChange:e=>$("keyword_match_type",e.target.value),children:[(0,a.jsx)(_.Z,{value:"contains",children:"Contains"}),(0,a.jsx)(_.Z,{value:"not_contains",children:"Does Not Contain"}),(0,a.jsx)(_.Z,{value:"regex",children:"Regular Expression"})]})]})})]})})]})})]}),(0,a.jsxs)(h.Z,{item:!0,xs:12,children:[(0,a.jsx)(f.Z,{sx:{my:2}}),(0,a.jsx)(j.Z,{control:(0,a.jsx)(v.Z,{checked:P.is_active,onChange:e=>$("is_active",e.target.checked)}),label:"Monitor is Active"})]}),(0,a.jsx)(h.Z,{item:!0,xs:12,children:(0,a.jsxs)(i.Z,{display:"flex",gap:2,justifyContent:"flex-end",children:[(0,a.jsx)(o.Z,{component:C.default,href:"/monitoring",variant:"outlined",children:"Cancel"}),(0,a.jsx)(o.Z,{type:"submit",variant:"contained",startIcon:O?(0,a.jsx)(l.Z,{size:20}):(0,a.jsx)(w.Z,{}),disabled:O,children:O?"Updating...":"Update Check"})]})})]})})})})]})}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return r},o:function(){return c}});var a=n(57437),s=n(2265);let i=(0,s.createContext)(),l=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},o=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function r(e){let{children:t}=e,{data:n,status:r}=function(){let[e,t]=(0,s.useState)(null),[n,a]=(0,s.useState)("loading");return(0,s.useEffect)(()=>{let e=async()=>{try{a("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),a(n?"authenticated":"unauthenticated")}else t(null),a("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),a("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)([]),[g,m]=(0,s.useState)(!1),[x,p]=(0,s.useState)(null),[_,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{f(!0)},[]),(0,s.useEffect)(()=>{if(_&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=l();if(e){let t=u.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),o(null))}}},[_,u,c]),(0,s.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(r,"]")),n&&"authenticated"===r?j():"unauthenticated"===r&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),o(null))},[n,r]);let j=async()=>{try{m(!0),p(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];h(t);let n=null,a=l();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",a),a&&((n=t.find(e=>e.id===a))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),o(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let a=await e.json();if(a.hasDefault){let e=t.find(e=>e.id===a.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),d(n),o(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),o(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),p("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),p(e.message),h([])}finally{m(!1)}};return(0,a.jsx)(i.Provider,{value:{selectedOrganization:c,organizations:u,loading:g,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),o((null==e?void 0:e.id)||null)},refreshOrganizations:j,session:n,sessionStatus:r},children:t})}function c(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,8129,4502,2413,7596,8938,2971,7466,1744],function(){return e(e.s=57444)}),_N_E=e.O()}]);