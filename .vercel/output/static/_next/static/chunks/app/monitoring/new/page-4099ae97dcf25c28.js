(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2728],{77952:function(e,t,n){Promise.resolve().then(n.bind(n,92449))},92449:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n(57437),a=n(2265),o=n(38543),i=n(33101),s=n(77639),l=n(90658),c=n(41563),d=n(61002),h=n(19352),u=n(31835),g=n(22347),m=n(9391),x=n(73088),p=n(95280),f=n(25761),_=n(27554),j=n(67615),Z=n(64502),v=n(50793),k=n(90752),y=n(21127),b=n(52205),D=n(8319),C=n(99376),S=n(27648),T=n(51442),z=n(11617),w=n(94551),P=n(44812),I=n(85744);function E(){let e=(0,C.useRouter)(),{session:t,selectedOrganization:n}=(0,P.o)(),[E,H]=(0,a.useState)({name:"",check_type:"http",target_url:"",check_interval_seconds:300,timeout_seconds:30,http_method:"GET",http_headers:{},expected_status_codes:[200],keyword_match:"",keyword_match_type:"contains",ssl_check_enabled:!1,follow_redirects:!0,notification_settings:{},is_active:!0,monitoring_locations:["00000000-0000-0000-0000-000000000001"]}),[A,O]=(0,a.useState)(!1),[M,R]=(0,a.useState)(null),[F,L]=(0,a.useState)(!1),[U,W]=(0,a.useState)({}),[N,B]=(0,a.useState)(""),[q,$]=(0,a.useState)(""),[G,J]=(0,a.useState)(""),K=()=>{let e={};if(n||(e.organization="Please select an organization from the navbar"),E.name.trim()||(e.name="Monitor name is required"),E.target_url.trim()||("ping"===E.check_type?e.target_url="Hostname or IP address is required":"tcp"===E.check_type?e.target_url="Hostname:port or IP:port is required":"ssl"===E.check_type?e.target_url="Hostname or URL is required":e.target_url="Target URL is required"),E.target_url.trim()){if("http"===E.check_type)try{new URL(E.target_url)}catch(t){e.target_url="Please enter a valid URL (e.g., https://example.com)"}else if("ping"===E.check_type){let t=E.target_url.trim();/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)||/^[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$/.test(t)||(e.target_url="Please enter a valid hostname (e.g., example.com) or IP address (e.g., 192.168.1.1)")}else if("tcp"===E.check_type){let t=E.target_url.trim();/^[a-zA-Z0-9\-\.]+:\d+$/.test(t)||(e.target_url="Please enter hostname:port or IP:port (e.g., example.com:80 or 192.168.1.1:443)");let n=t.match(/:(\d+)$/);if(n){let t=parseInt(n[1]);(t<1||t>65535)&&(e.target_url="Port number must be between 1 and 65535")}}else if("ssl"===E.check_type){let t=E.target_url.trim();try{new URL(t.startsWith("http")?t:"https://".concat(t))}catch(t){e.target_url="Please enter a valid hostname or URL for SSL certificate checking"}}}return E.check_interval_seconds<60&&(e.check_interval_seconds="Check interval must be at least 60 seconds"),(E.timeout_seconds<1||E.timeout_seconds>=E.check_interval_seconds)&&(e.timeout_seconds="Timeout must be between 1 second and less than check interval"),W(e),0===Object.keys(e).length},V=async t=>{if(t.preventDefault(),!K()){R("Please fix the form errors before submitting");return}O(!0),R(null);try{let t={...E,organization_id:n.id,monitoring_locations:E.monitoring_locations,target_port:"tcp"===E.check_type?80:null};console.log("Form - selectedOrganization:",n),console.log("Form - formData:",E),console.log("Form - submitData:",t);let r=await fetch("/api/monitoring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.json();console.error("API Error Response:",e);let t="Failed to create monitoring check";throw e.error&&(t=e.error),e.details&&(t+=": ".concat(e.details)),e.debug&&console.error("Debug info:",e.debug),Error(t)}await r.json(),L(!0),setTimeout(()=>{e.push("/monitoring")},2e3)}catch(e){console.error("Error creating monitoring check:",e),R(e.message)}finally{O(!1)}},Q=(e,t)=>{H(n=>({...n,[e]:t})),U[e]&&W(t=>({...t,[e]:""}))},X=e=>{H(t=>({...t,http_headers:Object.keys(t.http_headers).reduce((n,r)=>(r!==e&&(n[r]=t.http_headers[r]),n),{})}))},Y=e=>{H(t=>({...t,expected_status_codes:t.expected_status_codes.filter(t=>t!==e)}))};return(0,r.jsx)(I.Z,{children:F?(0,r.jsx)(o.Z,{sx:{p:3},children:(0,r.jsx)(i.Z,{severity:"success",sx:{mb:2},children:"Monitoring check created successfully! Redirecting to monitoring dashboard..."})}):(0,r.jsxs)(o.Z,{sx:{p:3},children:[(0,r.jsxs)(o.Z,{display:"flex",alignItems:"center",gap:2,mb:4,children:[(0,r.jsx)(s.Z,{component:S.default,href:"/monitoring",startIcon:(0,r.jsx)(T.Z,{}),variant:"outlined",children:"Back to Monitoring"}),(0,r.jsx)(l.Z,{variant:"h4",component:"h1",children:"Create Monitoring Check"})]}),M&&(0,r.jsx)(i.Z,{severity:"error",sx:{mb:2},children:M}),(0,r.jsx)(c.Z,{children:(0,r.jsx)(d.Z,{children:(0,r.jsx)("form",{onSubmit:V,children:(0,r.jsxs)(h.Z,{container:!0,spacing:3,children:[(0,r.jsxs)(h.Z,{item:!0,xs:12,children:[n?(0,r.jsxs)(i.Z,{severity:"success",sx:{mb:2},children:[(0,r.jsx)("strong",{children:"Creating monitoring check for:"})," \uD83C\uDFE2"," ",n.name]}):(0,r.jsxs)(i.Z,{severity:"warning",sx:{mb:2},children:[(0,r.jsx)("strong",{children:"Please select an organization"})," from the dropdown in the top navigation bar to create a monitoring check."]}),U.organization&&(0,r.jsx)(i.Z,{severity:"error",sx:{mb:2},children:U.organization})]}),(0,r.jsx)(h.Z,{item:!0,xs:12,children:(0,r.jsx)(u.Z,{fullWidth:!0,label:"Monitor Name *",value:E.name,onChange:e=>Q("name",e.target.value),error:!!U.name,helperText:U.name||"A descriptive name for this monitoring check",placeholder:"e.g., Main Website HTTP Check"})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,r.jsxs)(g.Z,{fullWidth:!0,children:[(0,r.jsx)(m.Z,{children:"Check Type"}),(0,r.jsxs)(x.Z,{value:E.check_type,label:"Check Type",onChange:e=>Q("check_type",e.target.value),children:[(0,r.jsx)(p.Z,{value:"http",children:"HTTP/HTTPS"}),(0,r.jsx)(p.Z,{value:"ping",children:"Ping"}),(0,r.jsx)(p.Z,{value:"tcp",children:"TCP Port"}),(0,r.jsx)(p.Z,{value:"ssl",children:"SSL Certificate"})]}),(0,r.jsx)(f.Z,{children:(e=>{switch(e){case"http":return"Monitor HTTP/HTTPS endpoints for availability and response time";case"ping":return"Check network connectivity using ICMP ping";case"tcp":return"Test TCP port connectivity";case"ssl":return"Monitor SSL certificate validity and expiration";default:return""}})(E.check_type)})]})}),(0,r.jsx)(h.Z,{item:!0,xs:12,children:(0,r.jsx)(u.Z,{fullWidth:!0,label:"ping"===E.check_type?"Hostname or IP Address *":"tcp"===E.check_type?"Target Host:Port *":"ssl"===E.check_type?"Hostname or URL *":"Target URL *",value:E.target_url,onChange:e=>Q("target_url",e.target.value),error:!!U.target_url,helperText:U.target_url||("ping"===E.check_type?"The hostname or IP address to ping":"tcp"===E.check_type?"The hostname:port or IP:port to check":"ssl"===E.check_type?"The hostname or URL to check SSL certificate":"The URL or endpoint to monitor"),placeholder:"ping"===E.check_type?"example.com or 192.168.1.1":"tcp"===E.check_type?"example.com:80 or 192.168.1.1:443":"ssl"===E.check_type?"example.com or https://example.com":"https://example.com"})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,r.jsx)(u.Z,{fullWidth:!0,type:"number",label:"Check Interval (seconds)",value:E.check_interval_seconds,onChange:e=>Q("check_interval_seconds",parseInt(e.target.value)),error:!!U.check_interval_seconds,helperText:U.check_interval_seconds||"How often to run the check (minimum 60 seconds)",inputProps:{min:60,max:3600}})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,r.jsx)(u.Z,{fullWidth:!0,type:"number",label:"Timeout (seconds)",value:E.timeout_seconds,onChange:e=>Q("timeout_seconds",parseInt(e.target.value)),error:!!U.timeout_seconds,helperText:U.timeout_seconds||"Maximum time to wait for response",inputProps:{min:1,max:300}})}),"http"===E.check_type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(h.Z,{item:!0,xs:12,children:[(0,r.jsx)(_.Z,{sx:{my:2}}),(0,r.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:"HTTP Settings"})]}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,r.jsxs)(g.Z,{fullWidth:!0,children:[(0,r.jsx)(m.Z,{children:"HTTP Method"}),(0,r.jsxs)(x.Z,{value:E.http_method,label:"HTTP Method",onChange:e=>Q("http_method",e.target.value),children:[(0,r.jsx)(p.Z,{value:"GET",children:"GET"}),(0,r.jsx)(p.Z,{value:"POST",children:"POST"}),(0,r.jsx)(p.Z,{value:"PUT",children:"PUT"}),(0,r.jsx)(p.Z,{value:"HEAD",children:"HEAD"})]})]})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,r.jsx)(j.Z,{control:(0,r.jsx)(Z.Z,{checked:E.follow_redirects,onChange:e=>Q("follow_redirects",e.target.checked)}),label:"Follow Redirects"})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,r.jsx)(j.Z,{control:(0,r.jsx)(Z.Z,{checked:E.ssl_check_enabled,onChange:e=>Q("ssl_check_enabled",e.target.checked)}),label:"SSL Certificate Check"})}),(0,r.jsxs)(h.Z,{item:!0,xs:12,children:[(0,r.jsx)(l.Z,{variant:"subtitle2",gutterBottom:!0,children:"Expected Status Codes"}),(0,r.jsxs)(o.Z,{display:"flex",gap:1,alignItems:"center",mb:1,children:[(0,r.jsx)(u.Z,{size:"small",label:"Status Code",value:G,onChange:e=>J(e.target.value),placeholder:"200",inputProps:{min:100,max:599},sx:{width:150}}),(0,r.jsx)(s.Z,{onClick:()=>{let e=parseInt(G);e>=100&&e<=599&&!E.expected_status_codes.includes(e)&&(H(t=>({...t,expected_status_codes:[...t.expected_status_codes,e]})),J(""))},disabled:!G,children:"Add"})]}),(0,r.jsx)(o.Z,{display:"flex",flexWrap:"wrap",gap:1,children:E.expected_status_codes.map(e=>(0,r.jsx)(v.Z,{label:e,onDelete:()=>Y(e),color:"primary",variant:"outlined"},e))})]}),(0,r.jsx)(h.Z,{item:!0,xs:12,children:(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(y.Z,{expandIcon:(0,r.jsx)(w.Z,{}),children:(0,r.jsx)(l.Z,{children:"Advanced HTTP Settings"})}),(0,r.jsx)(b.Z,{children:(0,r.jsxs)(h.Z,{container:!0,spacing:2,children:[(0,r.jsxs)(h.Z,{item:!0,xs:12,children:[(0,r.jsx)(l.Z,{variant:"subtitle2",gutterBottom:!0,children:"HTTP Headers"}),(0,r.jsxs)(o.Z,{display:"flex",gap:1,alignItems:"center",mb:1,children:[(0,r.jsx)(u.Z,{size:"small",label:"Header Name",value:N,onChange:e=>B(e.target.value),placeholder:"Authorization"}),(0,r.jsx)(u.Z,{size:"small",label:"Header Value",value:q,onChange:e=>$(e.target.value),placeholder:"Bearer token"}),(0,r.jsx)(s.Z,{onClick:()=>{N.trim()&&q.trim()&&(H(e=>({...e,http_headers:{...e.http_headers,[N.trim()]:q.trim()}})),B(""),$(""))},disabled:!N||!q,children:"Add"})]}),Object.entries(E.http_headers).map(e=>{let[t,n]=e;return(0,r.jsxs)(o.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,border:"1px solid #ddd",borderRadius:1,mb:1,children:[(0,r.jsxs)(l.Z,{variant:"body2",children:[(0,r.jsxs)("strong",{children:[t,":"]})," ",n]}),(0,r.jsx)(s.Z,{size:"small",onClick:()=>X(t),color:"error",children:"Remove"})]},t)})]}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:8,children:(0,r.jsx)(u.Z,{fullWidth:!0,label:"Keyword Match (Optional)",value:E.keyword_match,onChange:e=>Q("keyword_match",e.target.value),helperText:"Check if response contains specific text",placeholder:"Success"})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:4,children:(0,r.jsxs)(g.Z,{fullWidth:!0,children:[(0,r.jsx)(m.Z,{children:"Match Type"}),(0,r.jsxs)(x.Z,{value:E.keyword_match_type,label:"Match Type",onChange:e=>Q("keyword_match_type",e.target.value),children:[(0,r.jsx)(p.Z,{value:"contains",children:"Contains"}),(0,r.jsx)(p.Z,{value:"exact",children:"Exact Match"}),(0,r.jsx)(p.Z,{value:"regex",children:"Regular Expression"})]})]})})]})})]})})]}),(0,r.jsx)(h.Z,{item:!0,xs:12,children:(0,r.jsx)(j.Z,{control:(0,r.jsx)(Z.Z,{checked:E.is_active,onChange:e=>Q("is_active",e.target.checked)}),label:"Enable monitoring check"})}),(0,r.jsx)(h.Z,{item:!0,xs:12,children:(0,r.jsxs)(o.Z,{display:"flex",gap:2,justifyContent:"flex-end",sx:{mt:2},children:[(0,r.jsx)(s.Z,{component:S.default,href:"/monitoring",variant:"outlined",disabled:A,children:"Cancel"}),(0,r.jsx)(s.Z,{type:"submit",variant:"contained",startIcon:A?(0,r.jsx)(D.Z,{size:20}):(0,r.jsx)(z.Z,{}),disabled:A,color:"primary",children:A?"Creating...":"Create Monitor"})]})})]})})})})]})})}},85744:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(57437),a=n(2265),o=n(8319),i=n(38543),s=n(44812);function l(e){let{children:t}=e,{session:n,sessionStatus:l}=(0,s.o)();return((0,a.useEffect)(()=>{"unauthenticated"===l&&(window.location.href="/api/auth/signin")},[l]),"loading"===l)?(0,r.jsx)(i.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,r.jsx)(o.Z,{})}):n?t:null}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return l},o:function(){return c}});var r=n(57437),a=n(2265);let o=(0,a.createContext)(),i=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},s=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function l(e){let{children:t}=e,{data:n,status:l}=function(){let[e,t]=(0,a.useState)(null),[n,r]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let e=async()=>{try{r("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),r(n?"authenticated":"unauthenticated")}else t(null),r("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),r("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[c,d]=(0,a.useState)(null),[h,u]=(0,a.useState)([]),[g,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)(null),[f,_]=(0,a.useState)(!1);(0,a.useEffect)(()=>{_(!0)},[]),(0,a.useEffect)(()=>{if(f&&h.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=i();if(e){let t=h.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),s(null))}}},[f,h,c]),(0,a.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(l,"]")),n&&"authenticated"===l?j():"unauthenticated"===l&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),u([]),d(null),s(null))},[n,l]);let j=async()=>{try{m(!0),p(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];u(t);let n=null,r=i();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",r),r&&((n=t.find(e=>e.id===r))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),s(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let r=await e.json();if(r.hasDefault){let e=t.find(e=>e.id===r.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),d(n),s(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),s(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),p("Failed to fetch organizations"),u([])}catch(e){console.error("Error fetching organizations:",e),p(e.message),u([])}finally{m(!1)}};return(0,r.jsx)(o.Provider,{value:{selectedOrganization:c,organizations:h,loading:g,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),s((null==e?void 0:e.id)||null)},refreshOrganizations:j,session:n,sessionStatus:l},children:t})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,8129,4502,2413,7596,2519,2971,7466,1744],function(){return e(e.s=77952)}),_N_E=e.O()}]);