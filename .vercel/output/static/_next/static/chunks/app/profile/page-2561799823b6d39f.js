(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4178],{46084:function(e,n,t){Promise.resolve().then(t.bind(t,25667))},25667:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return T}});var i=t(57437),o=t(2265),a=t(99376),l=t(31504),s=t(38543),r=t(8319),c=t(90658),d=t(33101),u=t(19352),h=t(41563),g=t(61002),m=t(77639),x=t(31835),f=t(22347),j=t(9391),p=t(73088),Z=t(95280),v=t(52854),y=t(50793),D=t(67615),b=t(64502),S=t(95488),z=t(11617),C=t(3484),w=t(22292),_=t(43126),E=t(93750),k=t(19633),A=t(44812);function T(){var e;let{session:n,sessionStatus:t}=(0,A.o)(),T=(0,a.useRouter)(),[I,P]=(0,o.useState)({name:"",email:"",phone:"",notification_preferences:{email:!0,sms:!1,push:!0}}),[O,F]=(0,o.useState)(!1),[M,N]=(0,o.useState)(!1),[B,W]=(0,o.useState)(""),[G,U]=(0,o.useState)(""),[L,J]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if("unauthenticated"===t){T.push("/api/auth/signin");return}(null==n?void 0:n.user)&&R()},[n,t,T]);let R=async()=>{F(!0);try{let e=await fetch("/api/user/profile");if(e.ok){let t=await e.json(),i=t.user||t;P({name:i.name||n.user.name||"",email:i.email||n.user.email||"",phone:i.phone_number||i.phone||"",timezone:i.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,notification_preferences:i.notification_preferences||{email_incidents:!0,email_escalations:!0,sms_critical:!1,sms_escalations:!1}})}}catch(e){console.error("Error fetching profile:",e),W("Failed to load profile data")}finally{F(!1)}},Y=async()=>{N(!0),W(""),U("");try{let e=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(!e.ok){let n=await e.json();throw Error(n.error||"Failed to update profile")}U("Profile updated successfully!"),J(!1),setTimeout(()=>U(""),3e3)}catch(e){W(e.message)}finally{N(!1)}},H=(e,n)=>{P(t=>({...t,[e]:n}))},$=(e,n)=>{P(t=>({...t,notification_preferences:{...t.notification_preferences,[e]:n}}))},q=e=>!e||/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""));return"loading"===t||O?(0,i.jsx)(l.Z,{maxWidth:"md",sx:{py:4},children:(0,i.jsx)(s.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,i.jsx)(r.Z,{})})}):n?(0,i.jsxs)(l.Z,{maxWidth:"md",sx:{py:4},children:[(0,i.jsxs)(s.Z,{sx:{mb:4},children:[(0,i.jsx)(c.Z,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold"},children:"\uD83D\uDC64 My Profile"}),(0,i.jsx)(c.Z,{variant:"body1",color:"text.secondary",children:"Manage your account information and notification preferences"})]}),B&&(0,i.jsx)(d.Z,{severity:"error",sx:{mb:3},children:B}),G&&(0,i.jsx)(d.Z,{severity:"success",sx:{mb:3},children:G}),(0,i.jsxs)(u.Z,{container:!0,spacing:3,children:[(0,i.jsx)(u.Z,{item:!0,xs:12,md:8,children:(0,i.jsx)(h.Z,{children:(0,i.jsxs)(g.Z,{children:[(0,i.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,i.jsxs)(c.Z,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(S.Z,{color:"primary"}),"Personal Information"]}),(0,i.jsx)(m.Z,{startIcon:L?(0,i.jsx)(z.Z,{}):(0,i.jsx)(C.Z,{}),variant:L?"contained":"outlined",onClick:L?Y:()=>J(!0),disabled:M,children:M?(0,i.jsx)(r.Z,{size:20}):L?"Save Changes":"Edit Profile"})]}),(0,i.jsxs)(u.Z,{container:!0,spacing:3,children:[(0,i.jsx)(u.Z,{item:!0,xs:12,sm:6,children:(0,i.jsx)(x.Z,{fullWidth:!0,label:"Full Name",value:I.name,onChange:e=>H("name",e.target.value),disabled:!L,InputProps:{startAdornment:(0,i.jsx)(S.Z,{sx:{mr:1,color:"action.active"}})}})}),(0,i.jsx)(u.Z,{item:!0,xs:12,sm:6,children:(0,i.jsx)(x.Z,{fullWidth:!0,label:"Email Address",type:"email",value:I.email,onChange:e=>H("email",e.target.value),disabled:!L,InputProps:{startAdornment:(0,i.jsx)(w.Z,{sx:{mr:1,color:"action.active"}})}})}),(0,i.jsx)(u.Z,{item:!0,xs:12,sm:6,children:(0,i.jsx)(x.Z,{fullWidth:!0,label:"Phone Number",value:I.phone,onChange:e=>H("phone",e.target.value),disabled:!L,placeholder:"+1 (555) 123-4567",error:!q(I.phone),helperText:q(I.phone)?"For SMS notifications and calls":"Please enter a valid phone number",InputProps:{startAdornment:(0,i.jsx)(_.Z,{sx:{mr:1,color:"action.active"}})}})}),(0,i.jsx)(u.Z,{item:!0,xs:12,sm:6,children:(0,i.jsxs)(f.Z,{fullWidth:!0,disabled:!L,children:[(0,i.jsx)(j.Z,{children:"Timezone"}),(0,i.jsxs)(p.Z,{value:I.timezone,label:"Timezone",onChange:e=>H("timezone",e.target.value),children:[(0,i.jsx)(Z.Z,{value:"America/New_York",children:"Eastern Time (ET)"}),(0,i.jsx)(Z.Z,{value:"America/Chicago",children:"Central Time (CT)"}),(0,i.jsx)(Z.Z,{value:"America/Denver",children:"Mountain Time (MT)"}),(0,i.jsx)(Z.Z,{value:"America/Los_Angeles",children:"Pacific Time (PT)"}),(0,i.jsx)(Z.Z,{value:"UTC",children:"UTC"}),(0,i.jsx)(Z.Z,{value:"Europe/London",children:"London (GMT)"}),(0,i.jsx)(Z.Z,{value:"Europe/Berlin",children:"Berlin (CET)"}),(0,i.jsx)(Z.Z,{value:"Asia/Tokyo",children:"Tokyo (JST)"})]})]})})]})]})})}),(0,i.jsx)(u.Z,{item:!0,xs:12,md:4,children:(0,i.jsx)(h.Z,{children:(0,i.jsxs)(g.Z,{sx:{textAlign:"center"},children:[(0,i.jsx)(v.Z,{src:null===(e=n.user)||void 0===e?void 0:e.image,alt:I.name,sx:{width:120,height:120,mx:"auto",mb:2}}),(0,i.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:I.name||"User"}),(0,i.jsx)(y.Z,{label:"Account Active",color:"success",size:"small",sx:{mb:2}}),(0,i.jsx)(c.Z,{variant:"body2",color:"text.secondary",children:"Signed in via Google OAuth"})]})})}),(0,i.jsx)(u.Z,{item:!0,xs:12,children:(0,i.jsx)(h.Z,{children:(0,i.jsxs)(g.Z,{children:[(0,i.jsxs)(c.Z,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(E.Z,{color:"primary"}),"Notification Preferences"]}),(0,i.jsx)(c.Z,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Choose how you want to be notified about incidents and escalations"}),(0,i.jsxs)(u.Z,{container:!0,spacing:2,children:[(0,i.jsx)(u.Z,{item:!0,xs:12,sm:6,children:(0,i.jsx)(D.Z,{control:(0,i.jsx)(b.Z,{checked:I.notification_preferences.email_incidents,onChange:e=>$("email_incidents",e.target.checked),disabled:!L}),label:"Email - New Incidents"})}),(0,i.jsx)(u.Z,{item:!0,xs:12,sm:6,children:(0,i.jsx)(D.Z,{control:(0,i.jsx)(b.Z,{checked:I.notification_preferences.email_escalations,onChange:e=>$("email_escalations",e.target.checked),disabled:!L}),label:"Email - Escalations"})}),(0,i.jsxs)(u.Z,{item:!0,xs:12,sm:6,children:[(0,i.jsx)(D.Z,{control:(0,i.jsx)(b.Z,{checked:I.notification_preferences.sms_critical,onChange:e=>$("sms_critical",e.target.checked),disabled:!L||!I.phone}),label:"SMS - Critical Incidents"}),!I.phone&&(0,i.jsx)(c.Z,{variant:"caption",color:"text.secondary",display:"block",children:"Add phone number to enable SMS notifications"})]}),(0,i.jsxs)(u.Z,{item:!0,xs:12,sm:6,children:[(0,i.jsx)(D.Z,{control:(0,i.jsx)(b.Z,{checked:I.notification_preferences.sms_escalations,onChange:e=>$("sms_escalations",e.target.checked),disabled:!L||!I.phone}),label:"SMS - Escalations"}),!I.phone&&(0,i.jsx)(c.Z,{variant:"caption",color:"text.secondary",display:"block",children:"Add phone number to enable SMS notifications"})]})]})]})})}),(0,i.jsx)(u.Z,{item:!0,xs:12,children:(0,i.jsx)(h.Z,{children:(0,i.jsxs)(g.Z,{children:[(0,i.jsxs)(c.Z,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(k.Z,{color:"primary"}),"Security & Account"]}),(0,i.jsxs)(s.Z,{sx:{mt:2},children:[(0,i.jsx)(c.Z,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Your account is secured with Google OAuth. To change your password or manage additional security settings, please visit your Google Account settings."}),(0,i.jsx)(m.Z,{variant:"outlined",onClick:()=>window.open("https://myaccount.google.com/security","_blank"),sx:{mt:2},children:"Manage Google Account Security"})]})]})})})]})]}):null}},44812:function(e,n,t){"use strict";t.d(n,{f:function(){return r},o:function(){return c}});var i=t(57437),o=t(2265);let a=(0,o.createContext)(),l=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},s=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function r(e){let{children:n}=e,{data:t,status:r}=function(){let[e,n]=(0,o.useState)(null),[t,i]=(0,o.useState)("loading");return(0,o.useEffect)(()=>{let e=async()=>{try{i("loading");let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();n(t),i(t?"authenticated":"unauthenticated")}else n(null),i("unauthenticated")}catch(e){console.error("Error fetching session:",e),n(null),i("unauthenticated")}};e();let t=setInterval(e,3e5);return()=>clearInterval(t)},[]),{data:e,status:t}}(),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)([]),[g,m]=(0,o.useState)(!1),[x,f]=(0,o.useState)(null),[j,p]=(0,o.useState)(!1);(0,o.useEffect)(()=>{p(!0)},[]),(0,o.useEffect)(()=>{if(j&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=l();if(e){let n=u.find(n=>n.id===e);n?(console.log("\uD83D\uDD04 Client-side restoration successful:",n.name),d(n)):(console.log("⚠️ Saved organization no longer available, clearing storage"),s(null))}}},[j,u,c]),(0,o.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email)||"no session","[".concat(r,"]")),t&&"authenticated"===r?Z():"unauthenticated"===r&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),s(null))},[t,r]);let Z=async()=>{try{m(!0),f(null);let e=await fetch("/api/organizations");if(e.ok){let n=(await e.json()).organizations||[];h(n);let t=null,i=l();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",i),i&&((t=n.find(e=>e.id===i))?console.log("\uD83C\uDFAF Found matching organization for restoration:",t.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),s(null))),!t&&n.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let i=await e.json();if(i.hasDefault){let e=n.find(e=>e.id===i.defaultOrganization.id);e&&(t=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(t)console.log("✅ Selected organization:",t.name),d(t),s(t.id);else if(1===n.length){let e=n[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),s(e.id)}else 0===n.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),f("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),f(e.message),h([])}finally{m(!1)}};return(0,i.jsx)(a.Provider,{value:{selectedOrganization:c,organizations:u,loading:g,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),s((null==e?void 0:e.id)||null)},refreshOrganizations:Z,session:t,sessionStatus:r},children:n})}function c(){let e=(0,o.useContext)(a);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,4502,8855,8050,2971,7466,1744],function(){return e(e.s=46084)}),_N_E=e.O()}]);