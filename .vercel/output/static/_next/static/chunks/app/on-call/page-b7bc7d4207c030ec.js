(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5093],{77746:function(e,t,n){Promise.resolve().then(n.bind(n,46814))},46814:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return P}});var r=n(57437),l=n(2265),o=n(38543),a=n(90658),i=n(18150),c=n(36261),s=n(77639),d=n(33101),u=n(8319),h=n(19352),g=n(41563),f=n(61002),x=n(82995),m=n(88654),Z=n(68045),v=n(66838),j=n(16116),p=n(46382),y=n(16875),D=n(52854),S=n(50793),b=n(64502),w=n(60370),z=n(95280),C=n(27648),_=n(89470),k=n(99636),E=n(3484),A=n(19391),I=n(20599),F=n(44812),O=n(85744);function P(){let[e,t]=(0,l.useState)([]),[n,P]=(0,l.useState)(!0),[M,N]=(0,l.useState)(null),[R,T]=(0,l.useState)(null),[B,H]=(0,l.useState)(null),{session:L,selectedOrganization:U}=(0,F.o)();(0,l.useEffect)(()=>{L&&V()},[L,U]);let V=async()=>{try{P(!0),N(null);let e=new URLSearchParams;(null==U?void 0:U.id)&&e.append("organization_id",U.id);let n=await fetch("/api/on-call-schedules?".concat(e.toString()));if(!n.ok)throw Error("Failed to fetch on-call schedules");let r=await n.json();t(r.on_call_schedules||[])}catch(e){console.error("Error fetching schedules:",e),N(e.message)}finally{P(!1)}},q=async(e,t)=>{try{if(!(await fetch("/api/on-call-schedules/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:!t})})).ok)throw Error("Failed to update schedule status");V()}catch(e){console.error("Error toggling schedule:",e),N(e.message)}},W=(e,t)=>{T(e.currentTarget),H(t)},J=()=>{T(null),H(null)},G=async e=>{if(confirm("Are you sure you want to delete this on-call schedule? This action cannot be undone."))try{if(!(await fetch("/api/on-call-schedules/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete schedule");V(),J()}catch(e){console.error("Error deleting schedule:",e),N(e.message)}},K=e=>e?new Date(e).toLocaleString():"N/A",Q=e=>e.is_active?e.current_on_call_member?{label:"Active",color:"success"}:{label:"Configured",color:"info"}:{label:"Inactive",color:"default"},X=e=>e.current_on_call_member?e.current_on_call_member.name||e.current_on_call_member.email:"None",Y={total:e.length,active:e.filter(e=>e.is_active).length,withOnCall:e.filter(e=>e.is_active&&e.current_on_call_member).length,inactive:e.filter(e=>!e.is_active).length};return(0,r.jsx)(O.Z,{children:(0,r.jsxs)(o.Z,{sx:{p:3},children:[(0,r.jsxs)(o.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(a.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"On-Call Schedules"}),(0,r.jsx)(a.Z,{variant:"body1",color:"text.secondary",children:"Manage team on-call rotations and schedules"})]}),(0,r.jsxs)(o.Z,{display:"flex",gap:2,children:[(0,r.jsx)(i.Z,{title:"Refresh",children:(0,r.jsx)(c.Z,{onClick:V,color:"primary",children:(0,r.jsx)(k.Z,{})})}),(0,r.jsx)(s.Z,{component:C.default,href:"/on-call/new",variant:"contained",startIcon:(0,r.jsx)(_.Z,{}),color:"primary",children:"Add Schedule"})]})]}),M&&(0,r.jsx)(d.Z,{severity:"error",sx:{mb:2},children:M}),n?(0,r.jsx)(o.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,r.jsx)(u.Z,{})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(h.Z,{container:!0,spacing:3,sx:{mb:4},children:[(0,r.jsx)(h.Z,{item:!0,xs:12,md:3,children:(0,r.jsx)(g.Z,{children:(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Total Schedules"}),(0,r.jsx)(a.Z,{variant:"h3",color:"primary",children:Y.total})]})})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:3,children:(0,r.jsx)(g.Z,{children:(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Active"}),(0,r.jsx)(a.Z,{variant:"h3",color:"success.main",children:Y.active})]})})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:3,children:(0,r.jsx)(g.Z,{children:(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"With On-Call"}),(0,r.jsx)(a.Z,{variant:"h3",color:"info.main",children:Y.withOnCall})]})})}),(0,r.jsx)(h.Z,{item:!0,xs:12,md:3,children:(0,r.jsx)(g.Z,{children:(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Inactive"}),(0,r.jsx)(a.Z,{variant:"h3",color:"warning.main",children:Y.inactive})]})})})]}),(0,r.jsx)(g.Z,{children:(0,r.jsx)(f.Z,{sx:{p:0},children:0===e.length?(0,r.jsxs)(o.Z,{textAlign:"center",py:6,children:[(0,r.jsx)(a.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No on-call schedules found"}),(0,r.jsx)(a.Z,{variant:"body2",color:"text.secondary",mb:3,children:"Create your first on-call schedule to start managing rotations."}),(0,r.jsx)(s.Z,{component:C.default,href:"/on-call/new",variant:"contained",startIcon:(0,r.jsx)(_.Z,{}),color:"primary",children:"Add Schedule"})]}):(0,r.jsx)(x.Z,{component:m.Z,elevation:0,children:(0,r.jsxs)(Z.Z,{children:[(0,r.jsx)(v.Z,{children:(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(p.Z,{children:"Schedule Name"}),(0,r.jsx)(p.Z,{children:"Currently On-Call"}),(0,r.jsx)(p.Z,{children:"Status"}),(0,r.jsx)(p.Z,{children:"Created"}),(0,r.jsx)(p.Z,{align:"center",children:"Active"}),(0,r.jsx)(p.Z,{align:"center",children:"Actions"})]})}),(0,r.jsx)(y.Z,{children:e.map(e=>{let t=Q(e);return(0,r.jsxs)(j.Z,{hover:!0,children:[(0,r.jsx)(p.Z,{children:(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(a.Z,{variant:"body1",fontWeight:"medium",children:e.name||"Unnamed Schedule"}),(0,r.jsx)(a.Z,{variant:"body2",color:"text.secondary",children:e.description||"No description"})]})}),(0,r.jsx)(p.Z,{children:(0,r.jsxs)(o.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,r.jsx)(D.Z,{sx:{width:32,height:32},children:X(e).charAt(0)}),(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(a.Z,{variant:"body2",children:X(e)}),e.current_on_call_member&&(0,r.jsx)(a.Z,{variant:"caption",color:"text.secondary",children:e.current_on_call_member.email})]})]})}),(0,r.jsx)(p.Z,{children:(0,r.jsx)(S.Z,{label:t.label,color:t.color,size:"small",variant:"outlined"})}),(0,r.jsx)(p.Z,{children:(0,r.jsx)(a.Z,{variant:"body2",children:K(e.created_at)})}),(0,r.jsx)(p.Z,{align:"center",children:(0,r.jsx)(b.Z,{checked:e.is_active,onChange:()=>q(e.id,e.is_active),color:"primary",size:"small"})}),(0,r.jsxs)(p.Z,{align:"center",children:[(0,r.jsx)(i.Z,{title:"Edit Schedule",children:(0,r.jsx)(c.Z,{component:C.default,href:"/on-call/".concat(e.id,"/edit"),size:"small",color:"primary",children:(0,r.jsx)(E.Z,{})})}),(0,r.jsx)(i.Z,{title:"More actions",children:(0,r.jsx)(c.Z,{size:"small",onClick:t=>W(t,e),children:(0,r.jsx)(A.Z,{})})})]})]},e.id)})})]})})})}),(0,r.jsxs)(w.Z,{anchorEl:R,open:!!R,onClose:J,children:[(0,r.jsxs)(z.Z,{component:C.default,href:"/on-call/".concat(null==B?void 0:B.id,"/edit"),onClick:J,children:[(0,r.jsx)(E.Z,{sx:{mr:1}}),"Edit Schedule"]}),(0,r.jsxs)(z.Z,{onClick:()=>{B&&q(B.id,B.is_active),J()},children:[(null==B?void 0:B.is_active)?"Disable":"Enable"," Schedule"]}),(0,r.jsxs)(z.Z,{onClick:()=>{B&&G(B.id)},sx:{color:"error.main"},children:[(0,r.jsx)(I.Z,{sx:{mr:1}}),"Delete Schedule"]})]})]})]})})}},85744:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(57437),l=n(2265),o=n(8319),a=n(38543),i=n(44812);function c(e){let{children:t}=e,{session:n,sessionStatus:c}=(0,i.o)();return((0,l.useEffect)(()=>{"unauthenticated"===c&&(window.location.href="/api/auth/signin")},[c]),"loading"===c)?(0,r.jsx)(a.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,r.jsx)(o.Z,{})}):n?t:null}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return c},o:function(){return s}});var r=n(57437),l=n(2265);let o=(0,l.createContext)(),a=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},i=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function c(e){let{children:t}=e,{data:n,status:c}=function(){let[e,t]=(0,l.useState)(null),[n,r]=(0,l.useState)("loading");return(0,l.useEffect)(()=>{let e=async()=>{try{r("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),r(n?"authenticated":"unauthenticated")}else t(null),r("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),r("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[s,d]=(0,l.useState)(null),[u,h]=(0,l.useState)([]),[g,f]=(0,l.useState)(!1),[x,m]=(0,l.useState)(null),[Z,v]=(0,l.useState)(!1);(0,l.useEffect)(()=>{v(!0)},[]),(0,l.useEffect)(()=>{if(Z&&u.length>0&&!s){console.log("\uD83D\uDD0D Client-side restoration check...");let e=a();if(e){let t=u.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),i(null))}}},[Z,u,s]),(0,l.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(c,"]")),n&&"authenticated"===c?j():"unauthenticated"===c&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),i(null))},[n,c]);let j=async()=>{try{f(!0),m(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];h(t);let n=null,r=a();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",r),r&&((n=t.find(e=>e.id===r))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),i(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let r=await e.json();if(r.hasDefault){let e=t.find(e=>e.id===r.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),d(n),i(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),i(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),m("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),m(e.message),h([])}finally{f(!1)}};return(0,r.jsx)(o.Provider,{value:{selectedOrganization:s,organizations:u,loading:g,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),i((null==e?void 0:e.id)||null)},refreshOrganizations:j,session:n,sessionStatus:c},children:t})}function s(){let e=(0,l.useContext)(o);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},89470:function(e,t,n){"use strict";var r=n(64059),l=n(57437);t.Z=(0,r.Z)((0,l.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},20599:function(e,t,n){"use strict";var r=n(64059),l=n(57437);t.Z=(0,r.Z)((0,l.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},19391:function(e,t,n){"use strict";var r=n(64059),l=n(57437);t.Z=(0,r.Z)((0,l.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},52854:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var r=n(2265),l=n(61994),o=n(7609),a=n(1589),i=n(1190),c=n(42318),s=n(64059),d=n(57437),u=(0,s.Z)((0,d.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person"),h=n(15245),g=n(11475);function f(e){return(0,g.ZP)("MuiAvatar",e)}(0,h.Z)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var x=n(69921);let m=e=>{let{classes:t,variant:n,colorDefault:r}=e;return(0,o.Z)({root:["root",n,r&&"colorDefault"],img:["img"],fallback:["fallback"]},f,t)},Z=(0,a.ZP)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[n.variant],n.colorDefault&&t.colorDefault]}})((0,i.Z)(e=>{let{theme:t}=e;return{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:{color:(t.vars||t).palette.background.default,...t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:{backgroundColor:t.palette.grey[400],...t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})}}}]}})),v=(0,a.ZP)("img",{name:"MuiAvatar",slot:"Img"})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),j=(0,a.ZP)(u,{name:"MuiAvatar",slot:"Fallback"})({width:"75%",height:"75%"});var p=r.forwardRef(function(e,t){let n=(0,c.i)({props:e,name:"MuiAvatar"}),{alt:o,children:a,className:i,component:s="div",slots:u={},slotProps:h={},imgProps:g,sizes:f,src:p,srcSet:y,variant:D="circular",...S}=n,b=null,w={...n,component:s,variant:D},z=function(e){let{crossOrigin:t,referrerPolicy:n,src:l,srcSet:o}=e,[a,i]=r.useState(!1);return r.useEffect(()=>{if(!l&&!o)return;i(!1);let e=!0,r=new Image;return r.onload=()=>{e&&i("loaded")},r.onerror=()=>{e&&i("error")},r.crossOrigin=t,r.referrerPolicy=n,r.src=l,o&&(r.srcset=o),()=>{e=!1}},[t,n,l,o]),a}({...g,..."function"==typeof h.img?h.img(w):h.img,src:p,srcSet:y}),C=p||y,_=C&&"error"!==z;w.colorDefault=!_,delete w.ownerState;let k=m(w),[E,A]=(0,x.Z)("root",{ref:t,className:(0,l.Z)(k.root,i),elementType:Z,externalForwardedProps:{slots:u,slotProps:h,component:s,...S},ownerState:w}),[I,F]=(0,x.Z)("img",{className:k.img,elementType:v,externalForwardedProps:{slots:u,slotProps:{img:{...g,...h.img}}},additionalProps:{alt:o,src:p,srcSet:y,sizes:f},ownerState:w}),[O,P]=(0,x.Z)("fallback",{className:k.fallback,elementType:j,externalForwardedProps:{slots:u,slotProps:h},shouldForwardComponentProp:!0,ownerState:w});return b=_?(0,d.jsx)(I,{...F}):a||0===a?a:C&&o?o[0]:(0,d.jsx)(O,{...P}),(0,d.jsx)(E,{...A,children:b})})},60070:function(e,t,n){"use strict";let r=n(2265).createContext(void 0);t.Z=r},94811:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2265),l=n(60070);function o(){return r.useContext(l.Z)}}},function(e){e.O(0,[702,7639,7863,793,9352,8129,7286,8150,4502,6043,2971,7466,1744],function(){return e(e.s=77746)}),_N_E=e.O()}]);