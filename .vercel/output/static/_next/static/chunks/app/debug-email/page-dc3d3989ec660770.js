(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{28482:function(e,t,n){Promise.resolve().then(n.bind(n,51457))},51457:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var o=n(57437),a=n(2265),i=n(38543),r=n(90658),l=n(41563),s=n(61002),u=n(77639),c=n(8319),d=n(31835),g=n(33101),f=n(44812);function h(){var e;let[t,n]=(0,a.useState)(null),[h,v]=(0,a.useState)(!1),[m,D]=(0,a.useState)(""),{session:x}=(0,f.o)(),S=async()=>{v(!0),n(null);try{var e;let t=await fetch("/api/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testEmail:m||(null==x?void 0:null===(e=x.user)||void 0===e?void 0:e.email),action:"test"})}),o=await t.json();n(o)}catch(e){n({success:!1,error:e.message})}finally{v(!1)}},C=async()=>{v(!0),n(null);try{let e=await fetch("/api/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"check-config"})}),t=await e.json();n(t)}catch(e){n({success:!1,error:e.message})}finally{v(!1)}};return(0,o.jsxs)(i.Z,{sx:{p:3},children:[(0,o.jsx)(r.Z,{variant:"h4",gutterBottom:!0,children:"Email Service Debug"}),(0,o.jsx)(l.Z,{sx:{mb:3},children:(0,o.jsxs)(s.Z,{children:[(0,o.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Configuration Check"}),(0,o.jsx)(u.Z,{variant:"outlined",onClick:C,disabled:h,sx:{mr:2},children:h?(0,o.jsx)(c.Z,{size:20}):"Check Email Config"})]})}),(0,o.jsx)(l.Z,{sx:{mb:3},children:(0,o.jsxs)(s.Z,{children:[(0,o.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Send Test Email"}),(0,o.jsx)(d.Z,{label:"Test Email Address",value:m,onChange:e=>D(e.target.value),placeholder:(null==x?void 0:null===(e=x.user)||void 0===e?void 0:e.email)||"test@example.com",fullWidth:!0,sx:{mb:2}}),(0,o.jsx)(u.Z,{variant:"contained",onClick:S,disabled:h||!x,children:h?(0,o.jsx)(c.Z,{size:20}):"Send Test Email"})]})}),t&&(0,o.jsx)(l.Z,{children:(0,o.jsxs)(s.Z,{children:[(0,o.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Test Results"}),t.success?(0,o.jsx)(g.Z,{severity:"success",children:t.message}):(0,o.jsxs)(g.Z,{severity:"error",children:["Error: ",t.error]}),t.config&&(0,o.jsxs)(i.Z,{sx:{mt:2},children:[(0,o.jsx)(r.Z,{variant:"subtitle2",gutterBottom:!0,children:"Configuration Status:"}),(0,o.jsx)("pre",{style:{backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"4px",overflow:"auto",fontSize:"12px"},children:JSON.stringify(t.config,null,2)})]})]})}),!x&&(0,o.jsx)(g.Z,{severity:"info",children:"Please sign in to test email functionality."})]})}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return s},o:function(){return u}});var o=n(57437),a=n(2265);let i=(0,a.createContext)(),r=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},l=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function s(e){let{children:t}=e,{data:n,status:s}=function(){let[e,t]=(0,a.useState)(null),[n,o]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let e=async()=>{try{o("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),o(n?"authenticated":"unauthenticated")}else t(null),o("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),o("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[u,c]=(0,a.useState)(null),[d,g]=(0,a.useState)([]),[f,h]=(0,a.useState)(!1),[v,m]=(0,a.useState)(null),[D,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{x(!0)},[]),(0,a.useEffect)(()=>{if(D&&d.length>0&&!u){console.log("\uD83D\uDD0D Client-side restoration check...");let e=r();if(e){let t=d.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),c(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),l(null))}}},[D,d,u]),(0,a.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(s,"]")),n&&"authenticated"===s?S():"unauthenticated"===s&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),g([]),c(null),l(null))},[n,s]);let S=async()=>{try{h(!0),m(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];g(t);let n=null,o=r();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",o),o&&((n=t.find(e=>e.id===o))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),l(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let o=await e.json();if(o.hasDefault){let e=t.find(e=>e.id===o.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),c(n),l(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),c(e),l(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),c(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),m("Failed to fetch organizations"),g([])}catch(e){console.error("Error fetching organizations:",e),m(e.message),g([])}finally{h(!1)}};return(0,o.jsx)(i.Provider,{value:{selectedOrganization:u,organizations:d,loading:f,error:v,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),c(e),l((null==e?void 0:e.id)||null)},refreshOrganizations:S,session:n,sessionStatus:s},children:t})}function u(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},41563:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var o=n(2265),a=n(61994),i=n(7609),r=n(1589),l=n(42318),s=n(88654),u=n(15245),c=n(11475);function d(e){return(0,c.ZP)("MuiCard",e)}(0,u.Z)("MuiCard",["root"]);var g=n(57437);let f=e=>{let{classes:t}=e;return(0,i.Z)({root:["root"]},d,t)},h=(0,r.ZP)(s.Z,{name:"MuiCard",slot:"Root"})({overflow:"hidden"});var v=o.forwardRef(function(e,t){let n=(0,l.i)({props:e,name:"MuiCard"}),{className:o,raised:i=!1,...r}=n,s={...n,raised:i},u=f(s);return(0,g.jsx)(h,{className:(0,a.Z)(u.root,o),elevation:i?8:void 0,ref:t,ownerState:s,...r})})},61002:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var o=n(2265),a=n(61994),i=n(7609),r=n(1589),l=n(42318),s=n(15245),u=n(11475);function c(e){return(0,u.ZP)("MuiCardContent",e)}(0,s.Z)("MuiCardContent",["root"]);var d=n(57437);let g=e=>{let{classes:t}=e;return(0,i.Z)({root:["root"]},c,t)},f=(0,r.ZP)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}});var h=o.forwardRef(function(e,t){let n=(0,l.i)({props:e,name:"MuiCardContent"}),{className:o,component:i="div",...r}=n,s={...n,component:i},u=g(s);return(0,d.jsx)(f,{as:i,className:(0,a.Z)(u.root,o),ownerState:s,ref:t,...r})})}},function(e){e.O(0,[702,7639,7863,3744,1835,2971,7466,1744],function(){return e(e.s=28482)}),_N_E=e.O()}]);