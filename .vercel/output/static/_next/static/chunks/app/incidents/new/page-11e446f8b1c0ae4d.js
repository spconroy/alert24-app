(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2070],{78813:function(e,t,i){Promise.resolve().then(i.bind(i,92697))},92697:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return b}});var n=i(57437),a=i(2265),o=i(38543),r=i(33101),l=i(77639),s=i(90658),c=i(41563),d=i(61002),u=i(19352),g=i(22347),h=i(9391),f=i(73088),v=i(95280),m=i(25761),x=i(31835),p=i(27554),j=i(87410),Z=i(50793),y=i(8319),D=i(99376),z=i(27648),S=i(51442),w=i(11617),C=i(85744),_=i(44812);function b(){let e=(0,D.useRouter)(),{session:t}=(0,_.o)(),[i,b]=(0,a.useState)({organization_id:"",title:"",description:"",severity:"medium",status:"open",affected_services:[],impact_description:"",assigned_to:"",escalation_policy_id:"",tags:[]}),[E,I]=(0,a.useState)([]),[k,O]=(0,a.useState)([]),[P,T]=(0,a.useState)([]),[A,M]=(0,a.useState)([]),[W,F]=(0,a.useState)(!1),[N,R]=(0,a.useState)(null),[B,q]=(0,a.useState)(!1),[U,H]=(0,a.useState)({}),[L,J]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&K()},[t]),(0,a.useEffect)(()=>{i.organization_id&&G(i.organization_id)},[i.organization_id]);let K=async()=>{try{let t=await fetch("/api/organizations");if(t.ok){var e;let i=await t.json();I(i.organizations||[]),(null===(e=i.organizations)||void 0===e?void 0:e.length)===1&&b(e=>({...e,organization_id:i.organizations[0].id}))}}catch(e){console.error("Error fetching organizations:",e)}},G=async e=>{try{let t=await fetch("/api/escalation-policies?organization_id=".concat(e,"&active_only=true"));if(t.ok){let e=await t.json();O(e.escalation_policies||[])}let i=await fetch("/api/organizations/".concat(e));if(i.ok){let e=await i.json();T(e.members||[])}let n=await fetch("/api/services?organization_id=".concat(e));if(n.ok){let e=await n.json();M(e.services||[])}}catch(e){console.error("Error fetching organization data:",e)}},Q=()=>{let e={};return i.organization_id||(e.organization_id="Organization is required"),i.title.trim()||(e.title="Title is required"),i.description.trim()||(e.description="Description is required"),H(e),0===Object.keys(e).length},V=async n=>{if(n.preventDefault(),!Q()){R("Please fix the form errors before submitting");return}F(!0),R(null);try{var a,o;let n={organizationId:i.organization_id,title:i.title,description:i.description,severity:i.severity,status:i.status,affectedServices:i.affected_services.map(e=>"string"==typeof e?e:e.id),impactDescription:i.impact_description,assignedTo:i.assigned_to,createdBy:(null==t?void 0:null===(a=t.user)||void 0===a?void 0:a.id)||(null==t?void 0:null===(o=t.user)||void 0===o?void 0:o.email),escalationPolicyId:i.escalation_policy_id,tags:i.tags,source:"manual"},r=await fetch("/api/incidents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to create incident")}let l=await r.json();q(!0),setTimeout(()=>{e.push("/incidents/".concat(l.incident.id))},2e3)}catch(e){console.error("Error creating incident:",e),R(e.message)}finally{F(!1)}},X=(e,t)=>{b(i=>({...i,[e]:t})),U[e]&&H(t=>({...t,[e]:""}))},Y=()=>{L.trim()&&!i.tags.includes(L.trim())&&(b(e=>({...e,tags:[...e.tags,L.trim()]})),J(""))},$=e=>{b(t=>({...t,tags:t.tags.filter(t=>t!==e)}))};return(0,n.jsx)(C.Z,{children:B?(0,n.jsx)(o.Z,{sx:{p:3},children:(0,n.jsx)(r.Z,{severity:"success",sx:{mb:2},children:"Incident created successfully! Redirecting to incident details..."})}):(0,n.jsxs)(o.Z,{sx:{p:3},children:[(0,n.jsxs)(o.Z,{display:"flex",alignItems:"center",gap:2,mb:4,children:[(0,n.jsx)(l.Z,{component:z.default,href:"/incidents",startIcon:(0,n.jsx)(S.Z,{}),variant:"outlined",children:"Back to Incidents"}),(0,n.jsx)(s.Z,{variant:"h4",component:"h1",children:"Create New Incident"})]}),N&&(0,n.jsx)(r.Z,{severity:"error",sx:{mb:2},children:N}),(0,n.jsx)(c.Z,{children:(0,n.jsx)(d.Z,{children:(0,n.jsx)("form",{onSubmit:V,children:(0,n.jsxs)(u.Z,{container:!0,spacing:3,children:[(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsxs)(g.Z,{fullWidth:!0,error:!!U.organization_id,children:[(0,n.jsx)(h.Z,{children:"Organization *"}),(0,n.jsx)(f.Z,{value:i.organization_id,label:"Organization *",onChange:e=>X("organization_id",e.target.value),children:E.map(e=>(0,n.jsx)(v.Z,{value:e.id,children:e.name},e.id))}),U.organization_id&&(0,n.jsx)(m.Z,{children:U.organization_id})]})}),(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsx)(x.Z,{fullWidth:!0,label:"Incident Title *",value:i.title,onChange:e=>X("title",e.target.value),error:!!U.title,helperText:U.title||"A clear, concise description of the incident",placeholder:"e.g., API service experiencing high latency"})}),(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsx)(x.Z,{fullWidth:!0,multiline:!0,rows:4,label:"Description *",value:i.description,onChange:e=>X("description",e.target.value),error:!!U.description,helperText:U.description||"Detailed description of the incident and its impact",placeholder:"Describe the incident, when it started, symptoms, and any initial investigation findings..."})}),(0,n.jsx)(u.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(g.Z,{fullWidth:!0,children:[(0,n.jsx)(h.Z,{children:"Severity"}),(0,n.jsxs)(f.Z,{value:i.severity,label:"Severity",onChange:e=>X("severity",e.target.value),children:[(0,n.jsx)(v.Z,{value:"low",children:"Low"}),(0,n.jsx)(v.Z,{value:"medium",children:"Medium"}),(0,n.jsx)(v.Z,{value:"high",children:"High"}),(0,n.jsx)(v.Z,{value:"critical",children:"Critical"})]}),(0,n.jsxs)(m.Z,{children:["critical"===i.severity&&"Service completely unavailable","high"===i.severity&&"Major functionality impacted","medium"===i.severity&&"Some functionality impacted","low"===i.severity&&"Minor impact or cosmetic issue"]})]})}),(0,n.jsx)(u.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(g.Z,{fullWidth:!0,children:[(0,n.jsx)(h.Z,{children:"Status"}),(0,n.jsxs)(f.Z,{value:i.status,label:"Status",onChange:e=>X("status",e.target.value),children:[(0,n.jsx)(v.Z,{value:"open",children:"Open"}),(0,n.jsx)(v.Z,{value:"investigating",children:"Investigating"}),(0,n.jsx)(v.Z,{value:"monitoring",children:"Monitoring"}),(0,n.jsx)(v.Z,{value:"resolved",children:"Resolved"})]})]})}),(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsx)(x.Z,{fullWidth:!0,multiline:!0,rows:2,label:"Impact Description",value:i.impact_description,onChange:e=>X("impact_description",e.target.value),helperText:"Describe the customer or business impact",placeholder:"e.g., Users unable to login, checkout process failing for 25% of customers"})}),(0,n.jsxs)(u.Z,{item:!0,xs:12,children:[(0,n.jsx)(p.Z,{sx:{my:2}}),(0,n.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"Assignment & Escalation"})]}),(0,n.jsx)(u.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(g.Z,{fullWidth:!0,children:[(0,n.jsx)(h.Z,{children:"Assign To"}),(0,n.jsxs)(f.Z,{value:i.assigned_to,label:"Assign To",onChange:e=>X("assigned_to",e.target.value),children:[(0,n.jsx)(v.Z,{value:"",children:"Unassigned"}),P.map(e=>(0,n.jsx)(v.Z,{value:e.id,children:e.name||e.email},e.id))]})]})}),(0,n.jsx)(u.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(g.Z,{fullWidth:!0,children:[(0,n.jsx)(h.Z,{children:"Escalation Policy"}),(0,n.jsxs)(f.Z,{value:i.escalation_policy_id,label:"Escalation Policy",onChange:e=>X("escalation_policy_id",e.target.value),children:[(0,n.jsx)(v.Z,{value:"",children:"No escalation policy"}),k.map(e=>(0,n.jsx)(v.Z,{value:e.id,children:e.name},e.id))]})]})}),(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsx)(j.Z,{multiple:!0,options:A,getOptionLabel:e=>e.name||e,value:i.affected_services,onChange:(e,t)=>X("affected_services",t),renderInput:e=>(0,n.jsx)(x.Z,{...e,label:"Affected Services",helperText:"Select services affected by this incident"}),renderTags:(e,t)=>e.map((e,i)=>(0,a.createElement)(Z.Z,{variant:"outlined",label:e.name||e,...t({index:i}),key:i}))})}),(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(x.Z,{fullWidth:!0,label:"Add Tags",value:L,onChange:e=>J(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Y())},helperText:"Press Enter to add tags for categorization",InputProps:{endAdornment:(0,n.jsx)(l.Z,{onClick:Y,disabled:!L.trim(),children:"Add"})}}),i.tags.length>0&&(0,n.jsx)(o.Z,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:i.tags.map(e=>(0,n.jsx)(Z.Z,{label:e,onDelete:()=>$(e),color:"primary",variant:"outlined"},e))})]})}),(0,n.jsx)(u.Z,{item:!0,xs:12,children:(0,n.jsxs)(o.Z,{display:"flex",gap:2,justifyContent:"flex-end",sx:{mt:2},children:[(0,n.jsx)(l.Z,{component:z.default,href:"/incidents",variant:"outlined",disabled:W,children:"Cancel"}),(0,n.jsx)(l.Z,{type:"submit",variant:"contained",startIcon:W?(0,n.jsx)(y.Z,{size:20}):(0,n.jsx)(w.Z,{}),disabled:W,color:"error",children:W?"Creating...":"Create Incident"})]})})]})})})})]})})}},85744:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var n=i(57437),a=i(2265),o=i(8319),r=i(38543),l=i(44812);function s(e){let{children:t}=e,{session:i,sessionStatus:s}=(0,l.o)();return((0,a.useEffect)(()=>{"unauthenticated"===s&&(window.location.href="/api/auth/signin")},[s]),"loading"===s)?(0,n.jsx)(r.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,n.jsx)(o.Z,{})}):i?t:null}},44812:function(e,t,i){"use strict";i.d(t,{f:function(){return s},o:function(){return c}});var n=i(57437),a=i(2265);let o=(0,a.createContext)(),r=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},l=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function s(e){let{children:t}=e,{data:i,status:s}=function(){let[e,t]=(0,a.useState)(null),[i,n]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let e=async()=>{try{n("loading");let e=await fetch("/api/auth/session");if(e.ok){let i=await e.json();t(i),n(i?"authenticated":"unauthenticated")}else t(null),n("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),n("unauthenticated")}};e();let i=setInterval(e,3e5);return()=>clearInterval(i)},[]),{data:e,status:i}}(),[c,d]=(0,a.useState)(null),[u,g]=(0,a.useState)([]),[h,f]=(0,a.useState)(!1),[v,m]=(0,a.useState)(null),[x,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{p(!0)},[]),(0,a.useEffect)(()=>{if(x&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=r();if(e){let t=u.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),l(null))}}},[x,u,c]),(0,a.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==i?void 0:null===(e=i.user)||void 0===e?void 0:e.email)||"no session","[".concat(s,"]")),i&&"authenticated"===s?j():"unauthenticated"===s&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),g([]),d(null),l(null))},[i,s]);let j=async()=>{try{f(!0),m(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];g(t);let i=null,n=r();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",n),n&&((i=t.find(e=>e.id===n))?console.log("\uD83C\uDFAF Found matching organization for restoration:",i.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),l(null))),!i&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let n=await e.json();if(n.hasDefault){let e=t.find(e=>e.id===n.defaultOrganization.id);e&&(i=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(i)console.log("✅ Selected organization:",i.name),d(i),l(i.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),l(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),m("Failed to fetch organizations"),g([])}catch(e){console.error("Error fetching organizations:",e),m(e.message),g([])}finally{f(!1)}};return(0,n.jsx)(o.Provider,{value:{selectedOrganization:c,organizations:u,loading:h,error:v,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),l((null==e?void 0:e.id)||null)},refreshOrganizations:j,session:i,sessionStatus:s},children:t})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},41563:function(e,t,i){"use strict";i.d(t,{Z:function(){return v}});var n=i(2265),a=i(61994),o=i(7609),r=i(1589),l=i(42318),s=i(88654),c=i(15245),d=i(11475);function u(e){return(0,d.ZP)("MuiCard",e)}(0,c.Z)("MuiCard",["root"]);var g=i(57437);let h=e=>{let{classes:t}=e;return(0,o.Z)({root:["root"]},u,t)},f=(0,r.ZP)(s.Z,{name:"MuiCard",slot:"Root"})({overflow:"hidden"});var v=n.forwardRef(function(e,t){let i=(0,l.i)({props:e,name:"MuiCard"}),{className:n,raised:o=!1,...r}=i,s={...i,raised:o},c=h(s);return(0,g.jsx)(f,{className:(0,a.Z)(c.root,n),elevation:o?8:void 0,ref:t,ownerState:s,...r})})},61002:function(e,t,i){"use strict";i.d(t,{Z:function(){return f}});var n=i(2265),a=i(61994),o=i(7609),r=i(1589),l=i(42318),s=i(15245),c=i(11475);function d(e){return(0,c.ZP)("MuiCardContent",e)}(0,s.Z)("MuiCardContent",["root"]);var u=i(57437);let g=e=>{let{classes:t}=e;return(0,o.Z)({root:["root"]},d,t)},h=(0,r.ZP)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}});var f=n.forwardRef(function(e,t){let i=(0,l.i)({props:e,name:"MuiCardContent"}),{className:n,component:o="div",...r}=i,s={...i,component:o},c=g(s);return(0,u.jsx)(h,{as:o,className:(0,a.Z)(c.root,n),ownerState:s,ref:t,...r})})}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,8129,7286,9458,2971,7466,1744],function(){return e(e.s=78813)}),_N_E=e.O()}]);