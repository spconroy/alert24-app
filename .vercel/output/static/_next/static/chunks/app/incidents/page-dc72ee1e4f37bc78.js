(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{18178:function(e,t,n){Promise.resolve().then(n.bind(n,40780))},40780:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var i=n(57437),r=n(2265),a=n(38543),o=n(90658),s=n(18150),l=n(36261),c=n(77639),d=n(41563),u=n(61002),h=n(19352),g=n(22347),f=n(9391),x=n(73088),v=n(95280),Z=n(31835),j=n(33101),m=n(8319),p=n(82995),z=n(68045),b=n(66838),y=n(16116),w=n(46382),D=n(16875),S=n(50793),C=n(43209),k=n(27648),I=n(89470),E=n(3484),M=n(86873),O=n(99636),F=(0,n(64059).Z)((0,i.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),_=n(85744),A=n(44812);function R(){let[e,t]=(0,r.useState)([]),[n,R]=(0,r.useState)([]),[W,V]=(0,r.useState)(!0),[H,N]=(0,r.useState)(null),[P,T]=(0,r.useState)({organization_id:"",status:"",severity:"",assigned_to:"",search:""}),[L,B]=(0,r.useState)({total:0,limit:25,offset:0,hasMore:!1}),{session:U}=(0,A.o)();(0,r.useEffect)(()=>{U&&(G(),q())},[U,P,L.offset]);let q=async()=>{try{let e=await fetch("/api/organizations");if(e.ok){let t=await e.json();R(t.organizations||[])}}catch(e){console.error("Error fetching organizations:",e)}},G=async()=>{try{V(!0),N(null);let e=new URLSearchParams;Object.entries(P).forEach(t=>{let[n,i]=t;i&&"search"!==n&&e.append(n,i)}),e.append("limit",L.limit.toString()),e.append("offset",L.offset.toString());let n=await fetch("/api/incidents?".concat(e.toString()));if(!n.ok)throw Error("Failed to fetch incidents");let i=await n.json();t(i.incidents||[]),B(e=>{var t,n;return{...e,total:(null===(t=i.pagination)||void 0===t?void 0:t.total)||0,hasMore:(null===(n=i.pagination)||void 0===n?void 0:n.hasMore)||!1}})}catch(e){console.error("Error fetching incidents:",e),N(e.message)}finally{V(!1)}},J=(e,t)=>{T(n=>({...n,[e]:t})),B(e=>({...e,offset:0}))},K=e=>{switch(e){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}},Q=e=>{switch(e){case"open":return"error";case"investigating":return"warning";case"monitoring":return"info";case"resolved":return"success";default:return"default"}};return(0,i.jsx)(_.Z,{children:(0,i.jsxs)(a.Z,{sx:{p:3},children:[(0,i.jsxs)(a.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(o.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"Incidents"}),(0,i.jsx)(o.Z,{variant:"body1",color:"text.secondary",children:"Manage and track all incidents across your organizations"})]}),(0,i.jsxs)(a.Z,{display:"flex",gap:2,children:[(0,i.jsx)(s.Z,{title:"Refresh",children:(0,i.jsx)(l.Z,{onClick:G,color:"primary",children:(0,i.jsx)(O.Z,{})})}),(0,i.jsx)(c.Z,{component:k.default,href:"/incidents/new",variant:"contained",startIcon:(0,i.jsx)(I.Z,{}),color:"error",children:"Create Incident"})]})]}),(0,i.jsx)(d.Z,{sx:{mb:3},children:(0,i.jsxs)(u.Z,{children:[(0,i.jsxs)(a.Z,{display:"flex",alignItems:"center",gap:2,mb:2,children:[(0,i.jsx)(F,{color:"action"}),(0,i.jsx)(o.Z,{variant:"h6",children:"Filters"}),(0,i.jsx)(c.Z,{variant:"text",size:"small",onClick:()=>{T({organization_id:"",status:"",severity:"",assigned_to:"",search:""}),B(e=>({...e,offset:0}))},children:"Clear All"})]}),(0,i.jsxs)(h.Z,{container:!0,spacing:2,children:[(0,i.jsx)(h.Z,{item:!0,xs:12,md:3,children:(0,i.jsxs)(g.Z,{fullWidth:!0,size:"small",children:[(0,i.jsx)(f.Z,{children:"Organization"}),(0,i.jsxs)(x.Z,{value:P.organization_id,label:"Organization",onChange:e=>J("organization_id",e.target.value),children:[(0,i.jsx)(v.Z,{value:"",children:"All Organizations"}),n.map(e=>(0,i.jsx)(v.Z,{value:e.id,children:e.name},e.id))]})]})}),(0,i.jsx)(h.Z,{item:!0,xs:12,md:2,children:(0,i.jsxs)(g.Z,{fullWidth:!0,size:"small",children:[(0,i.jsx)(f.Z,{children:"Status"}),(0,i.jsxs)(x.Z,{value:P.status,label:"Status",onChange:e=>J("status",e.target.value),children:[(0,i.jsx)(v.Z,{value:"",children:"All Status"}),(0,i.jsx)(v.Z,{value:"open",children:"Open"}),(0,i.jsx)(v.Z,{value:"investigating",children:"Investigating"}),(0,i.jsx)(v.Z,{value:"monitoring",children:"Monitoring"}),(0,i.jsx)(v.Z,{value:"resolved",children:"Resolved"})]})]})}),(0,i.jsx)(h.Z,{item:!0,xs:12,md:2,children:(0,i.jsxs)(g.Z,{fullWidth:!0,size:"small",children:[(0,i.jsx)(f.Z,{children:"Severity"}),(0,i.jsxs)(x.Z,{value:P.severity,label:"Severity",onChange:e=>J("severity",e.target.value),children:[(0,i.jsx)(v.Z,{value:"",children:"All Severities"}),(0,i.jsx)(v.Z,{value:"critical",children:"Critical"}),(0,i.jsx)(v.Z,{value:"high",children:"High"}),(0,i.jsx)(v.Z,{value:"medium",children:"Medium"}),(0,i.jsx)(v.Z,{value:"low",children:"Low"})]})]})}),(0,i.jsx)(h.Z,{item:!0,xs:12,md:5,children:(0,i.jsx)(Z.Z,{fullWidth:!0,size:"small",label:"Search incidents...",value:P.search,onChange:e=>J("search",e.target.value),placeholder:"Search by title, description, or ID"})})]})]})}),H&&(0,i.jsx)(j.Z,{severity:"error",sx:{mb:2},children:H}),(0,i.jsx)(d.Z,{children:(0,i.jsxs)(u.Z,{sx:{p:0},children:[W&&0===e.length?(0,i.jsx)(a.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,i.jsx)(m.Z,{})}):0===e.length?(0,i.jsxs)(a.Z,{textAlign:"center",py:6,children:[(0,i.jsx)(o.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No incidents found"}),(0,i.jsx)(o.Z,{variant:"body2",color:"text.secondary",mb:3,children:Object.values(P).some(e=>e)?"Try adjusting your filters or create a new incident.":"Create your first incident to get started."}),(0,i.jsx)(c.Z,{component:k.default,href:"/incidents/new",variant:"contained",startIcon:(0,i.jsx)(I.Z,{}),color:"error",children:"Create Incident"})]}):(0,i.jsx)(p.Z,{children:(0,i.jsxs)(z.Z,{children:[(0,i.jsx)(b.Z,{children:(0,i.jsxs)(y.Z,{children:[(0,i.jsx)(w.Z,{children:"Title"}),(0,i.jsx)(w.Z,{children:"Organization"}),(0,i.jsx)(w.Z,{children:"Status"}),(0,i.jsx)(w.Z,{children:"Severity"}),(0,i.jsx)(w.Z,{children:"Assigned To"}),(0,i.jsx)(w.Z,{children:"Created"}),(0,i.jsx)(w.Z,{align:"right",children:"Actions"})]})}),(0,i.jsx)(D.Z,{children:e.map(e=>(0,i.jsxs)(y.Z,{hover:!0,children:[(0,i.jsx)(w.Z,{children:(0,i.jsxs)(a.Z,{children:[(0,i.jsx)(o.Z,{variant:"subtitle2",fontWeight:"medium",children:e.title}),e.description&&(0,i.jsx)(o.Z,{variant:"body2",color:"text.secondary",noWrap:!0,children:e.description.length>50?"".concat(e.description.substring(0,50),"..."):e.description})]})}),(0,i.jsx)(w.Z,{children:(0,i.jsx)(o.Z,{variant:"body2",children:e.organization_name})}),(0,i.jsx)(w.Z,{children:(0,i.jsx)(S.Z,{label:e.status,color:Q(e.status),size:"small"})}),(0,i.jsx)(w.Z,{children:(0,i.jsx)(S.Z,{label:e.severity,color:K(e.severity),size:"small",variant:"outlined"})}),(0,i.jsx)(w.Z,{children:(0,i.jsx)(o.Z,{variant:"body2",children:e.assigned_to_name||"Unassigned"})}),(0,i.jsx)(w.Z,{children:(0,i.jsx)(o.Z,{variant:"body2",children:new Date(e.created_at).toLocaleDateString()})}),(0,i.jsxs)(w.Z,{align:"right",children:[(0,i.jsx)(s.Z,{title:"View Details",children:(0,i.jsx)(l.Z,{component:k.default,href:"/incidents/".concat(e.id),size:"small",children:(0,i.jsx)(M.Z,{fontSize:"small"})})}),(0,i.jsx)(s.Z,{title:"Edit",children:(0,i.jsx)(l.Z,{component:k.default,href:"/incidents/".concat(e.id,"/edit"),size:"small",children:(0,i.jsx)(E.Z,{fontSize:"small"})})})]})]},e.id))})]})}),L.hasMore&&(0,i.jsx)(a.Z,{textAlign:"center",p:2,children:(0,i.jsx)(c.Z,{variant:"outlined",onClick:()=>{B(e=>({...e,offset:e.offset+e.limit}))},disabled:W,children:W?(0,i.jsx)(m.Z,{size:20}):"Load More"})})]})}),(0,i.jsx)(C.Z,{color:"error","aria-label":"add",component:k.default,href:"/incidents/new",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},children:(0,i.jsx)(I.Z,{})})]})})}},85744:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var i=n(57437),r=n(2265),a=n(8319),o=n(38543),s=n(44812);function l(e){let{children:t}=e,{session:n,sessionStatus:l}=(0,s.o)();return((0,r.useEffect)(()=>{"unauthenticated"===l&&(window.location.href="/api/auth/signin")},[l]),"loading"===l)?(0,i.jsx)(o.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,i.jsx)(a.Z,{})}):n?t:null}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return l},o:function(){return c}});var i=n(57437),r=n(2265);let a=(0,r.createContext)(),o=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},s=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function l(e){let{children:t}=e,{data:n,status:l}=function(){let[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)("loading");return(0,r.useEffect)(()=>{let e=async()=>{try{i("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),i(n?"authenticated":"unauthenticated")}else t(null),i("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),i("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[c,d]=(0,r.useState)(null),[u,h]=(0,r.useState)([]),[g,f]=(0,r.useState)(!1),[x,v]=(0,r.useState)(null),[Z,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{j(!0)},[]),(0,r.useEffect)(()=>{if(Z&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=o();if(e){let t=u.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),s(null))}}},[Z,u,c]),(0,r.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(l,"]")),n&&"authenticated"===l?m():"unauthenticated"===l&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),s(null))},[n,l]);let m=async()=>{try{f(!0),v(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];h(t);let n=null,i=o();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",i),i&&((n=t.find(e=>e.id===i))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),s(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let i=await e.json();if(i.hasDefault){let e=t.find(e=>e.id===i.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),d(n),s(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),s(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),v("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),v(e.message),h([])}finally{f(!1)}};return(0,i.jsx)(a.Provider,{value:{selectedOrganization:c,organizations:u,loading:g,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),s((null==e?void 0:e.id)||null)},refreshOrganizations:m,session:n,sessionStatus:l},children:t})}function c(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},89470:function(e,t,n){"use strict";var i=n(64059),r=n(57437);t.Z=(0,i.Z)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},86873:function(e,t,n){"use strict";var i=n(64059),r=n(57437);t.Z=(0,i.Z)((0,r.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},43209:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var i=n(2265),r=n(61994),a=n(7609),o=n(52076),s=n(51661),l=n(15245),c=n(11475);function d(e){return(0,c.ZP)("MuiFab",e)}let u=(0,l.Z)("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]);var h=n(45194),g=n(1589),f=n(1190),x=n(75913),v=n(42318),Z=n(57437);let j=e=>{let{color:t,variant:n,classes:i,size:r}=e,o={root:["root",n,"size".concat((0,s.Z)(r)),"inherit"===t?"colorInherit":t]},l=(0,a.Z)(o,d,i);return{...i,...l}},m=(0,g.ZP)(o.Z,{name:"MuiFab",slot:"Root",shouldForwardProp:e=>(0,h.Z)(e)||"classes"===e,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[n.variant],t["size".concat((0,s.Z)(n.size))],"inherit"===n.color&&t.colorInherit,t[(0,s.Z)(n.size)],t[n.color]]}})((0,f.Z)(e=>{var t,n;let{theme:i}=e;return{...i.typography.button,minHeight:36,transition:i.transitions.create(["background-color","box-shadow","border-color"],{duration:i.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(i.vars||i).zIndex.fab,boxShadow:(i.vars||i).shadows[6],"&:active":{boxShadow:(i.vars||i).shadows[12]},color:i.vars?i.vars.palette.grey[900]:null===(t=(n=i.palette).getContrastText)||void 0===t?void 0:t.call(n,i.palette.grey[300]),backgroundColor:(i.vars||i).palette.grey[300],"&:hover":{backgroundColor:(i.vars||i).palette.grey.A100,"@media (hover: none)":{backgroundColor:(i.vars||i).palette.grey[300]},textDecoration:"none"},["&.".concat(u.focusVisible)]:{boxShadow:(i.vars||i).shadows[6]},variants:[{props:{size:"small"},style:{width:40,height:40}},{props:{size:"medium"},style:{width:48,height:48}},{props:{variant:"extended"},style:{borderRadius:24,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48}},{props:{variant:"extended",size:"small"},style:{width:"auto",padding:"0 8px",borderRadius:17,minWidth:34,height:34}},{props:{variant:"extended",size:"medium"},style:{width:"auto",padding:"0 16px",borderRadius:20,minWidth:40,height:40}},{props:{color:"inherit"},style:{color:"inherit"}}]}}),(0,f.Z)(e=>{let{theme:t}=e;return{variants:[...Object.entries(t.palette).filter((0,x.Z)(["dark","contrastText"])).map(e=>{let[n]=e;return{props:{color:n},style:{color:(t.vars||t).palette[n].contrastText,backgroundColor:(t.vars||t).palette[n].main,"&:hover":{backgroundColor:(t.vars||t).palette[n].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n].main}}}}})]}}),(0,f.Z)(e=>{let{theme:t}=e;return{["&.".concat(u.disabled)]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}}));var p=i.forwardRef(function(e,t){let n=(0,v.i)({props:e,name:"MuiFab"}),{children:i,className:a,color:o="default",component:s="button",disabled:l=!1,disableFocusRipple:c=!1,focusVisibleClassName:d,size:u="large",variant:h="circular",...g}=n,f={...n,color:o,component:s,disabled:l,disableFocusRipple:c,size:u,variant:h},x=j(f);return(0,Z.jsx)(m,{className:(0,r.Z)(x.root,a),component:s,disabled:l,focusRipple:!c,focusVisibleClassName:(0,r.Z)(x.focusVisible,d),ownerState:f,ref:t,...g,classes:x,children:i})})}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,8129,7286,8150,6043,2971,7466,1744],function(){return e(e.s=18178)}),_N_E=e.O()}]);