(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8473],{35174:function(e,t,i){Promise.resolve().then(i.bind(i,53318))},53318:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return E},runtime:function(){return z}});var n=i(57437),a=i(2265),o=i(38543),s=i(8319),l=i(33101),r=i(77639),c=i(90658),d=i(41563),u=i(61002),h=i(19352),g=i(31835),f=i(22347),m=i(9391),x=i(73088),p=i(95280),v=i(25761),j=i(27554),Z=i(87410),y=i(50793),D=i(99376),S=i(27648),w=i(51442),_=i(11617),b=i(85744),C=i(44812);let z="edge";function E(){let e=(0,D.useParams)(),t=(0,D.useRouter)(),{session:i}=(0,C.o)(),z=e.id,[E,I]=(0,a.useState)({title:"",description:"",severity:"medium",status:"open",affected_services:[],impact_description:"",assigned_to:"",escalation_policy_id:"",tags:[],resolution_notes:""}),[k,P]=(0,a.useState)(null),[T,O]=(0,a.useState)([]),[A,M]=(0,a.useState)([]),[F,W]=(0,a.useState)([]),[N,R]=(0,a.useState)(!0),[B,U]=(0,a.useState)(!1),[H,q]=(0,a.useState)(null),[L,J]=(0,a.useState)(!1),[K,G]=(0,a.useState)({}),[Q,V]=(0,a.useState)("");(0,a.useEffect)(()=>{z&&i&&X()},[z,i]);let X=async()=>{try{let e=await fetch("/api/incidents/".concat(z));if(e.ok){let t=(await e.json()).incident;P(t),I({title:t.title||"",description:t.description||"",severity:t.severity||"medium",status:t.status||"open",affected_services:t.affected_services||[],impact_description:t.impact_description||"",assigned_to:t.assigned_to||"",escalation_policy_id:t.escalation_policy_id||"",tags:t.tags||[],resolution_notes:t.resolution_notes||""}),await Y(t.organization_id)}else 404===e.status?q("Incident not found"):q("Failed to load incident")}catch(e){console.error("Error fetching incident:",e),q("Failed to load incident")}finally{R(!1)}},Y=async e=>{try{let t=await fetch("/api/escalation-policies?organization_id=".concat(e,"&active_only=true"));if(t.ok){let e=await t.json();O(e.escalation_policies||[])}let i=await fetch("/api/organizations/".concat(e));if(i.ok){let e=await i.json();M(e.members||[])}let n=await fetch("/api/services?organization_id=".concat(e));if(n.ok){let e=await n.json();W(e.services||[])}}catch(e){console.error("Error fetching organization data:",e)}},$=()=>{let e={};return E.title.trim()||(e.title="Title is required"),E.description.trim()||(e.description="Description is required"),G(e),0===Object.keys(e).length},ee=async e=>{if(e.preventDefault(),!$()){q("Please fix the form errors before submitting");return}U(!0),q(null);try{let e={...E,affected_services:E.affected_services.map(e=>"string"==typeof e?e:e.id||e.name)},i=await fetch("/api/incidents/".concat(z),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to update incident")}J(!0),setTimeout(()=>{t.push("/incidents/".concat(z))},2e3)}catch(e){console.error("Error updating incident:",e),q(e.message)}finally{U(!1)}},et=(e,t)=>{I(i=>({...i,[e]:t})),K[e]&&G(t=>({...t,[e]:""}))},ei=()=>{Q.trim()&&!E.tags.includes(Q.trim())&&(I(e=>({...e,tags:[...e.tags,Q.trim()]})),V(""))},en=e=>{I(t=>({...t,tags:t.tags.filter(t=>t!==e)}))};return(0,n.jsx)(b.Z,{children:N?(0,n.jsx)(o.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,n.jsx)(s.Z,{})}):H&&!k?(0,n.jsxs)(o.Z,{sx:{p:3},children:[(0,n.jsx)(l.Z,{severity:"error",sx:{mb:2},children:H}),(0,n.jsx)(r.Z,{component:S.default,href:"/incidents",startIcon:(0,n.jsx)(w.Z,{}),variant:"outlined",children:"Back to Incidents"})]}):L?(0,n.jsx)(o.Z,{sx:{p:3},children:(0,n.jsx)(l.Z,{severity:"success",sx:{mb:2},children:"Incident updated successfully! Redirecting to incident details..."})}):(0,n.jsxs)(o.Z,{sx:{p:3},children:[(0,n.jsxs)(o.Z,{display:"flex",alignItems:"center",gap:2,mb:4,children:[(0,n.jsx)(r.Z,{component:S.default,href:"/incidents/".concat(z),startIcon:(0,n.jsx)(w.Z,{}),variant:"outlined",children:"Back to Incident"}),(0,n.jsxs)(c.Z,{variant:"h4",component:"h1",children:["Edit Incident #",null==k?void 0:k.incident_number]})]}),H&&(0,n.jsx)(l.Z,{severity:"error",sx:{mb:2},children:H}),(0,n.jsx)(d.Z,{children:(0,n.jsx)(u.Z,{children:(0,n.jsx)("form",{onSubmit:ee,children:(0,n.jsxs)(h.Z,{container:!0,spacing:3,children:[(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{fullWidth:!0,label:"Incident Title *",value:E.title,onChange:e=>et("title",e.target.value),error:!!K.title,helperText:K.title||"A clear, concise description of the incident",placeholder:"e.g., API service experiencing high latency"})}),(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{fullWidth:!0,multiline:!0,rows:4,label:"Description *",value:E.description,onChange:e=>et("description",e.target.value),error:!!K.description,helperText:K.description||"Detailed description of the incident and its impact",placeholder:"Describe the incident, when it started, symptoms, and any initial investigation findings..."})}),(0,n.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(f.Z,{fullWidth:!0,children:[(0,n.jsx)(m.Z,{children:"Severity"}),(0,n.jsxs)(x.Z,{value:E.severity,label:"Severity",onChange:e=>et("severity",e.target.value),children:[(0,n.jsx)(p.Z,{value:"low",children:"Low"}),(0,n.jsx)(p.Z,{value:"medium",children:"Medium"}),(0,n.jsx)(p.Z,{value:"high",children:"High"}),(0,n.jsx)(p.Z,{value:"critical",children:"Critical"})]}),(0,n.jsxs)(v.Z,{children:["critical"===E.severity&&"Service completely unavailable","high"===E.severity&&"Major functionality impacted","medium"===E.severity&&"Some functionality impacted","low"===E.severity&&"Minor impact or cosmetic issue"]})]})}),(0,n.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(f.Z,{fullWidth:!0,children:[(0,n.jsx)(m.Z,{children:"Status"}),(0,n.jsxs)(x.Z,{value:E.status,label:"Status",onChange:e=>et("status",e.target.value),children:[(0,n.jsx)(p.Z,{value:"open",children:"Open"}),(0,n.jsx)(p.Z,{value:"investigating",children:"Investigating"}),(0,n.jsx)(p.Z,{value:"monitoring",children:"Monitoring"}),(0,n.jsx)(p.Z,{value:"resolved",children:"Resolved"})]})]})}),(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{fullWidth:!0,multiline:!0,rows:2,label:"Impact Description",value:E.impact_description,onChange:e=>et("impact_description",e.target.value),helperText:"Describe the customer or business impact",placeholder:"e.g., Users unable to login, checkout process failing for 25% of customers"})}),"resolved"===E.status&&(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsx)(g.Z,{fullWidth:!0,multiline:!0,rows:3,label:"Resolution Notes",value:E.resolution_notes,onChange:e=>et("resolution_notes",e.target.value),helperText:"Describe how the incident was resolved",placeholder:"Explain the root cause and steps taken to resolve the incident..."})}),(0,n.jsxs)(h.Z,{item:!0,xs:12,children:[(0,n.jsx)(j.Z,{sx:{my:2}}),(0,n.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"Assignment & Escalation"})]}),(0,n.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(f.Z,{fullWidth:!0,children:[(0,n.jsx)(m.Z,{children:"Assign To"}),(0,n.jsxs)(x.Z,{value:E.assigned_to,label:"Assign To",onChange:e=>et("assigned_to",e.target.value),children:[(0,n.jsx)(p.Z,{value:"",children:"Unassigned"}),A.map(e=>(0,n.jsx)(p.Z,{value:e.id,children:e.name||e.email},e.id))]})]})}),(0,n.jsx)(h.Z,{item:!0,xs:12,md:6,children:(0,n.jsxs)(f.Z,{fullWidth:!0,children:[(0,n.jsx)(m.Z,{children:"Escalation Policy"}),(0,n.jsxs)(x.Z,{value:E.escalation_policy_id,label:"Escalation Policy",onChange:e=>et("escalation_policy_id",e.target.value),children:[(0,n.jsx)(p.Z,{value:"",children:"No escalation policy"}),T.map(e=>(0,n.jsx)(p.Z,{value:e.id,children:e.name},e.id))]})]})}),(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsx)(Z.Z,{multiple:!0,options:F,getOptionLabel:e=>e.name||e,value:E.affected_services,onChange:(e,t)=>et("affected_services",t),renderInput:e=>(0,n.jsx)(g.Z,{...e,label:"Affected Services",helperText:"Select services affected by this incident"}),renderTags:(e,t)=>e.map((e,i)=>(0,a.createElement)(y.Z,{variant:"outlined",label:e.name||e,...t({index:i}),key:i}))})}),(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(g.Z,{fullWidth:!0,label:"Add Tags",value:Q,onChange:e=>V(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),ei())},helperText:"Press Enter to add tags for categorization",InputProps:{endAdornment:(0,n.jsx)(r.Z,{onClick:ei,disabled:!Q.trim(),children:"Add"})}}),E.tags.length>0&&(0,n.jsx)(o.Z,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:E.tags.map(e=>(0,n.jsx)(y.Z,{label:e,onDelete:()=>en(e),color:"primary",variant:"outlined"},e))})]})}),(0,n.jsx)(h.Z,{item:!0,xs:12,children:(0,n.jsxs)(o.Z,{display:"flex",gap:2,justifyContent:"flex-end",sx:{mt:2},children:[(0,n.jsx)(r.Z,{component:S.default,href:"/incidents/".concat(z),variant:"outlined",disabled:B,children:"Cancel"}),(0,n.jsx)(r.Z,{type:"submit",variant:"contained",startIcon:B?(0,n.jsx)(s.Z,{size:20}):(0,n.jsx)(_.Z,{}),disabled:B,color:"primary",children:B?"Saving...":"Save Changes"})]})})]})})})})]})})}},85744:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});var n=i(57437),a=i(2265),o=i(8319),s=i(38543),l=i(44812);function r(e){let{children:t}=e,{session:i,sessionStatus:r}=(0,l.o)();return((0,a.useEffect)(()=>{"unauthenticated"===r&&(window.location.href="/api/auth/signin")},[r]),"loading"===r)?(0,n.jsx)(s.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,n.jsx)(o.Z,{})}):i?t:null}},44812:function(e,t,i){"use strict";i.d(t,{f:function(){return r},o:function(){return c}});var n=i(57437),a=i(2265);let o=(0,a.createContext)(),s=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},l=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function r(e){let{children:t}=e,{data:i,status:r}=function(){let[e,t]=(0,a.useState)(null),[i,n]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let e=async()=>{try{n("loading");let e=await fetch("/api/auth/session");if(e.ok){let i=await e.json();t(i),n(i?"authenticated":"unauthenticated")}else t(null),n("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),n("unauthenticated")}};e();let i=setInterval(e,3e5);return()=>clearInterval(i)},[]),{data:e,status:i}}(),[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[p,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v(!0)},[]),(0,a.useEffect)(()=>{if(p&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=s();if(e){let t=u.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),l(null))}}},[p,u,c]),(0,a.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==i?void 0:null===(e=i.user)||void 0===e?void 0:e.email)||"no session","[".concat(r,"]")),i&&"authenticated"===r?j():"unauthenticated"===r&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),l(null))},[i,r]);let j=async()=>{try{f(!0),x(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];h(t);let i=null,n=s();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",n),n&&((i=t.find(e=>e.id===n))?console.log("\uD83C\uDFAF Found matching organization for restoration:",i.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),l(null))),!i&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let n=await e.json();if(n.hasDefault){let e=t.find(e=>e.id===n.defaultOrganization.id);e&&(i=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(i)console.log("✅ Selected organization:",i.name),d(i),l(i.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),l(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),x("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),x(e.message),h([])}finally{f(!1)}};return(0,n.jsx)(o.Provider,{value:{selectedOrganization:c,organizations:u,loading:g,error:m,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),l((null==e?void 0:e.id)||null)},refreshOrganizations:j,session:i,sessionStatus:r},children:t})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},41563:function(e,t,i){"use strict";i.d(t,{Z:function(){return m}});var n=i(2265),a=i(61994),o=i(7609),s=i(1589),l=i(42318),r=i(88654),c=i(15245),d=i(11475);function u(e){return(0,d.ZP)("MuiCard",e)}(0,c.Z)("MuiCard",["root"]);var h=i(57437);let g=e=>{let{classes:t}=e;return(0,o.Z)({root:["root"]},u,t)},f=(0,s.ZP)(r.Z,{name:"MuiCard",slot:"Root"})({overflow:"hidden"});var m=n.forwardRef(function(e,t){let i=(0,l.i)({props:e,name:"MuiCard"}),{className:n,raised:o=!1,...s}=i,r={...i,raised:o},c=g(r);return(0,h.jsx)(f,{className:(0,a.Z)(c.root,n),elevation:o?8:void 0,ref:t,ownerState:r,...s})})},61002:function(e,t,i){"use strict";i.d(t,{Z:function(){return f}});var n=i(2265),a=i(61994),o=i(7609),s=i(1589),l=i(42318),r=i(15245),c=i(11475);function d(e){return(0,c.ZP)("MuiCardContent",e)}(0,r.Z)("MuiCardContent",["root"]);var u=i(57437);let h=e=>{let{classes:t}=e;return(0,o.Z)({root:["root"]},d,t)},g=(0,s.ZP)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}});var f=n.forwardRef(function(e,t){let i=(0,l.i)({props:e,name:"MuiCardContent"}),{className:n,component:o="div",...s}=i,r={...i,component:o},c=h(r);return(0,u.jsx)(g,{as:o,className:(0,a.Z)(c.root,n),ownerState:r,ref:t,...s})})}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,8129,7286,9458,2971,7466,1744],function(){return e(e.s=35174)}),_N_E=e.O()}]);