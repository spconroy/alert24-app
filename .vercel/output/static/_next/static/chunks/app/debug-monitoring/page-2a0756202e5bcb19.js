(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9452],{47195:function(t,e,o){Promise.resolve().then(o.bind(o,49261))},49261:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return f}});var n=o(57437),a=o(2265),i=o(38543),r=o(90658),l=o(77639),s=o(8319),u=o(33101),c=o(41563),g=o(61002),d=o(44812);function f(){let[t,e]=(0,a.useState)({}),[o,f]=(0,a.useState)(!1),[h,D]=(0,a.useState)(null),{selectedOrganization:v,organizations:m,session:z}=(0,d.o)(),w=async()=>{f(!0),D(null);let t={};try{var o;t.session={exists:!!z,email:null==z?void 0:null===(o=z.user)||void 0===o?void 0:o.email,user:null==z?void 0:z.user},t.organizationContext={selectedOrganization:v,organizations:m||[],organizationCount:(null==m?void 0:m.length)||0};try{let e=await fetch("/api/monitoring");t.monitoringApiAll={status:e.status,ok:e.ok,data:e.ok?await e.json():await e.text()}}catch(e){t.monitoringApiAll={error:e.message}}if(null==v?void 0:v.id)try{let e=await fetch("/api/monitoring?organization_id=".concat(v.id));t.monitoringApiWithOrg={status:e.status,ok:e.ok,data:e.ok?await e.json():await e.text()}}catch(e){t.monitoringApiWithOrg={error:e.message}}try{let e=await fetch("/api/organizations");t.organizationsApi={status:e.status,ok:e.ok,data:e.ok?await e.json():await e.text()}}catch(e){t.organizationsApi={error:e.message}}e(t)}catch(t){D(t.message)}finally{f(!1)}};return(0,a.useEffect)(()=>{z&&w()},[z,v]),(0,n.jsxs)(i.Z,{sx:{p:3},children:[(0,n.jsx)(r.Z,{variant:"h4",gutterBottom:!0,children:"Monitoring Debug Page"}),(0,n.jsx)(l.Z,{variant:"contained",onClick:w,disabled:o,sx:{mb:3},children:o?(0,n.jsx)(s.Z,{size:20}):"Run Diagnostics"}),h&&(0,n.jsx)(u.Z,{severity:"error",sx:{mb:2},children:h}),Object.keys(t).length>0&&(0,n.jsx)(c.Z,{sx:{mb:2},children:(0,n.jsxs)(g.Z,{children:[(0,n.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Debug Results"}),(0,n.jsx)("pre",{style:{backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"4px",overflow:"auto",fontSize:"12px"},children:JSON.stringify(t,null,2)})]})})]})}},44812:function(t,e,o){"use strict";o.d(e,{f:function(){return s},o:function(){return u}});var n=o(57437),a=o(2265);let i=(0,a.createContext)(),r=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(t){console.warn("Failed to read from localStorage:",t)}return null},l=t=>{try{if(window.localStorage){if(t)return localStorage.setItem("selectedOrganizationId",t),console.log("✅ Saved to localStorage:",t),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(t){console.warn("Failed to write to localStorage:",t)}return!1};function s(t){let{children:e}=t,{data:o,status:s}=function(){let[t,e]=(0,a.useState)(null),[o,n]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let t=async()=>{try{n("loading");let t=await fetch("/api/auth/session");if(t.ok){let o=await t.json();e(o),n(o?"authenticated":"unauthenticated")}else e(null),n("unauthenticated")}catch(t){console.error("Error fetching session:",t),e(null),n("unauthenticated")}};t();let o=setInterval(t,3e5);return()=>clearInterval(o)},[]),{data:t,status:o}}(),[u,c]=(0,a.useState)(null),[g,d]=(0,a.useState)([]),[f,h]=(0,a.useState)(!1),[D,v]=(0,a.useState)(null),[m,z]=(0,a.useState)(!1);(0,a.useEffect)(()=>{z(!0)},[]),(0,a.useEffect)(()=>{if(m&&g.length>0&&!u){console.log("\uD83D\uDD0D Client-side restoration check...");let t=r();if(t){let e=g.find(e=>e.id===t);e?(console.log("\uD83D\uDD04 Client-side restoration successful:",e.name),c(e)):(console.log("⚠️ Saved organization no longer available, clearing storage"),l(null))}}},[m,g,u]),(0,a.useEffect)(()=>{var t;console.log("\uD83D\uDD04 OrganizationContext:",(null==o?void 0:null===(t=o.user)||void 0===t?void 0:t.email)||"no session","[".concat(s,"]")),o&&"authenticated"===s?w():"unauthenticated"===s&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),d([]),c(null),l(null))},[o,s]);let w=async()=>{try{h(!0),v(null);let t=await fetch("/api/organizations");if(t.ok){let e=(await t.json()).organizations||[];d(e);let o=null,n=r();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",n),n&&((o=e.find(t=>t.id===n))?console.log("\uD83C\uDFAF Found matching organization for restoration:",o.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),l(null))),!o&&e.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let t=await fetch("/api/user/default-organization");if(t.ok){let n=await t.json();if(n.hasDefault){let t=e.find(t=>t.id===n.defaultOrganization.id);t&&(o=t,console.log("⭐ Found default organization:",t.name))}}}catch(t){console.error("Error fetching default organization:",t)}}if(o)console.log("✅ Selected organization:",o.name),c(o),l(o.id);else if(1===e.length){let t=e[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",t.name),c(t),l(t.id)}else 0===e.length?(console.log("\uD83D\uDCED No organizations available"),c(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",t.status,t.statusText),v("Failed to fetch organizations"),d([])}catch(t){console.error("Error fetching organizations:",t),v(t.message),d([])}finally{h(!1)}};return(0,n.jsx)(i.Provider,{value:{selectedOrganization:u,organizations:g,loading:f,error:D,selectOrganization:t=>{console.log("\uD83D\uDCBE Selecting organization:",(null==t?void 0:t.name)||"none"),c(t),l((null==t?void 0:t.id)||null)},refreshOrganizations:w,session:o,sessionStatus:s},children:e})}function u(){let t=(0,a.useContext)(i);if(void 0===t)throw Error("useOrganization must be used within an OrganizationProvider");return t}},41563:function(t,e,o){"use strict";o.d(e,{Z:function(){return D}});var n=o(2265),a=o(61994),i=o(7609),r=o(1589),l=o(42318),s=o(88654),u=o(15245),c=o(11475);function g(t){return(0,c.ZP)("MuiCard",t)}(0,u.Z)("MuiCard",["root"]);var d=o(57437);let f=t=>{let{classes:e}=t;return(0,i.Z)({root:["root"]},g,e)},h=(0,r.ZP)(s.Z,{name:"MuiCard",slot:"Root"})({overflow:"hidden"});var D=n.forwardRef(function(t,e){let o=(0,l.i)({props:t,name:"MuiCard"}),{className:n,raised:i=!1,...r}=o,s={...o,raised:i},u=f(s);return(0,d.jsx)(h,{className:(0,a.Z)(u.root,n),elevation:i?8:void 0,ref:e,ownerState:s,...r})})},61002:function(t,e,o){"use strict";o.d(e,{Z:function(){return h}});var n=o(2265),a=o(61994),i=o(7609),r=o(1589),l=o(42318),s=o(15245),u=o(11475);function c(t){return(0,u.ZP)("MuiCardContent",t)}(0,s.Z)("MuiCardContent",["root"]);var g=o(57437);let d=t=>{let{classes:e}=t;return(0,i.Z)({root:["root"]},c,e)},f=(0,r.ZP)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}});var h=n.forwardRef(function(t,e){let o=(0,l.i)({props:t,name:"MuiCardContent"}),{className:n,component:i="div",...r}=o,s={...o,component:i},u=d(s);return(0,g.jsx)(f,{as:i,className:(0,a.Z)(u.root,n),ownerState:s,ref:e,...r})})}},function(t){t.O(0,[702,7639,2971,7466,1744],function(){return t(t.s=47195)}),_N_E=t.O()}]);