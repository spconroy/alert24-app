(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4995],{90927:function(e,t,n){Promise.resolve().then(n.bind(n,64377))},64377:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return em}});var a=n(57437),s=n(38543),r=n(90658),i=n(77639),l=n(2265),o=n(8319),c=n(33101),d=n(61888),u=n(67939),h=n(75263),x=n(29884),g=n(23229),m=n(36261),p=n(50793),j=n(74190),f=n(58841),Z=n(59804);let v=(0,l.forwardRef)(function(e,t){let{orgId:n,onSelectStatusPage:i}=e,[v,y]=(0,l.useState)([]),[b,S]=(0,l.useState)(!0),[w,C]=(0,l.useState)(null),[k,D]=(0,l.useState)(!1),_=async()=>{S(!0),C(null);try{let e=await fetch("/api/status-pages?org_id=".concat(n));if(console.log("Status pages API response:",e.status,e.statusText),!e.ok){let t=await e.json().catch(()=>({}));throw console.error("Status pages API error:",t),Error(t.error||"HTTP ".concat(e.status,": ").concat(e.statusText))}let t=await e.json();console.log("Status pages data:",t),y(t.statusPages||[])}catch(e){console.error("Fetch status pages error:",e),C(e.message)}finally{S(!1)}};(0,l.useImperativeHandle)(t,()=>({fetchStatusPages:_})),(0,l.useEffect)(()=>{n&&_()},[n]);let z=e=>{let t=window.location.origin;return"".concat(t,"/status/").concat(e.slug)},I=async(e,t)=>{t.stopPropagation();try{let t=z(e);await navigator.clipboard.writeText(t),D(!0)}catch(n){console.error("Failed to copy URL:",n);let t=document.createElement("textarea");t.value=z(e),document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),D(!0)}},P=(e,t)=>{t.stopPropagation();let n=z(e);window.open(n,"_blank")};return(0,a.jsxs)(s.Z,{children:[b&&(0,a.jsx)(o.Z,{}),w&&(0,a.jsx)(c.Z,{severity:"error",children:w}),!b&&!w&&0===v.length&&(0,a.jsx)(r.Z,{color:"text.secondary",children:'No status pages yet. Click the "Create Status Page" button above to get started.'}),!b&&!w&&v.length>0&&(0,a.jsx)(d.Z,{children:v.map(e=>(0,a.jsxs)(u.ZP,{divider:!0,disablePadding:!0,children:[(0,a.jsx)(x.Z,{onClick:()=>null==i?void 0:i(e),sx:{py:2,pr:12},children:(0,a.jsx)(h.Z,{primary:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,mb:.5,children:[(0,a.jsx)(r.Z,{variant:"body1",children:e.name}),(0,a.jsx)(p.Z,{label:e.is_public?"Public":"Private",size:"small",color:e.is_public?"success":"default"})]}),secondary:(0,a.jsxs)(s.Z,{children:[e.description&&(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.description}),(0,a.jsx)(r.Z,{variant:"caption",color:"primary",sx:{fontFamily:"monospace",backgroundColor:"rgba(25, 118, 210, 0.08)",padding:"2px 6px",borderRadius:1,display:"inline-block"},children:z(e)})]})})}),(0,a.jsx)(g.Z,{children:(0,a.jsxs)(s.Z,{display:"flex",gap:.5,children:[(0,a.jsx)(m.Z,{size:"small",onClick:t=>I(e,t),title:"Copy URL",color:"primary",children:(0,a.jsx)(f.Z,{fontSize:"small"})}),(0,a.jsx)(m.Z,{size:"small",onClick:t=>P(e,t),title:"Open in new tab",color:"primary",children:(0,a.jsx)(Z.Z,{fontSize:"small"})})]})})]},e.id))}),(0,a.jsx)(j.Z,{open:k,autoHideDuration:2e3,onClose:()=>D(!1),message:"URL copied to clipboard!",anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})});var y=n(49715),b=n(73985),S=n(66825),w=n(95386),C=n(31835),k=n(67615),D=n(793);let _=e=>e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");function z(e){let{orgId:t,onSuccess:n,onCancel:s}=e,[o,d]=(0,l.useState)(""),[u,h]=(0,l.useState)(""),[x,g]=(0,l.useState)(""),[m,p]=(0,l.useState)(!0),[j,f]=(0,l.useState)(!1),[Z,v]=(0,l.useState)(null),[z,I]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/organizations/".concat(t));if(e.ok){let t=await e.json();I(t.organization)}}catch(e){console.error("Failed to fetch org data:",e)}};t&&e()},[t]),(0,l.useEffect)(()=>{o&&h(_(o))},[o]);let P=async e=>{if(e.preventDefault(),v(null),!o||!u){v("Name and slug are required.");return}f(!0);try{let e=await fetch("/api/status-pages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({org_id:t,name:o,slug:u,description:x,is_public:m})}),a=await e.json();if(!e.ok)throw Error(a.error||"Failed to create status page");n&&n(a.statusPage)}catch(e){v(e.message)}finally{f(!1)}};return(0,a.jsxs)(y.Z,{open:!0,onClose:s,maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(b.Z,{children:"Create Status Page"}),(0,a.jsxs)("form",{onSubmit:P,children:[(0,a.jsxs)(S.Z,{children:[Z&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:2},children:Z}),(0,a.jsx)(C.Z,{label:"Status Page Name",value:o,onChange:e=>d(e.target.value),fullWidth:!0,required:!0,margin:"normal",autoFocus:!0,helperText:"A descriptive name for your status page"}),(0,a.jsx)(C.Z,{label:"URL Slug",value:u,onChange:e=>h(e.target.value.replace(/[^a-z0-9-]/gi,"").toLowerCase()),fullWidth:!0,required:!0,margin:"normal",helperText:"This will be part of your status page URL (auto-generated from name)"}),(0,a.jsxs)(r.Z,{variant:"body2",color:"text.secondary",sx:{mt:1,mb:2},children:["Your status page will be available at: ",(0,a.jsx)("strong",{children:z?z.domain?"".concat(z.domain,"/status/").concat(u||"your-slug"):z.subdomain?"".concat(z.subdomain,".yourdomain.com/status/").concat(u||"your-slug"):"".concat(z.slug,".yourdomain.com/status/").concat(u||"your-slug"):"your-domain.com/status/"+(u||"your-slug")})]}),(0,a.jsx)(C.Z,{label:"Description",value:x,onChange:e=>g(e.target.value),fullWidth:!0,margin:"normal",multiline:!0,minRows:2,helperText:"Optional description of what this status page covers"}),(0,a.jsx)(k.Z,{control:(0,a.jsx)(D.Z,{checked:m,onChange:e=>p(e.target.checked),color:"primary"}),label:"Publicly visible"})]}),(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(i.Z,{onClick:s,disabled:j,children:"Cancel"}),(0,a.jsx)(i.Z,{type:"submit",variant:"contained",color:"primary",disabled:j,children:j?"Creating...":"Create Status Page"})]})]})]})}var I=n(88654),P=n(27554),E=n(89470),T=n(3484),O=n(18150),W=n(19352),F=n(19702),A=n(22347),U=n(9391),R=n(73088),M=n(95280),L=n(12961),N=n(37306),B=n(67731),H=n(32737),q=n(74093),J=n(4568),V=n(20599),$=n(56549),G=n(94551),Q=n(663),Y=n(89010),K=n(44812);function X(e){let{open:t,onClose:n,service:x,onConfigUpdated:g}=e,[j,f]=(0,l.useState)([]),[Z,v]=(0,l.useState)([]),[k,_]=(0,l.useState)(!1),[z,I]=(0,l.useState)(!1),[P,E]=(0,l.useState)(null),{selectedOrganization:T}=(0,K.o)(),[O,F]=(0,l.useState)({});(0,l.useEffect)(()=>{t&&x&&T?(A(),U()):t||V()},[t,x,T]);let A=async()=>{_(!0),E(null);try{let e=await fetch("/api/monitoring?organization_id=".concat(T.id,"&limit=100"));if(!e.ok)throw Error("Failed to fetch monitoring checks");let t=await e.json();f(t.monitoring_checks||[])}catch(e){console.error("Error fetching monitoring checks:",e),E(e.message)}finally{_(!1)}},U=()=>{try{let e=x.monitoring_checks||[],t=e.map(e=>e.id);v(t);let n={};e.forEach(e=>{n[e.id]={failure_threshold_minutes:e.failure_threshold||5,failure_message:e.failure_message||""}}),F(n),console.log("Loaded existing associations:",{associatedIds:t,configs:n,existingChecks:e})}catch(e){console.error("Error loading current associations:",e)}},R=e=>{let t=new Set(Z);if(t.has(e)){t.delete(e);let n={...O};delete n[e],F(n)}else t.add(e),F(t=>({...t,[e]:{failure_threshold_minutes:5,failure_message:""}}));v(Array.from(t))},M=(e,t,n)=>{F(a=>({...a,[e]:{...a[e],[t]:n}}))},H=async()=>{I(!0),E(null);try{console.log("\uD83D\uDD04 Saving monitoring configuration..."),console.log("\uD83D\uDCCB Associated checks:",Z),console.log("⚙️ Check configs:",O);let e=Z.map(e=>{var t,n;return{monitoring_check_id:e,failure_threshold_minutes:(null===(t=O[e])||void 0===t?void 0:t.failure_threshold_minutes)||5,failure_message:(null===(n=O[e])||void 0===n?void 0:n.failure_message)||""}});console.log("\uD83D\uDCE4 Sending associations:",e);let t=await fetch("/api/services/".concat(x.id,"/monitoring"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({associations:e})});if(console.log("\uD83D\uDCE5 Response status:",t.status),!t.ok){let e=await t.json();throw console.error("❌ Error response:",e),Error(e.error||"Failed to save monitoring configuration")}let a=await t.json();console.log("✅ Save successful:",a),null==g||g(),n()}catch(e){console.error("Error saving monitoring configuration:",e),E(e.message)}finally{I(!1)}},J=e=>"up"===e.current_status?{icon:(0,a.jsx)(L.Z,{}),color:"success"}:"down"===e.current_status?{icon:(0,a.jsx)(B.Z,{}),color:"error"}:"warning"===e.current_status?{icon:(0,a.jsx)(N.Z,{}),color:"warning"}:"inactive"===e.current_status?{icon:(0,a.jsx)(Y.Z,{}),color:"default"}:{icon:(0,a.jsx)(q.Z,{}),color:"default"},V=()=>{v([]),F({}),E(null),f([])};return x?(0,a.jsxs)(y.Z,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"500px"}},children:[(0,a.jsx)(b.Z,{children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(r.Z,{variant:"h6",children:['Configure Monitoring for "',x.name,'"']}),(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:"Associate monitoring checks to automatically update service status"})]}),(0,a.jsx)(m.Z,{onClick:n,size:"small",children:(0,a.jsx)(Q.Z,{})})]})}),(0,a.jsxs)(S.Z,{children:[P&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:2},children:P}),k?(0,a.jsx)(s.Z,{display:"flex",justifyContent:"center",py:4,children:(0,a.jsx)(o.Z,{})}):(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(c.Z,{severity:"info",sx:{mb:3},children:(0,a.jsx)(r.Z,{variant:"body2",children:"Select monitoring checks to associate with this service. When a check fails for the specified duration, the service status will be updated automatically."})}),(0,a.jsxs)(r.Z,{variant:"h6",gutterBottom:!0,children:["Available Monitoring Checks (",j.length,")"]}),0===j.length?(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(c.Z,{severity:"info",sx:{mb:2},children:[(0,a.jsx)(r.Z,{variant:"body2",gutterBottom:!0,children:(0,a.jsx)("strong",{children:"No monitoring checks found for this organization."})}),(0,a.jsx)(r.Z,{variant:"body2",gutterBottom:!0,children:"To link monitoring checks to services, you need to create monitoring checks first."}),(0,a.jsx)(r.Z,{variant:"body2",children:"Monitoring checks automatically test your services and can update their status on your status pages when issues are detected."})]}),(0,a.jsxs)(s.Z,{sx:{mt:2,p:2,backgroundColor:"grey.50",borderRadius:1},children:[(0,a.jsx)(r.Z,{variant:"subtitle2",gutterBottom:!0,color:"primary",children:"Quick Start Guide:"}),(0,a.jsxs)(r.Z,{variant:"body2",component:"div",children:[(0,a.jsx)("strong",{children:"1."})," Create monitoring checks for your critical services",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"2."})," Return here to link those checks to status page services",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"3."})," When checks fail, service status updates automatically"]}),(0,a.jsxs)(s.Z,{sx:{mt:2},children:[(0,a.jsx)(i.Z,{variant:"contained",href:"/monitoring/new",target:"_blank",rel:"noopener noreferrer",sx:{mr:1},children:"Create First Monitoring Check"}),(0,a.jsx)(i.Z,{variant:"outlined",href:"/monitoring",target:"_blank",rel:"noopener noreferrer",children:"View All Monitoring"})]})]})]}):(0,a.jsx)(d.Z,{children:j.map(e=>{let t=Z.includes(e.id),n=J(e),i=O[e.id]||{};return(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(u.ZP,{dense:!0,sx:{border:"1px solid",borderColor:t?"primary.main":"divider",borderRadius:1,mb:1,backgroundColor:t?"primary.50":"transparent"},children:[(0,a.jsx)(D.Z,{checked:t,onChange:()=>R(e.id),color:"primary"}),(0,a.jsx)(h.Z,{primary:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(r.Z,{variant:"body2",fontWeight:"medium",children:e.name}),(0,a.jsx)(p.Z,{icon:n.icon,label:e.current_status||"unknown",size:"small",color:n.color,variant:"outlined"}),(0,a.jsx)(p.Z,{label:e.check_type,size:"small",variant:"outlined"})]}),secondary:(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(r.Z,{variant:"caption",display:"block",children:["Target: ",e.target_url]}),(0,a.jsxs)(r.Z,{variant:"caption",display:"block",color:"text.secondary",children:["Interval: ",e.check_interval||300,"s"]})]})})]}),t&&(0,a.jsxs)(s.Z,{sx:{ml:4,mb:2,p:2,backgroundColor:"grey.50",borderRadius:1},children:[(0,a.jsx)(r.Z,{variant:"subtitle2",gutterBottom:!0,children:"Failure Configuration"}),(0,a.jsxs)(W.Z,{container:!0,spacing:2,children:[(0,a.jsx)(W.Z,{item:!0,xs:12,sm:6,children:(0,a.jsx)(C.Z,{fullWidth:!0,label:"Failure Threshold (minutes)",type:"number",size:"small",value:i.failure_threshold_minutes||5,onChange:t=>M(e.id,"failure_threshold_minutes",parseInt(t.target.value)||5),helperText:"How long the check must be failing before updating service status",inputProps:{min:1,max:1440}})}),(0,a.jsx)(W.Z,{item:!0,xs:12,children:(0,a.jsx)(C.Z,{fullWidth:!0,label:"Custom Failure Message",size:"small",multiline:!0,rows:2,value:i.failure_message||"",onChange:t=>M(e.id,"failure_message",t.target.value),helperText:"Optional custom message to display when this check fails (leave empty for default)",placeholder:"".concat(x.name," is experiencing issues")})})]})]})]},e.id)})})]})]}),(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(i.Z,{onClick:n,disabled:z,children:"Cancel"}),(0,a.jsx)(i.Z,{onClick:H,variant:"contained",disabled:z||0===j.length,children:z?(0,a.jsx)(o.Z,{size:20}):"Save Configuration"})]})]}):null}function ee(e){let{open:t,onClose:n,service:d,onServiceUpdated:u}=e,[h,x]=(0,l.useState)({name:"",description:"",status:"operational",sort_order:0,auto_recovery:!0}),[g,p]=(0,l.useState)(!1),[j,f]=(0,l.useState)(null);(0,l.useEffect)(()=>{if(d){var e;x({name:d.name||"",description:d.description||"",status:d.status||"operational",sort_order:d.sort_order||0,auto_recovery:null===(e=d.auto_recovery)||void 0===e||e})}},[d]);let Z=e=>{let{name:t,value:n,type:a,checked:s}=e.target;x(e=>({...e,[t]:"checkbox"===a?s:n}))},v=async e=>{e.preventDefault(),p(!0),f(null);try{let e=await fetch("/api/services/".concat(d.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to update service")}let t=await e.json();console.log("Service updated successfully:",t),null==u||u(t.service),n()}catch(e){console.error("Error updating service:",e),f(e.message)}finally{p(!1)}},_=()=>{f(null),n()};return d?(0,a.jsxs)(y.Z,{open:t,onClose:_,maxWidth:"sm",fullWidth:!0,PaperProps:{component:"form",onSubmit:v},children:[(0,a.jsx)(b.Z,{children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsx)(r.Z,{variant:"h6",children:"Edit Service"}),(0,a.jsx)(m.Z,{onClick:_,size:"small",children:(0,a.jsx)(Q.Z,{})})]})}),(0,a.jsxs)(S.Z,{children:[j&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:2},children:j}),(0,a.jsxs)(s.Z,{sx:{pt:1},children:[(0,a.jsx)(C.Z,{fullWidth:!0,label:"Service Name",name:"name",value:h.name,onChange:Z,required:!0,margin:"normal",disabled:g,helperText:"The display name for this service"}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Description",name:"description",value:h.description,onChange:Z,multiline:!0,rows:3,margin:"normal",disabled:g,helperText:"Optional description of what this service provides"}),(0,a.jsxs)(A.Z,{fullWidth:!0,margin:"normal",disabled:g,children:[(0,a.jsx)(U.Z,{children:"Status"}),(0,a.jsxs)(R.Z,{name:"status",value:h.status,onChange:Z,label:"Status",children:[(0,a.jsx)(M.Z,{value:"operational",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(s.Z,{width:8,height:8,borderRadius:"50%",bgcolor:"success.main"}),"Operational"]})}),(0,a.jsx)(M.Z,{value:"degraded",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(s.Z,{width:8,height:8,borderRadius:"50%",bgcolor:"warning.main"}),"Degraded"]})}),(0,a.jsx)(M.Z,{value:"down",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(s.Z,{width:8,height:8,borderRadius:"50%",bgcolor:"error.main"}),"Down"]})}),(0,a.jsx)(M.Z,{value:"maintenance",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(s.Z,{width:8,height:8,borderRadius:"50%",bgcolor:"info.main"}),"Maintenance"]})})]})]}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Sort Order",name:"sort_order",type:"number",value:h.sort_order,onChange:Z,margin:"normal",disabled:g,helperText:"Lower numbers appear first in the list",inputProps:{min:0}}),(0,a.jsx)(k.Z,{control:(0,a.jsx)(D.Z,{name:"auto_recovery",checked:h.auto_recovery,onChange:Z,disabled:g}),label:"Auto-recovery",sx:{mt:2,display:"block"}}),(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",sx:{mt:1,mb:2},children:"Automatically set service status to operational when all monitoring checks recover"})]})]}),(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(i.Z,{onClick:_,disabled:g,children:"Cancel"}),(0,a.jsx)(i.Z,{type:"submit",variant:"contained",disabled:g||!h.name.trim(),children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{size:20,sx:{mr:1}}),"Updating..."]}):"Update Service"})]})]}):null}var et=n(87135),en=n(80570);let ea={operational:"success",degraded:"warning",down:"error",maintenance:"info"},es={operational:"Operational",degraded:"Degraded",down:"Down",maintenance:"Maintenance"},er=(0,l.forwardRef)(function(e,t){let{statusPageId:n}=e,[x,g]=(0,l.useState)([]),[j,f]=(0,l.useState)(!0),[Z,v]=(0,l.useState)(null),[k,D]=(0,l.useState)(new Set),[_,z]=(0,l.useState)(!1),[E,Y]=(0,l.useState)(!1),[K,er]=(0,l.useState)(null),[ei,el]=(0,l.useState)(!1),[eo,ec]=(0,l.useState)(null),[ed,eu]=(0,l.useState)(""),[eh,ex]=(0,l.useState)(""),[eg,em]=(0,l.useState)(!1),[ep,ej]=(0,l.useState)(!1),[ef,eZ]=(0,l.useState)(null),[ev,ey]=(0,l.useState)(!1),eb=async()=>{f(!0),v(null);try{let e=await fetch("/api/services?status_page_id=".concat(n));if(console.log("Services API response:",e.status,e.statusText),!e.ok){let t=await e.json().catch(()=>({}));throw console.error("Services API error:",t),Error(t.error||"HTTP ".concat(e.status,": ").concat(e.statusText))}let t=await e.json();console.log("Services data:",t),g(t.services||[])}catch(e){console.error("Fetch services error:",e),v(e.message)}finally{f(!1)}};(0,l.useImperativeHandle)(t,()=>({fetchServices:eb,getServices:()=>x})),(0,l.useEffect)(()=>{n&&eb()},[n]),(0,l.useEffect)(()=>{if(!n)return;let e=setInterval(()=>{eb()},3e4);return()=>clearInterval(e)},[n]);let eS=e=>{let t=new Set(k);t.has(e)?t.delete(e):t.add(e),D(t)},ew=e=>{er(e),z(!0)},eC=e=>{er(e),Y(!0)},ek=e=>{eZ(e),ej(!0)},eD=async()=>{if(ef)try{ey(!0);let e=await fetch("/api/services/".concat(ef.id),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to delete service")}g(e=>e.filter(e=>e.id!==ef.id)),ej(!1),eZ(null),console.log("Service deleted successfully:",ef.name)}catch(e){console.error("Error deleting service:",e),v(e.message)}finally{ey(!1)}},e_=e=>{var t;return(null===(t=e.monitoring_checks)||void 0===t?void 0:t.length)||0},ez=e=>e.monitoring_checks?e.monitoring_checks.filter(e=>"down"===e.current_status).length:0,eI=async()=>{if(eo&&ed)try{if(em(!0),!(await fetch("/api/services/".concat(eo.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:ed})})).ok)throw Error("Failed to update service status");if(eh.trim()){let e="operational",t="general";"down"===ed?(e="investigating",t="incident"):"degraded"===ed?(e="identified",t="incident"):"maintenance"===ed?(e="maintenance",t="maintenance"):"operational"===ed&&(e="down"===eo.status||"degraded"===eo.status?"resolved":"operational",t="down"===eo.status||"degraded"===eo.status?"incident":"general");let a={title:"".concat(eo.name," status updated to ").concat(eE(ed)),message:eh.trim(),update_type:t,status:e,status_page_id:n,service_id:eo.id};(await fetch("/api/status-updates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok||console.warn("Failed to post status update message, but service status was updated")}await eb(),el(!1),ec(null),eu(""),ex("")}catch(e){v(e.message)}finally{em(!1)}},eP=e=>{ec(e),eu(e.status),ex(""),el(!0)},eE=e=>{switch(e){case"operational":return"Operational";case"degraded":return"Degraded";case"down":return"Down";case"maintenance":return"Maintenance";default:return"Unknown"}};return(0,a.jsxs)(s.Z,{children:[j&&(0,a.jsx)(o.Z,{}),Z&&(0,a.jsx)(c.Z,{severity:"error",children:Z}),!j&&!Z&&0===x.length&&(0,a.jsx)(r.Z,{color:"text.secondary",children:'No services yet. Click the "Add Service" button above to get started.'}),!j&&!Z&&x.length>0&&(0,a.jsx)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:x.map(e=>{var t,n;let l=k.has(e.id),o=e_(e),c=ez(e);return(0,a.jsxs)(I.Z,{elevation:1,sx:{p:3,"&:hover":{elevation:2,backgroundColor:"rgba(0, 0, 0, 0.02)"}},children:[(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(r.Z,{variant:"h6",fontWeight:"medium",children:e.name}),(0,a.jsx)(p.Z,{label:es[e.status],color:ea[e.status],size:"small"}),o>0&&(0,a.jsx)(p.Z,{icon:(0,a.jsx)(q.Z,{}),label:"".concat(o," checks"),size:"small",variant:"outlined",color:c>0?"error":"success"}),c>0&&(0,a.jsx)(p.Z,{icon:(0,a.jsx)(N.Z,{}),label:"".concat(c," failing"),size:"small",color:"error"})]}),(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(O.Z,{title:"Configure Monitoring",children:(0,a.jsx)(m.Z,{onClick:()=>ew(e),color:"primary",size:"small",children:(0,a.jsx)(J.Z,{})})}),(0,a.jsx)(O.Z,{title:"Edit Service",children:(0,a.jsx)(m.Z,{onClick:()=>eC(e),color:"primary",size:"small",children:(0,a.jsx)(T.Z,{})})}),(0,a.jsx)(O.Z,{title:"Delete Service",children:(0,a.jsx)(m.Z,{onClick:()=>ek(e),color:"error",size:"small",children:(0,a.jsx)(V.Z,{})})}),o>0&&(0,a.jsx)(m.Z,{onClick:()=>eS(e.id),size:"small",children:l?(0,a.jsx)($.Z,{}):(0,a.jsx)(G.Z,{})})]})]}),e.description&&(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",mb:2,children:e.description}),(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:3,children:[(0,a.jsxs)(s.Z,{flex:1,children:[(0,a.jsx)(r.Z,{variant:"subtitle2",color:"text.secondary",mb:1,children:"Last 30 days"}),(0,a.jsx)(et.Z,{serviceId:e.id,days:30})]}),(0,a.jsx)(s.Z,{children:(0,a.jsx)(en.Z,{serviceId:e.id,compact:!0})})]}),(0,a.jsx)(s.Z,{mt:3,display:"flex",justifyContent:"flex-start",children:(0,a.jsx)(i.Z,{onClick:()=>eP(e),variant:"outlined",size:"small",startIcon:(0,a.jsx)(T.Z,{}),sx:{minWidth:140},children:"Update Status"})}),o>0&&(0,a.jsxs)(s.Z,{sx:{mt:3},children:[(0,a.jsx)(P.Z,{sx:{mb:2}}),(0,a.jsxs)(r.Z,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",sx:{mb:2},children:["Monitoring Checks (",o,")"]}),(0,a.jsx)(W.Z,{container:!0,spacing:2,children:null===(t=e.monitoring_checks)||void 0===t?void 0:t.map(e=>{var t;return(0,a.jsx)(W.Z,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsxs)(s.Z,{sx:{p:2,border:"1px solid",borderColor:"grey.200",borderRadius:1,backgroundColor:"background.paper","&:hover":{backgroundColor:"grey.50"}},children:[(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1,children:[(0,a.jsx)(r.Z,{variant:"body2",fontWeight:"medium",children:e.name}),(0,a.jsx)(p.Z,{label:e.current_status||"unknown",size:"small",color:"up"===e.current_status?"success":"down"===e.current_status?"error":"warning"===e.current_status?"warning":"pending"===e.current_status?"info":"default",variant:"outlined"})]}),(0,a.jsxs)(r.Z,{variant:"caption",display:"block",color:"text.secondary",mb:1,children:[null===(t=e.check_type)||void 0===t?void 0:t.toUpperCase()," • ",e.target_url]}),e.last_check_time&&(0,a.jsxs)(r.Z,{variant:"caption",display:"block",color:"text.secondary",children:["Last check: ",new Date(e.last_check_time).toLocaleString()]}),e.last_response_time&&(0,a.jsxs)(r.Z,{variant:"caption",display:"block",color:"text.secondary",children:["Response: ",e.last_response_time<1e3?"".concat(e.last_response_time,"ms"):"".concat((e.last_response_time/1e3).toFixed(2),"s")]}),e.failure_message&&(0,a.jsx)(r.Z,{variant:"caption",display:"block",color:"error.main",sx:{mt:1,fontStyle:"italic"},children:e.failure_message})]})},e.id)})})]}),o>0&&(0,a.jsx)(F.Z,{in:l,timeout:"auto",unmountOnExit:!0,children:(0,a.jsxs)(s.Z,{pt:2,children:[(0,a.jsx)(r.Z,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"Detailed Monitoring Information"}),(0,a.jsx)(d.Z,{dense:!0,children:null===(n=e.monitoring_checks)||void 0===n?void 0:n.map(e=>(0,a.jsx)(u.ZP,{sx:{py:.5,pl:0},children:(0,a.jsx)(h.Z,{primary:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(r.Z,{variant:"body2",children:e.name}),(0,a.jsx)(p.Z,{label:e.current_status||"unknown",size:"small",color:"up"===e.current_status?"success":"down"===e.current_status?"error":"default",variant:"outlined"})]}),secondary:(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(r.Z,{variant:"caption",display:"block",children:["Interval: ",e.check_interval_seconds?"".concat(e.check_interval_seconds,"s"):"Unknown"]}),(0,a.jsxs)(r.Z,{variant:"caption",display:"block",children:["Timeout: ",e.timeout_seconds||30,"s"]}),e.failure_message&&(0,a.jsxs)(r.Z,{variant:"caption",display:"block",color:"error.main",children:["Error: ",e.failure_message]})]})})},e.id))})]})})]},e.id)})}),(0,a.jsx)(X,{open:_,onClose:()=>{z(!1),er(null)},service:K,onConfigUpdated:eb}),(0,a.jsx)(ee,{open:E,onClose:()=>{Y(!1),er(null)},service:K,onServiceUpdated:e=>{g(t=>t.map(t=>t.id===e.id?{...t,...e}:t))}}),(0,a.jsxs)(y.Z,{open:ei,onClose:()=>el(!1),maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(b.Z,{children:(0,a.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(r.Z,{variant:"h6",children:"Update Service Status"}),(0,a.jsx)(m.Z,{onClick:()=>el(!1),size:"small",children:(0,a.jsx)(Q.Z,{})})]})}),(0,a.jsx)(S.Z,{children:eo&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.Z,{variant:"body1",sx:{mb:3},children:["Update the status for"," ",(0,a.jsx)("strong",{children:eo.name})]}),(0,a.jsxs)(A.Z,{fullWidth:!0,sx:{mb:3},children:[(0,a.jsx)(U.Z,{children:"Service Status"}),(0,a.jsxs)(R.Z,{value:ed,onChange:e=>eu(e.target.value),label:"Service Status",children:[(0,a.jsx)(M.Z,{value:"operational",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(L.Z,{sx:{color:"success.main",fontSize:20}}),"Operational"]})}),(0,a.jsx)(M.Z,{value:"degraded",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(N.Z,{sx:{color:"warning.main",fontSize:20}}),"Degraded Performance"]})}),(0,a.jsx)(M.Z,{value:"down",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(B.Z,{sx:{color:"error.main",fontSize:20}}),"Outage"]})}),(0,a.jsx)(M.Z,{value:"maintenance",children:(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(H.Z,{sx:{color:"info.main",fontSize:20}}),"Under Maintenance"]})})]})]}),(0,a.jsx)(C.Z,{fullWidth:!0,multiline:!0,rows:3,label:"Status Update Message (Optional)",value:eh,onChange:e=>ex(e.target.value),placeholder:"Provide details about this status change...",helperText:"This message will be posted as a status update if provided"})]})}),(0,a.jsxs)(w.Z,{sx:{px:3,pb:3},children:[(0,a.jsx)(i.Z,{onClick:()=>el(!1),disabled:eg,children:"Cancel"}),(0,a.jsx)(i.Z,{onClick:eI,variant:"contained",disabled:eg||!ed,startIcon:eg?(0,a.jsx)(o.Z,{size:16}):(0,a.jsx)(T.Z,{}),children:eg?"Updating...":"Update Status"})]})]}),(0,a.jsxs)(y.Z,{open:ep,onClose:()=>{ej(!1),eZ(null)},maxWidth:"sm",fullWidth:!0,children:[(0,a.jsxs)(b.Z,{sx:{display:"flex",alignItems:"center",gap:2,pb:1},children:[(0,a.jsx)(s.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:48,height:48,borderRadius:"50%",backgroundColor:"error.light",color:"error.contrastText"},children:(0,a.jsx)(V.Z,{})}),(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(r.Z,{variant:"h6",component:"div",children:"Delete Service"}),(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:"This action cannot be undone"})]})]}),(0,a.jsxs)(S.Z,{sx:{pt:2},children:[(0,a.jsxs)(s.Z,{sx:{mb:2},children:[(0,a.jsx)(r.Z,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to delete this service?"}),ef&&(0,a.jsxs)(s.Z,{sx:{mt:2,p:2,backgroundColor:"grey.50",borderRadius:1,border:"1px solid",borderColor:"grey.200"},children:[(0,a.jsx)(r.Z,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:ef.name}),ef.description&&(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:ef.description}),(0,a.jsxs)(s.Z,{sx:{display:"flex",gap:1,mt:1},children:[(0,a.jsx)(p.Z,{label:es[ef.status],color:ea[ef.status],size:"small"}),e_(ef)>0&&(0,a.jsx)(p.Z,{icon:(0,a.jsx)(q.Z,{}),label:"".concat(e_(ef)," monitoring checks"),size:"small",variant:"outlined"})]})]})]}),(0,a.jsx)(c.Z,{severity:"warning",sx:{mt:2},children:(0,a.jsx)(r.Z,{variant:"body2",children:"This will permanently remove the service and all associated monitoring configurations, uptime history, and status updates. Any linked monitoring checks will be disconnected."})})]}),(0,a.jsxs)(w.Z,{sx:{px:3,pb:3,pt:1,gap:1},children:[(0,a.jsx)(i.Z,{onClick:()=>{ej(!1),eZ(null)},disabled:ev,variant:"outlined",size:"large",sx:{minWidth:100},children:"Cancel"}),(0,a.jsx)(i.Z,{onClick:eD,color:"error",variant:"contained",disabled:ev,startIcon:ev?(0,a.jsx)(o.Z,{size:16,color:"inherit"}):(0,a.jsx)(V.Z,{}),size:"large",sx:{minWidth:120},children:ev?"Deleting...":"Delete Service"})]})]})]})}),ei=[{value:"operational",label:"Operational"},{value:"degraded",label:"Degraded"},{value:"down",label:"Down"},{value:"maintenance",label:"Maintenance"}];function el(e){let{open:t,onClose:n,statusPageId:r,onServiceCreated:d}=e,[u,h]=(0,l.useState)({name:"",description:"",status:"operational",sort_order:0}),[x,g]=(0,l.useState)(!1),[m,p]=(0,l.useState)(null),j=e=>{let{name:t,value:n}=e.target;h(e=>({...e,[t]:n}))},f=async e=>{if(e.preventDefault(),!u.name.trim()){p("Service name is required");return}g(!0),p(null);try{let e=await fetch("/api/services",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({statusPageId:r,name:u.name.trim(),description:u.description.trim()||null,status:u.status,sortOrder:parseInt(u.sort_order)||0})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP ".concat(e.status,": ").concat(e.statusText))}let t=await e.json();console.log("Service created:",t.service),h({name:"",description:"",status:"operational",sort_order:0}),null==d||d(t.service),n()}catch(e){console.error("Create service error:",e),p(e.message)}finally{g(!1)}},Z=()=>{x||(h({name:"",description:"",status:"operational",sort_order:0}),p(null),n())};return(0,a.jsx)(y.Z,{open:t,onClose:Z,maxWidth:"sm",fullWidth:!0,children:(0,a.jsxs)("form",{onSubmit:f,children:[(0,a.jsx)(b.Z,{children:"Add Service"}),(0,a.jsxs)(S.Z,{children:[m&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:2},children:m}),(0,a.jsx)(C.Z,{name:"name",label:"Service Name",value:u.name,onChange:j,fullWidth:!0,required:!0,margin:"normal",disabled:x,placeholder:"e.g., API Server, Database, Website"}),(0,a.jsx)(C.Z,{name:"description",label:"Description",value:u.description,onChange:j,fullWidth:!0,multiline:!0,rows:3,margin:"normal",disabled:x,placeholder:"Optional description of this service"}),(0,a.jsxs)(A.Z,{fullWidth:!0,margin:"normal",disabled:x,children:[(0,a.jsx)(U.Z,{children:"Status"}),(0,a.jsx)(R.Z,{name:"status",value:u.status,onChange:j,label:"Status",children:ei.map(e=>(0,a.jsx)(M.Z,{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)(C.Z,{name:"sort_order",label:"Sort Order",type:"number",value:u.sort_order,onChange:j,fullWidth:!0,margin:"normal",disabled:x,helperText:"Lower numbers appear first (0 = top)"})]}),(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(i.Z,{onClick:Z,disabled:x,children:"Cancel"}),(0,a.jsx)(i.Z,{type:"submit",variant:"contained",disabled:x||!u.name.trim(),children:x?(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(o.Z,{size:16}),"Creating..."]}):"Create Service"})]})]})})}let eo=e=>e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");function ec(e){let{open:t,onClose:n,statusPage:o,onStatusPageUpdated:d}=e,[u,h]=(0,l.useState)(""),[x,g]=(0,l.useState)(""),[p,j]=(0,l.useState)(""),[f,Z]=(0,l.useState)(!0),[v,_]=(0,l.useState)(!1),[z,I]=(0,l.useState)(null),[P,E]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(t&&o){var e;h(o.name||""),g(o.slug||""),j(o.description||""),Z(null===(e=o.is_public)||void 0===e||e),E(!1),I(null)}},[t,o]),(0,l.useEffect)(()=>{u&&!P&&g(eo(u))},[u,P]);let T=async e=>{if(e.preventDefault(),I(null),!u||!x){I("Name and slug are required.");return}_(!0);try{let e=await fetch("/api/status-pages/".concat(o.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u,slug:x,description:p,is_public:f})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to update status page");d&&d(t.statusPage),n()}catch(e){I(e.message)}finally{_(!1)}},O=()=>{I(null),n()};return(0,a.jsxs)(y.Z,{open:t,onClose:O,maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(b.Z,{children:(0,a.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(r.Z,{variant:"h6",children:"Edit Status Page"}),(0,a.jsx)(m.Z,{onClick:O,size:"small",children:(0,a.jsx)(Q.Z,{})})]})}),(0,a.jsxs)("form",{onSubmit:T,children:[(0,a.jsxs)(S.Z,{children:[z&&(0,a.jsx)(c.Z,{severity:"error",sx:{mb:2},children:z}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Status Page Name",value:u,onChange:e=>h(e.target.value),margin:"normal",required:!0,placeholder:"Enter the name for your status page"}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Slug",value:x,onChange:e=>{g(e.target.value),E(!0)},margin:"normal",required:!0,placeholder:"url-friendly-name",helperText:"This will be used in the URL: /status/your-slug"}),(0,a.jsx)(C.Z,{fullWidth:!0,label:"Description",value:p,onChange:e=>j(e.target.value),margin:"normal",multiline:!0,rows:3,placeholder:"Optional description of your status page"}),(0,a.jsx)(k.Z,{control:(0,a.jsx)(D.Z,{checked:f,onChange:e=>Z(e.target.checked),color:"primary"}),label:"Make this status page public",sx:{mt:2}}),(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Public status pages can be viewed by anyone with the URL. Private pages require authentication."})]}),(0,a.jsxs)(w.Z,{sx:{px:3,pb:3},children:[(0,a.jsx)(i.Z,{onClick:O,disabled:v,children:"Cancel"}),(0,a.jsx)(i.Z,{type:"submit",variant:"contained",disabled:v||!u||!x,children:v?"Updating...":"Update Status Page"})]})]})]})}var ed=n(41563),eu=n(61002);function eh(e){let{statusPageId:t}=e,[n,i]=(0,l.useState)([]),[d,u]=(0,l.useState)(!0),[h,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{t&&g()},[t]);let g=async()=>{try{u(!0);let e=await fetch("/api/services?status_page_id=".concat(t));if(!e.ok)throw Error("Failed to fetch services");let n=await e.json();i(n.services||[])}catch(e){x(e.message)}finally{u(!1)}};if(d)return(0,a.jsx)(ed.Z,{children:(0,a.jsx)(eu.Z,{sx:{textAlign:"center",py:4},children:(0,a.jsx)(o.Z,{})})});if(h)return(0,a.jsxs)(c.Z,{severity:"error",children:["Error loading status: ",h]});let m=(()=>{if(0===n.length)return{status:"No Services",color:"default",icon:(0,a.jsx)(L.Z,{}),count:0};let e=n.filter(e=>"down"===e.status),t=n.filter(e=>"degraded"===e.status),s=n.filter(e=>"maintenance"===e.status),r=n.filter(e=>"operational"===e.status);return e.length>0?{status:"Outage",color:"error",icon:(0,a.jsx)(B.Z,{}),count:e.length,description:"".concat(e.length," service").concat(e.length>1?"s":""," down")}:t.length>0?{status:"Partial Outage",color:"warning",icon:(0,a.jsx)(N.Z,{}),count:t.length,description:"".concat(t.length," service").concat(t.length>1?"s":""," degraded")}:s.length>0?{status:"Under Maintenance",color:"info",icon:(0,a.jsx)(H.Z,{}),count:s.length,description:"".concat(s.length," service").concat(s.length>1?"s":""," in maintenance")}:{status:"All Systems Operational",color:"success",icon:(0,a.jsx)(L.Z,{}),count:r.length,description:"".concat(r.length," service").concat(1!==r.length?"s":""," operational")}})(),j={operational:n.filter(e=>"operational"===e.status).length,degraded:n.filter(e=>"degraded"===e.status).length,down:n.filter(e=>"down"===e.status).length,maintenance:n.filter(e=>"maintenance"===e.status).length};return(0,a.jsx)(ed.Z,{elevation:2,children:(0,a.jsxs)(eu.Z,{children:[(0,a.jsx)(r.Z,{variant:"h6",gutterBottom:!0,children:"Overall Status"}),(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:2,mb:3,children:[(0,a.jsx)(p.Z,{icon:m.icon,label:m.status,color:m.color,size:"large",sx:{fontSize:"0.9rem",px:2,py:1}}),m.description&&(0,a.jsx)(r.Z,{variant:"body2",color:"text.secondary",children:m.description})]}),n.length>0&&(0,a.jsxs)(W.Z,{container:!0,spacing:2,children:[(0,a.jsx)(W.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(s.Z,{textAlign:"center",children:[(0,a.jsx)(r.Z,{variant:"h4",color:"success.main",children:j.operational}),(0,a.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:"Operational"})]})}),(0,a.jsx)(W.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(s.Z,{textAlign:"center",children:[(0,a.jsx)(r.Z,{variant:"h4",color:"warning.main",children:j.degraded}),(0,a.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:"Degraded"})]})}),(0,a.jsx)(W.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(s.Z,{textAlign:"center",children:[(0,a.jsx)(r.Z,{variant:"h4",color:"error.main",children:j.down}),(0,a.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:"Down"})]})}),(0,a.jsx)(W.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(s.Z,{textAlign:"center",children:[(0,a.jsx)(r.Z,{variant:"h4",color:"info.main",children:j.maintenance}),(0,a.jsx)(r.Z,{variant:"caption",color:"text.secondary",children:"Maintenance"})]})})]})]})})}function ex(e){let{statusPage:t,onStatusPageUpdated:n}=e,[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),h=(0,l.useRef)(),x=async e=>{var t,n,a;if(console.log("Service created, refreshing list:",e),h.current){let e=(null===(n=(a=h.current).getServices)||void 0===n?void 0:n.call(a))||[];if(console.log("Current services count before refresh:",e.length),0===e.length){console.log("\uD83D\uDD04 First service added, doing full page reload in 500ms..."),setTimeout(()=>{window.location.reload()},500);return}console.log("\uD83D\uDCCB Additional service added, just refreshing service list...")}null===(t=h.current)||void 0===t||t.fetchServices()};return t?(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(I.Z,{sx:{p:3,mb:3},children:(0,a.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(r.Z,{variant:"h5",gutterBottom:!0,children:t.name}),(0,a.jsxs)(r.Z,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Slug: ",t.slug]}),t.description&&(0,a.jsx)(r.Z,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:t.description})]}),(0,a.jsxs)(s.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(p.Z,{label:t.is_public?"Public":"Private",color:t.is_public?"success":"default",size:"small"}),t.is_public&&(0,a.jsx)(i.Z,{size:"small",variant:"outlined",startIcon:(0,a.jsx)(Z.Z,{}),onClick:()=>window.open("/status/".concat(t.slug),"_blank"),sx:{minWidth:"auto"},children:"View Public Page"}),(0,a.jsx)(m.Z,{onClick:()=>u(!0),size:"small",color:"primary",children:(0,a.jsx)(T.Z,{})})]})]})}),(0,a.jsx)(s.Z,{sx:{mb:3},children:(0,a.jsx)(eh,{statusPageId:t.id})}),(0,a.jsxs)(I.Z,{sx:{p:3},children:[(0,a.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,a.jsx)(r.Z,{variant:"h6",children:"Services"}),(0,a.jsx)(i.Z,{variant:"contained",startIcon:(0,a.jsx)(E.Z,{}),onClick:()=>c(!0),children:"Add Service"})]}),(0,a.jsx)(P.Z,{sx:{mb:2}}),(0,a.jsx)(er,{statusPageId:t.id,ref:h})]}),(0,a.jsx)(el,{open:o,onClose:()=>c(!1),statusPageId:t.id,onServiceCreated:x}),(0,a.jsx)(ec,{open:d,onClose:()=>u(!1),statusPage:t,onStatusPageUpdated:e=>{n&&n(e)}})]}):(0,a.jsx)(r.Z,{color:"text.secondary",children:"Select a status page to manage its services."})}var eg=n(85744);function em(){let[e,t]=(0,l.useState)(null),[n,o]=(0,l.useState)(!1),d=(0,l.useRef)(),{selectedOrganization:u,session:h}=(0,K.o)();return(0,a.jsx)(eg.Z,{children:(0,a.jsxs)(s.Z,{sx:{p:3},children:[(0,a.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(r.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"Status Pages"}),(0,a.jsx)(r.Z,{variant:"body1",color:"text.secondary",children:"Create and manage public status pages for your services"})]}),(0,a.jsx)(i.Z,{variant:"contained",color:"primary",onClick:()=>o(!0),children:"Create Status Page"})]}),u?(0,a.jsxs)(s.Z,{mt:4,children:[(0,a.jsxs)(c.Z,{severity:"success",sx:{mb:3},children:["Managing status pages for:"," ",(0,a.jsx)("strong",{children:u.name}),(0,a.jsx)("br",{}),(0,a.jsx)(r.Z,{variant:"body2",sx:{mt:1},children:"Use the organization selector in the navbar to switch between organizations."})]}),e?(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(i.Z,{variant:"outlined",sx:{mb:3},onClick:()=>t(null),children:"← Back to Status Pages"}),(0,a.jsx)(ex,{statusPage:e,onStatusPageUpdated:e=>{var n;t(e),null===(n=d.current)||void 0===n||n.fetchStatusPages()}})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{ref:d,orgId:u.id,onSelectStatusPage:t}),n&&(0,a.jsx)(s.Z,{mt:4,children:(0,a.jsx)(z,{orgId:u.id,onSuccess:()=>{var e;o(!1),null===(e=d.current)||void 0===e||e.fetchStatusPages()},onCancel:()=>o(!1)})})]})]}):(0,a.jsx)(c.Z,{severity:"info",sx:{my:3},children:"Please select an organization from the navbar to manage its status pages."})]})})}},85744:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(57437),s=n(2265),r=n(8319),i=n(38543),l=n(44812);function o(e){let{children:t}=e,{session:n,sessionStatus:o}=(0,l.o)();return((0,s.useEffect)(()=>{"unauthenticated"===o&&(window.location.href="/api/auth/signin")},[o]),"loading"===o)?(0,a.jsx)(i.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,a.jsx)(r.Z,{})}):n?t:null}},80570:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(57437),s=n(2265),r=n(38543),i=n(8319),l=n(90658),o=n(33101),c=n(50793),d=n(88654),u=n(19352);function h(e){let{serviceId:t,compact:n=!1}=e,[h,x]=(0,s.useState)(null),[g,m]=(0,s.useState)(!0),[p,j]=(0,s.useState)(null);(0,s.useEffect)(()=>{t&&f()},[t]);let f=async()=>{m(!0),j(null);try{let e=await fetch("/api/services/".concat(t,"/sla?days=90"));if(!e.ok)throw Error("Failed to fetch SLA data");let n=await e.json();x(n)}catch(e){console.error("Error fetching uptime data:",e),j(e.message)}finally{m(!1)}},Z=e=>e>=99.9?"success":e>=99?"warning":"error",v=e=>"".concat(e.toFixed(2),"%");if(g)return(0,a.jsxs)(r.Z,{display:"flex",alignItems:"center",gap:1,py:1,children:[(0,a.jsx)(i.Z,{size:16}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Loading uptime stats..."})]});if(p)return(0,a.jsx)(o.Z,{severity:"error",sx:{py:.5},children:(0,a.jsxs)(l.Z,{variant:"caption",children:["Failed to load uptime: ",p]})});if(!(null==h?void 0:h.uptimeStats))return(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"No uptime data available"});let{uptimeStats:y}=h;return n?(0,a.jsxs)(r.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,a.jsx)(c.Z,{label:v(y.last30Days),color:Z(y.last30Days),size:"small",variant:"outlined"}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"30 days"})]}):(0,a.jsxs)(d.Z,{elevation:1,sx:{p:2},children:[(0,a.jsx)(l.Z,{variant:"h6",gutterBottom:!0,children:"Uptime Statistics"}),(0,a.jsxs)(u.Z,{container:!0,spacing:2,children:[(0,a.jsx)(u.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(r.Z,{textAlign:"center",children:[(0,a.jsx)(l.Z,{variant:"h4",color:Z(y.last24Hours)+".main",fontWeight:"bold",children:v(y.last24Hours)}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Last 24 Hours"})]})}),(0,a.jsx)(u.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(r.Z,{textAlign:"center",children:[(0,a.jsx)(l.Z,{variant:"h4",color:Z(y.last7Days)+".main",fontWeight:"bold",children:v(y.last7Days)}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Last 7 Days"})]})}),(0,a.jsx)(u.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(r.Z,{textAlign:"center",children:[(0,a.jsx)(l.Z,{variant:"h4",color:Z(y.last30Days)+".main",fontWeight:"bold",children:v(y.last30Days)}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Last 30 Days"})]})}),(0,a.jsx)(u.Z,{item:!0,xs:6,sm:3,children:(0,a.jsxs)(r.Z,{textAlign:"center",children:[(0,a.jsx)(l.Z,{variant:"h4",color:Z(y.last90Days)+".main",fontWeight:"bold",children:v(y.last90Days)}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Last 90 Days"})]})})]}),h.incidents&&Object.keys(h.incidents).length>0&&(0,a.jsxs)(r.Z,{mt:3,children:[(0,a.jsx)(l.Z,{variant:"subtitle2",gutterBottom:!0,children:"Recent Issues (Last 30 Days)"}),(0,a.jsx)(u.Z,{container:!0,spacing:1,children:Object.entries(h.incidents).map(e=>{let[t,n]=e;return(0,a.jsx)(u.Z,{item:!0,xs:6,children:(0,a.jsxs)(d.Z,{variant:"outlined",sx:{p:1.5,textAlign:"center"},children:[(0,a.jsx)(l.Z,{variant:"h6",color:"error.main",children:n.count}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",display:"block",children:"down"===t?"Outages":"Degraded Periods"}),(0,a.jsxs)(l.Z,{variant:"caption",color:"text.secondary",children:[Math.round(n.totalMinutes)," minutes total"]})]})},t)})})]})]})}},87135:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(57437),s=n(2265),r=n(38543),i=n(18150),l=n(90658),o=n(8319),c=n(33101);let d={operational:"#10b981",degraded:"#f59e0b",down:"#ef4444",maintenance:"#3b82f6",up:"#10b981"},u={operational:"Operational",degraded:"Degraded Performance",down:"Outage",maintenance:"Under Maintenance",up:"Up"};function h(e){var t;let{serviceId:n,days:h=30}=e,[x,g]=(0,s.useState)(null),[m,p]=(0,s.useState)(!0),[j,f]=(0,s.useState)(null);(0,s.useEffect)(()=>{n&&Z()},[n,h]);let Z=async()=>{p(!0),f(null);try{let e=await fetch("/api/services/".concat(n,"/sla?days=").concat(h));if(!e.ok)throw Error("Failed to fetch SLA data");let t=await e.json();g(t)}catch(e){console.error("Error fetching timeline data:",e),f(e.message)}finally{p(!1)}},v=e=>e<1?"".concat(Math.round(60*e),"m"):e<24?"".concat(Math.round(e),"h"):"".concat(Math.round(e/24),"d"),y=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return m?(0,a.jsxs)(r.Z,{display:"flex",alignItems:"center",gap:1,py:1,children:[(0,a.jsx)(o.Z,{size:16}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Loading timeline..."})]}):j?(0,a.jsx)(c.Z,{severity:"error",sx:{py:.5},children:(0,a.jsxs)(l.Z,{variant:"caption",children:["Failed to load timeline: ",j]})}):(null==x?void 0:null===(t=x.timeline)||void 0===t?void 0:t.length)?(0,a.jsxs)(r.Z,{children:[(()=>{if(!(null==x?void 0:x.timeline))return null;let e=new Date,t=new Date(e.getTime()-864e5*h);return(0,a.jsxs)(r.Z,{sx:{position:"relative",height:8,mb:1},children:[(0,a.jsx)(r.Z,{sx:{position:"absolute",top:0,left:0,right:0,height:"100%",backgroundColor:"grey.200",borderRadius:1}}),x.timeline.map((n,s)=>{let o=new Date(n.periodStart),c=new Date(n.periodEnd),h=100*Math.max(0,(o-t)/(e-t)),x=100*Math.min(100,(c-t)/(e-t))-h;return x<=0?null:(0,a.jsx)(i.Z,{title:(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(l.Z,{variant:"body2",fontWeight:"bold",children:u[n.status]}),(0,a.jsxs)(l.Z,{variant:"caption",display:"block",children:[y(n.periodStart)," -"," ",y(n.periodEnd)]}),(0,a.jsxs)(l.Z,{variant:"caption",display:"block",children:["Duration: ",v(n.durationHours)]})]}),arrow:!0,placement:"top",children:(0,a.jsx)(r.Z,{sx:{position:"absolute",top:0,left:"".concat(h,"%"),width:"".concat(x,"%"),height:"100%",backgroundColor:d[n.status],cursor:"pointer","&:hover":{opacity:.8}}})},s)})]})})(),(0,a.jsxs)(r.Z,{display:"flex",justifyContent:"space-between",mt:.5,children:[(0,a.jsxs)(l.Z,{variant:"caption",color:"text.secondary",children:[h," days ago"]}),(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"Today"})]})]}):(0,a.jsx)(r.Z,{py:1,children:(0,a.jsx)(l.Z,{variant:"caption",color:"text.secondary",children:"No timeline data available"})})}},44812:function(e,t,n){"use strict";n.d(t,{f:function(){return o},o:function(){return c}});var a=n(57437),s=n(2265);let r=(0,s.createContext)(),i=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},l=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function o(e){let{children:t}=e,{data:n,status:o}=function(){let[e,t]=(0,s.useState)(null),[n,a]=(0,s.useState)("loading");return(0,s.useEffect)(()=>{let e=async()=>{try{a("loading");let e=await fetch("/api/auth/session");if(e.ok){let n=await e.json();t(n),a(n?"authenticated":"unauthenticated")}else t(null),a("unauthenticated")}catch(e){console.error("Error fetching session:",e),t(null),a("unauthenticated")}};e();let n=setInterval(e,3e5);return()=>clearInterval(n)},[]),{data:e,status:n}}(),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)([]),[x,g]=(0,s.useState)(!1),[m,p]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{f(!0)},[]),(0,s.useEffect)(()=>{if(j&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=i();if(e){let t=u.find(t=>t.id===e);t?(console.log("\uD83D\uDD04 Client-side restoration successful:",t.name),d(t)):(console.log("⚠️ Saved organization no longer available, clearing storage"),l(null))}}},[j,u,c]),(0,s.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.email)||"no session","[".concat(o,"]")),n&&"authenticated"===o?Z():"unauthenticated"===o&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),h([]),d(null),l(null))},[n,o]);let Z=async()=>{try{g(!0),p(null);let e=await fetch("/api/organizations");if(e.ok){let t=(await e.json()).organizations||[];h(t);let n=null,a=i();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",a),a&&((n=t.find(e=>e.id===a))?console.log("\uD83C\uDFAF Found matching organization for restoration:",n.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),l(null))),!n&&t.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let a=await e.json();if(a.hasDefault){let e=t.find(e=>e.id===a.defaultOrganization.id);e&&(n=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(n)console.log("✅ Selected organization:",n.name),d(n),l(n.id);else if(1===t.length){let e=t[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),l(e.id)}else 0===t.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),p("Failed to fetch organizations"),h([])}catch(e){console.error("Error fetching organizations:",e),p(e.message),h([])}finally{g(!1)}};return(0,a.jsx)(r.Provider,{value:{selectedOrganization:c,organizations:u,loading:x,error:m,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),l((null==e?void 0:e.id)||null)},refreshOrganizations:Z,session:n,sessionStatus:o},children:t})}function c(){let e=(0,s.useContext)(r);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,7286,4045,8150,9815,2413,3625,3171,2971,7466,1744],function(){return e(e.s=90927)}),_N_E=e.O()}]);