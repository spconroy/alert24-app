(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6938],{64809:function(e,n,t){Promise.resolve().then(t.bind(t,85178))},85178:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return T}});var i=t(57437),a=t(38543),o=t(90658),l=t(12256),r=t(2265),s=t(8319),c=t(77639),d=t(41563),u=t(61002),g=t(61888),h=t(67939),m=t(75263),x=t(50793),f=t(18150),j=t(36261),v=t(49715),Z=t(73985),p=t(66825),y=t(33101),z=t(31835),b=t(22347),S=t(9391),D=t(73088),C=t(95280),w=t(95386),k=t(99636),I=(0,t(64059).Z)((0,i.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd"),E=t(27367),O=t(22292);function M(e){let{orgId:n}=e,[t,l]=(0,r.useState)([]),[M,P]=(0,r.useState)([]),[F,T]=(0,r.useState)(!0),[_,N]=(0,r.useState)(""),[R,A]=(0,r.useState)(!1),[q,B]=(0,r.useState)({email:"",role:"responder"}),[W,H]=(0,r.useState)(!1),[L,V]=(0,r.useState)(""),[U,J]=(0,r.useState)("");(0,r.useEffect)(()=>{n&&Y()},[n]);let Y=async()=>{if(n){T(!0);try{let[e,t]=await Promise.all([fetch("/api/organizations/".concat(n)),fetch("/api/organizations/".concat(n,"/invitations"))]);if(e.ok){let n=await e.json();l(n.members||[])}if(t.ok){let e=await t.json();P(e.invitations||[])}}catch(e){N("Failed to load organization data.")}finally{T(!1)}}},$=async()=>{if(!q.email){V("Email is required");return}H(!0),V("");try{let e=await fetch("/api/organizations/".concat(n,"/invitations"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to send invitation");J("Invitation sent to ".concat(q.email)),B({email:"",role:"responder"}),Y(),setTimeout(()=>{A(!1),J("")},2e3)}catch(e){V(e.message)}finally{H(!1)}},G=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return n?F?(0,i.jsx)(s.Z,{}):_?(0,i.jsx)(o.Z,{color:"error",children:_}):(0,i.jsxs)(a.Z,{mt:3,children:[(0,i.jsxs)(a.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,i.jsxs)(o.Z,{variant:"h6",children:["Team Members (",t.length,")"]}),(0,i.jsxs)(a.Z,{display:"flex",gap:1,children:[(0,i.jsx)(c.Z,{startIcon:(0,i.jsx)(k.Z,{}),onClick:Y,size:"small",children:"Refresh"}),(0,i.jsx)(c.Z,{variant:"contained",startIcon:(0,i.jsx)(I,{}),onClick:()=>A(!0),children:"Invite Member"})]})]}),(0,i.jsx)(d.Z,{variant:"outlined",sx:{mb:3},children:(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(o.Z,{variant:"subtitle1",gutterBottom:!0,children:"Active Members"}),0===t.length?(0,i.jsx)(o.Z,{color:"text.secondary",children:"No members found."}):(0,i.jsx)(g.Z,{dense:!0,children:t.map(e=>(0,i.jsxs)(h.ZP,{divider:!0,children:[(0,i.jsx)(m.Z,{primary:e.name||e.email,secondary:e.email}),(0,i.jsxs)(a.Z,{display:"flex",gap:1,children:[(0,i.jsx)(x.Z,{label:e.role,color:"owner"===e.role?"primary":"admin"===e.role?"secondary":"default",size:"small"}),!e.is_active&&(0,i.jsx)(x.Z,{label:"Inactive",color:"warning",size:"small"})]})]},e.id))})]})}),M.length>0&&(0,i.jsx)(d.Z,{variant:"outlined",children:(0,i.jsxs)(u.Z,{children:[(0,i.jsxs)(o.Z,{variant:"subtitle1",gutterBottom:!0,children:["Pending Invitations (",M.length,")"]}),(0,i.jsx)(g.Z,{dense:!0,children:M.map(e=>(0,i.jsxs)(h.ZP,{divider:!0,children:[(0,i.jsx)(E.Z,{sx:{mr:2,color:"warning.main"}}),(0,i.jsx)(m.Z,{primary:e.email,secondary:"Invited ".concat(G(e.invited_at)," • Expires ").concat(G(e.invitation_expires_at))}),(0,i.jsxs)(a.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,i.jsx)(x.Z,{label:e.role,size:"small",color:"default",variant:"outlined"}),(0,i.jsx)(f.Z,{title:"Copy invitation link",children:(0,i.jsx)(j.Z,{size:"small",onClick:()=>{let n="".concat(window.location.origin,"/accept-invitation?token=").concat(e.invitation_token);navigator.clipboard.writeText(n)},children:(0,i.jsx)(O.Z,{})})})]})]},e.id))})]})}),(0,i.jsxs)(v.Z,{open:R,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:"Invite Team Member"}),(0,i.jsx)(p.Z,{children:(0,i.jsxs)(a.Z,{display:"flex",flexDirection:"column",gap:3,mt:1,children:[L&&(0,i.jsx)(y.Z,{severity:"error",children:L}),U&&(0,i.jsx)(y.Z,{severity:"success",children:U}),(0,i.jsx)(z.Z,{label:"Email Address",type:"email",value:q.email,onChange:e=>B(n=>({...n,email:e.target.value})),fullWidth:!0,required:!0,placeholder:"colleague@company.com",disabled:W}),(0,i.jsxs)(b.Z,{fullWidth:!0,children:[(0,i.jsx)(S.Z,{children:"Role"}),(0,i.jsxs)(D.Z,{value:q.role,label:"Role",onChange:e=>B(n=>({...n,role:e.target.value})),disabled:W,children:[(0,i.jsx)(C.Z,{value:"stakeholder",children:"Stakeholder"}),(0,i.jsx)(C.Z,{value:"responder",children:"Responder"}),(0,i.jsx)(C.Z,{value:"admin",children:"Admin"})]})]}),(0,i.jsxs)(a.Z,{p:2,bgcolor:"grey.50",borderRadius:1,children:[(0,i.jsx)(o.Z,{variant:"subtitle2",gutterBottom:!0,children:"Role Permissions:"}),(0,i.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-line"},children:"admin"===q.role?"• Manage incidents, monitoring, and team members\n• Configure escalation policies and schedules\n• Access all organization settings\n• Cannot modify organization name or delete organization\n• Cannot modify owners":"responder"===q.role?"• View all organization data\n• Manage incidents and update service statuses\n• Post status updates and messages\n• Participate in on-call schedules\n• Cannot manage users or organization settings":"• View non-public status pages\n• Read-only access to incidents and services\n• Cannot make changes to any data\n• Ideal for external stakeholders and observers"})]})]})}),(0,i.jsxs)(w.Z,{children:[(0,i.jsx)(c.Z,{onClick:()=>A(!1),disabled:W,children:"Cancel"}),(0,i.jsx)(c.Z,{variant:"contained",onClick:$,disabled:W,startIcon:W?(0,i.jsx)(s.Z,{size:20}):(0,i.jsx)(O.Z,{}),children:W?"Sending...":"Send Invitation"})]})]})]}):null}var P=t(44812),F=t(85744);function T(){let[e,n]=(0,r.useState)(!1),{selectedOrganization:t,organizations:s,loading:d,refreshOrganizations:u,selectOrganization:g,session:h}=(0,P.o)();return(0,r.useEffect)(()=>{d||0!==s.length||e||n(!0)},[s,d,e]),(0,i.jsx)(F.Z,{children:d?(0,i.jsx)(a.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,i.jsx)(o.Z,{children:"Loading organizations..."})}):(0,i.jsxs)(a.Z,{sx:{p:3},children:[(0,i.jsx)(o.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"Settings"}),(0,i.jsxs)(a.Z,{mt:4,children:[(0,i.jsx)(o.Z,{variant:"h5",gutterBottom:!0,children:"Organizations"}),e?(0,i.jsx)(l.Z,{onSuccess:async e=>{n(!1),await u(),e&&g({...e,role:"owner"})},onBack:()=>n(!1)}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z,{variant:"outlined",color:"primary",sx:{mb:3},onClick:()=>n(!0),children:"Create New Organization"}),t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(y.Z,{severity:"success",sx:{mb:3},children:["Currently managing:"," ",(0,i.jsx)("strong",{children:t.name}),(0,i.jsx)("br",{}),(0,i.jsx)(o.Z,{variant:"body2",sx:{mt:1},children:"Use the organization selector in the navbar to switch between organizations."})]}),(0,i.jsx)(M,{orgId:t.id})]}):(0,i.jsx)(y.Z,{severity:"info",sx:{mb:3},children:"Please select an organization from the navbar to manage its settings and members."})]})]})]})})}},12256:function(e,n,t){"use strict";t.d(n,{Z:function(){return f}});var i=t(57437),a=t(2265),o=t(41563),l=t(61002),r=t(38543),s=t(77639),c=t(90658),d=t(33101),u=t(19352),g=t(31835),h=t(8319),m=t(51442),x=t(44812);function f(e){let{onBack:n,onSuccess:t}=e,[f,j]=(0,a.useState)(""),[v,Z]=(0,a.useState)(""),[p,y]=(0,a.useState)(""),[z,b]=(0,a.useState)(""),[S,D]=(0,a.useState)(!1),[C,w]=(0,a.useState)(!1),{session:k}=(0,x.o)(),I=e=>{let{name:n,value:t}=e.target;"name"===n?(j(t),Z(t.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""))):"domain"===n&&y(t)},E=async e=>{var n,i;if(e.preventDefault(),!(null==k?void 0:null===(n=k.user)||void 0===n?void 0:n.id)){b("You must be logged in to create an organization");return}D(!0),b(""),w(!1);let a=await fetch("/api/organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f,slug:v,domain:p,userId:null==k?void 0:null===(i=k.user)||void 0===i?void 0:i.id})}),o=await a.json();D(!1),a.ok?(w(!0),j(""),Z(""),y(""),t&&t(o.organization)):b(o.error||"Failed to create organization")};return(0,i.jsx)(o.Z,{children:(0,i.jsxs)(l.Z,{children:[(0,i.jsxs)(r.Z,{display:"flex",alignItems:"center",mb:3,children:[(0,i.jsx)(s.Z,{startIcon:(0,i.jsx)(m.Z,{}),onClick:n,sx:{mr:2},children:"Back"}),(0,i.jsx)(c.Z,{variant:"h5",component:"h2",children:"Create New Organization"})]}),z&&(0,i.jsx)(d.Z,{severity:"error",sx:{mb:2},children:z}),C&&(0,i.jsx)(d.Z,{severity:"success",sx:{mb:2},children:"Organization created!"}),(0,i.jsx)("form",{onSubmit:E,children:(0,i.jsxs)(u.Z,{container:!0,spacing:3,children:[(0,i.jsx)(u.Z,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{fullWidth:!0,label:"Organization Name",name:"name",value:f,onChange:I,required:!0,disabled:S,helperText:"Enter a descriptive name for your organization. Organization name must be globally unique."})}),(0,i.jsx)(u.Z,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{fullWidth:!0,label:"Slug",name:"slug",value:v,onChange:I,required:!0,disabled:S,helperText:"URL-friendly identifier (auto-generated from name). Short unique identifier (e.g. acme-corp). Must be globally unique."})}),(0,i.jsx)(u.Z,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{fullWidth:!0,label:"Custom Domain (Optional)",name:"domain",value:p,onChange:I,disabled:S,helperText:"e.g., mycompany.alert24.com. Custom domain for your organization (optional, must be globally unique if used)"})}),(0,i.jsx)(u.Z,{item:!0,xs:12,children:(0,i.jsxs)(r.Z,{display:"flex",gap:2,children:[(0,i.jsx)(s.Z,{type:"submit",variant:"contained",disabled:S||!f||!v,startIcon:S?(0,i.jsx)(h.Z,{size:20}):null,children:S?"Creating...":"Create Organization"}),(0,i.jsx)(s.Z,{variant:"outlined",onClick:n,disabled:S,children:"Cancel"})]})})]})})]})})}},85744:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var i=t(57437),a=t(2265),o=t(8319),l=t(38543),r=t(44812);function s(e){let{children:n}=e,{session:t,sessionStatus:s}=(0,r.o)();return((0,a.useEffect)(()=>{"unauthenticated"===s&&(window.location.href="/api/auth/signin")},[s]),"loading"===s)?(0,i.jsx)(l.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,i.jsx)(o.Z,{})}):t?n:null}},44812:function(e,n,t){"use strict";t.d(n,{f:function(){return s},o:function(){return c}});var i=t(57437),a=t(2265);let o=(0,a.createContext)(),l=()=>{try{if(window.localStorage)return localStorage.getItem("selectedOrganizationId")}catch(e){console.warn("Failed to read from localStorage:",e)}return null},r=e=>{try{if(window.localStorage){if(e)return localStorage.setItem("selectedOrganizationId",e),console.log("✅ Saved to localStorage:",e),!0;return localStorage.removeItem("selectedOrganizationId"),console.log("\uD83D\uDDD1️ Removed from localStorage"),!0}}catch(e){console.warn("Failed to write to localStorage:",e)}return!1};function s(e){let{children:n}=e,{data:t,status:s}=function(){let[e,n]=(0,a.useState)(null),[t,i]=(0,a.useState)("loading");return(0,a.useEffect)(()=>{let e=async()=>{try{i("loading");let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();n(t),i(t?"authenticated":"unauthenticated")}else n(null),i("unauthenticated")}catch(e){console.error("Error fetching session:",e),n(null),i("unauthenticated")}};e();let t=setInterval(e,3e5);return()=>clearInterval(t)},[]),{data:e,status:t}}(),[c,d]=(0,a.useState)(null),[u,g]=(0,a.useState)([]),[h,m]=(0,a.useState)(!1),[x,f]=(0,a.useState)(null),[j,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v(!0)},[]),(0,a.useEffect)(()=>{if(j&&u.length>0&&!c){console.log("\uD83D\uDD0D Client-side restoration check...");let e=l();if(e){let n=u.find(n=>n.id===e);n?(console.log("\uD83D\uDD04 Client-side restoration successful:",n.name),d(n)):(console.log("⚠️ Saved organization no longer available, clearing storage"),r(null))}}},[j,u,c]),(0,a.useEffect)(()=>{var e;console.log("\uD83D\uDD04 OrganizationContext:",(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email)||"no session","[".concat(s,"]")),t&&"authenticated"===s?Z():"unauthenticated"===s&&(console.log("\uD83D\uDEAA User logged out - clearing organizations"),g([]),d(null),r(null))},[t,s]);let Z=async()=>{try{m(!0),f(null);let e=await fetch("/api/organizations");if(e.ok){let n=(await e.json()).organizations||[];g(n);let t=null,i=l();if(console.log("\uD83D\uDD0D Checking localStorage for saved organization:",i),i&&((t=n.find(e=>e.id===i))?console.log("\uD83C\uDFAF Found matching organization for restoration:",t.name):(console.log("⚠️ Saved organization ID not found in current organizations, clearing localStorage"),r(null))),!t&&n.length>1){console.log("\uD83D\uDD0D Checking for default organization...");try{let e=await fetch("/api/user/default-organization");if(e.ok){let i=await e.json();if(i.hasDefault){let e=n.find(e=>e.id===i.defaultOrganization.id);e&&(t=e,console.log("⭐ Found default organization:",e.name))}}}catch(e){console.error("Error fetching default organization:",e)}}if(t)console.log("✅ Selected organization:",t.name),d(t),r(t.id);else if(1===n.length){let e=n[0];console.log("\uD83D\uDD04 Auto-selecting single organization:",e.name),d(e),r(e.id)}else 0===n.length?(console.log("\uD83D\uDCED No organizations available"),d(null)):console.log("\uD83E\uDD14 Multiple organizations available, waiting for user selection")}else console.error("Failed to fetch organizations:",e.status,e.statusText),f("Failed to fetch organizations"),g([])}catch(e){console.error("Error fetching organizations:",e),f(e.message),g([])}finally{m(!1)}};return(0,i.jsx)(o.Provider,{value:{selectedOrganization:c,organizations:u,loading:h,error:x,selectOrganization:e=>{console.log("\uD83D\uDCBE Selecting organization:",(null==e?void 0:e.name)||"none"),d(e),r((null==e?void 0:e.id)||null)},refreshOrganizations:Z,session:t,sessionStatus:s},children:n})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}},22292:function(e,n,t){"use strict";var i=t(64059),a=t(57437);n.Z=(0,i.Z)((0,a.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email")},99636:function(e,n,t){"use strict";var i=t(64059),a=t(57437);n.Z=(0,i.Z)((0,a.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")},27367:function(e,n,t){"use strict";var i=t(64059),a=t(57437);n.Z=(0,i.Z)([(0,a.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,a.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule")}},function(e){e.O(0,[702,7639,7863,3744,793,9352,1835,7286,4045,8150,9815,1932,2971,7466,1744],function(){return e(e.s=64809)}),_N_E=e.O()}]);